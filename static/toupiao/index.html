<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>全班投票小工具</title>
    <style>
        body {
            font-family: 'Microsoft YaHei', sans-serif;
            max-width: 1260px;
            margin: 0 auto;
            padding: 5px;
            background-color: #f5f5f5;
            height: 100vh;
            display: flex;
            flex-direction: column;
            justify-content: center;
            /* 禁用触摸屏双击缩放 */
            touch-action: manipulation;
            /* 禁用长按选择文本 */
            -webkit-user-select: none;
            -moz-user-select: none;
            -ms-user-select: none;
            user-select: none;
            /* 禁用长按右键菜单 */
            -webkit-touch-callout: none;
        }
        .main-container {
            display: grid;
            grid-template-columns: 1fr 2fr 1fr;
            gap: 20px;
            height: 80vh;
            align-items: center;
        }
        .chart-container {
            background-color: white;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            grid-column: 2;
            min-height:600px;
        }
        .voting-areas {
            display: flex;
            flex-direction: column;
            gap: 20px;
        }
        .voting-area {
            background-color: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            flex: 1;
        }
        .number-buttons {
            display: grid;
            grid-template-columns: repeat(5, 1fr);
            gap: 8px;
            margin-bottom: 15px;
        }
        .number-button {
            aspect-ratio: 1;
            font-size: 24px;
            border: none;
            border-radius: 4px;
            background-color: #f0f0f0;
            cursor: pointer;
            transition: all 0.3s;
        }
        .number-button:hover {
            background-color: #e0e0e0;
        }
        .number-button.selected {
            background-color: #3498db;
            color: white;
        }
        .submit-button {
            font-size: 24px;
            padding: 5px 10px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            transition: all 0.3s;
            width: 100%;
            background-color: #3498db;
            color: white;
            grid-column: span 5;
        }
        .submit-button:hover {
            background-color: #2980b9;
        }
        h2{
            text-align: center;
            padding: 10px 20px;
            margin: 10px auto;
            background-color: #3498db;
            color: white;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s;
            user-select: none;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        h2:hover {
            background-color: #2980b9;
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0,0,0,0.2);
        }
        h2:active {
            transform: translateY(0);
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
    </style>
</head>
<body>
    <h2 id="sortButton">全班投票小工具 📊</h2>
    <div class="main-container">
        <div class="voting-areas" id="leftVoting">
            <!-- 左侧投票区域 -->
        </div>
        <div class="chart-container" id="voteChart"></div>
        <div class="voting-areas" id="rightVoting">
            <!-- 右侧投票区域 -->
        </div>
    </div>
    <script src="echarts.min.js"></script>
    
    <script>
        // 禁用触摸屏双击和长按事件
        document.addEventListener('DOMContentLoaded', function() {
            // 禁用双击事件
            document.addEventListener('dblclick', function(e) {
                e.preventDefault();
                e.stopPropagation();
            }, { passive: false });
            
            // 禁用长按事件（contextmenu）
            document.addEventListener('contextmenu', function(e) {
                e.preventDefault();
                e.stopPropagation();
            }, { passive: false });
            
            // 禁用触摸长按事件
            let touchTimer = null;
            document.addEventListener('touchstart', function(e) {
                touchTimer = setTimeout(function() {
                    e.preventDefault();
                    e.stopPropagation();
                }, 500);
            }, { passive: false });
            
            document.addEventListener('touchend', function(e) {
                if (touchTimer) {
                    clearTimeout(touchTimer);
                    touchTimer = null;
                }
            }, { passive: false });
            
            document.addEventListener('touchmove', function(e) {
                if (touchTimer) {
                    clearTimeout(touchTimer);
                    touchTimer = null;
                }
            }, { passive: false });
        });
        
        // 初始化投票数据，45个学号对应的票数
        const voteData = Array(50).fill(0);
        
        // 排序状态：false为默认顺序，true为按票数从高到低排序
        let isSorted = false;

        // 创建图表
        const chartDom = document.getElementById('voteChart');
        const myChart = echarts.init(chartDom);
        
        // 配置图表选项
        const option = {
            tooltip: {
                trigger: 'axis',
                axisPointer: {
                    type: 'shadow'
                }
            },
            grid: {
                left: '5%',
                top: '10%',
                right: '10%',
                bottom: '5%',
                containLabel: true
            },
            xAxis: [
                {
                    type: 'category',
                    data: [],
                    axisTick: {
                        alignWithLabel: true
                    },
                    axisLabel: {
                        fontSize: 16
                    },
                    axisLine: {
                        show: true,
                        lineStyle: {
                            width: 2
                        },
                        symbol: ['none', 'arrow'],
                        symbolSize: [10, 15],
                        symbolOffset: [15, 0]
                    },
                    name: '学号',
                    nameLocation: 'end',
                    nameTextStyle: {
                        fontSize: 18,
                        padding: [5, 0, 0, 0]
                    }
                }
            ],
            yAxis: [
                {
                    type: 'value',
                    minInterval: 1,
                    interval: 1,
                    max: function(value) {
                        return value.max > 5 ? value.max : 5;
                    },
                    axisLabel: {
                        fontSize: 18
                    },
                    axisLine: {
                        show: true,
                        lineStyle: {
                            width: 2
                        },
                        symbol: ['none', 'arrow'],
                        symbolSize: [10, 15],
                        symbolOffset: [0, 15]
                    },
                    name: '票',
                    nameLocation: 'end',
                    nameTextStyle: {
                        fontSize: 18,
                        padding: [0, 0, 5, 0]
                    }
                }
            ],
            series: [
                {
                    type: 'bar',
                    barWidth: '60%',
                    data: [],
                    itemStyle: {
                        color: '#3498db'
                    }
                }
            ]
        };
        
        // 使用配置项显示图表
        myChart.setOption(option);

        // 更新图表数据的函数
        function updateChart() {
            const nonZeroData = [];
            const nonZeroLabels = [];
            
            // 收集非零数据
            const dataWithIndex = [];
            voteData.forEach((count, index) => {
                if (count > 0) {
                    dataWithIndex.push({
                        count: count,
                        label: `${index + 1}`,
                        index: index
                    });
                }
            });
            
            // 根据排序状态决定是否排序
            if (isSorted) {
                dataWithIndex.sort((a, b) => b.count - a.count);
            }
            
            // 提取排序后的数据和标签
            dataWithIndex.forEach(item => {
                nonZeroData.push(item.count);
                nonZeroLabels.push(item.label);
            });
            
            myChart.setOption({
                xAxis: [{
                    data: nonZeroLabels
                }],
                series: [{
                    data: nonZeroData
                }]
            });
        }

        // 创建投票区域
        const leftVoting = document.getElementById('leftVoting');
        const rightVoting = document.getElementById('rightVoting');
        
        // 创建左侧投票区域（学号1-45）
        const leftArea = document.createElement('div');
        leftArea.className = 'voting-area';
        leftArea.innerHTML = `
            <div class="number-buttons">
                ${Array.from({length: 50}, (_, i) => `
                    <button class="number-button" data-number="${i + 1}">${i + 1}</button>
                `).join('')}
                <button class="submit-button">确认</button>
            </div>
        `;
        leftVoting.appendChild(leftArea);

        // 创建右侧投票区域（学号1-45）
        const rightArea = document.createElement('div');
        rightArea.className = 'voting-area';
        rightArea.innerHTML = `
            <div class="number-buttons">
                ${Array.from({length: 50}, (_, i) => `
                    <button class="number-button" data-number="${i + 1}">${i + 1}</button>
                `).join('')}
                <button class="submit-button">确认</button>
            </div>
        `;
        rightVoting.appendChild(rightArea);

        // 为左侧投票区域添加事件监听
        const leftNumberButtons = leftArea.querySelectorAll('.number-button');
        leftNumberButtons.forEach(button => {
            button.addEventListener('click', () => {
                button.classList.toggle('selected');
            });
        });

        const leftSubmitButton = leftArea.querySelector('.submit-button');
        leftSubmitButton.addEventListener('click', () => {
            const selectedButtons = leftArea.querySelectorAll('.number-button.selected');

            selectedButtons.forEach(button => {
                const number = parseInt(button.dataset.number) - 1;
                voteData[number]++;
                button.classList.remove('selected');
            });

            updateChart();
        });
        
        // 添加标题点击事件，切换排序状态
        const sortButton = document.getElementById('sortButton');
        sortButton.addEventListener('click', () => {
            isSorted = !isSorted;
            
            // 更新按钮文本显示当前状态
            if (isSorted) {
                sortButton.textContent = '全班投票小工具 📊 (已排序)';
                sortButton.style.backgroundColor = '#e74c3c';
            } else {
                sortButton.textContent = '全班投票小工具 📊';
                sortButton.style.backgroundColor = '#3498db';
            }
            
            // 更新图表
            updateChart();
        });

        // 为右侧投票区域添加事件监听
        const rightNumberButtons = rightArea.querySelectorAll('.number-button');
        rightNumberButtons.forEach(button => {
            button.addEventListener('click', () => {
                button.classList.toggle('selected');
            });
        });

        const rightSubmitButton = rightArea.querySelector('.submit-button');
        rightSubmitButton.addEventListener('click', () => {
            const selectedButtons = rightArea.querySelectorAll('.number-button.selected');

            selectedButtons.forEach(button => {
                const number = parseInt(button.dataset.number) - 1;
                voteData[number]++;
                button.classList.remove('selected');
            });

            updateChart();
        });
    </script>
</body>
</html>