<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å…¨ç­æŠ•ç¥¨å°å·¥å…·</title>
    <style>
        body {
            font-family: 'Microsoft YaHei', sans-serif;
            max-width: 1260px;
            margin: 0 auto;
            padding: 5px;
            background-color: #f5f5f5;
            height: 100vh;
            display: flex;
            flex-direction: column;
            justify-content: center;
            /* ç¦ç”¨è§¦æ‘¸å±åŒå‡»ç¼©æ”¾ */
            touch-action: manipulation;
            /* ç¦ç”¨é•¿æŒ‰é€‰æ‹©æ–‡æœ¬ */
            -webkit-user-select: none;
            -moz-user-select: none;
            -ms-user-select: none;
            user-select: none;
            /* ç¦ç”¨é•¿æŒ‰å³é”®èœå• */
            -webkit-touch-callout: none;
        }
        .main-container {
            display: grid;
            grid-template-columns: 1fr 2fr 1fr;
            gap: 20px;
            height: 80vh;
            align-items: center;
        }
        .chart-container {
            background-color: white;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            grid-column: 2;
            min-height:600px;
        }
        .voting-areas {
            display: flex;
            flex-direction: column;
            gap: 20px;
        }
        .voting-area {
            background-color: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            flex: 1;
        }
        .number-buttons {
            display: grid;
            grid-template-columns: repeat(5, 1fr);
            gap: 8px;
            margin-bottom: 15px;
        }
        .number-button {
            aspect-ratio: 1;
            font-size: 24px;
            border: none;
            border-radius: 4px;
            background-color: #f0f0f0;
            cursor: pointer;
            transition: all 0.3s;
        }
        .number-button:hover {
            background-color: #e0e0e0;
        }
        .number-button.selected {
            background-color: #3498db;
            color: white;
        }
        .submit-button {
            font-size: 24px;
            padding: 5px 10px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            transition: all 0.3s;
            width: 100%;
            background-color: #3498db;
            color: white;
            grid-column: span 5;
        }
        .submit-button:hover {
            background-color: #2980b9;
        }
        h2{
            text-align: center;
            padding: 10px 20px;
            margin: 10px auto;
            background-color: #3498db;
            color: white;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s;
            user-select: none;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        h2:hover {
            background-color: #2980b9;
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0,0,0,0.2);
        }
        h2:active {
            transform: translateY(0);
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
    </style>
</head>
<body>
    <h2 id="sortButton">å…¨ç­æŠ•ç¥¨å°å·¥å…· ğŸ“Š</h2>
    <div class="main-container">
        <div class="voting-areas" id="leftVoting">
            <!-- å·¦ä¾§æŠ•ç¥¨åŒºåŸŸ -->
        </div>
        <div class="chart-container" id="voteChart"></div>
        <div class="voting-areas" id="rightVoting">
            <!-- å³ä¾§æŠ•ç¥¨åŒºåŸŸ -->
        </div>
    </div>
    <script src="echarts.min.js"></script>
    
    <script>
        // ç¦ç”¨è§¦æ‘¸å±åŒå‡»å’Œé•¿æŒ‰äº‹ä»¶
        document.addEventListener('DOMContentLoaded', function() {
            // ç¦ç”¨åŒå‡»äº‹ä»¶
            document.addEventListener('dblclick', function(e) {
                e.preventDefault();
                e.stopPropagation();
            }, { passive: false });
            
            // ç¦ç”¨é•¿æŒ‰äº‹ä»¶ï¼ˆcontextmenuï¼‰
            document.addEventListener('contextmenu', function(e) {
                e.preventDefault();
                e.stopPropagation();
            }, { passive: false });
            
            // ç¦ç”¨è§¦æ‘¸é•¿æŒ‰äº‹ä»¶
            let touchTimer = null;
            document.addEventListener('touchstart', function(e) {
                touchTimer = setTimeout(function() {
                    e.preventDefault();
                    e.stopPropagation();
                }, 500);
            }, { passive: false });
            
            document.addEventListener('touchend', function(e) {
                if (touchTimer) {
                    clearTimeout(touchTimer);
                    touchTimer = null;
                }
            }, { passive: false });
            
            document.addEventListener('touchmove', function(e) {
                if (touchTimer) {
                    clearTimeout(touchTimer);
                    touchTimer = null;
                }
            }, { passive: false });
        });
        
        // åˆå§‹åŒ–æŠ•ç¥¨æ•°æ®ï¼Œ45ä¸ªå­¦å·å¯¹åº”çš„ç¥¨æ•°
        const voteData = Array(50).fill(0);
        
        // æ’åºçŠ¶æ€ï¼šfalseä¸ºé»˜è®¤é¡ºåºï¼Œtrueä¸ºæŒ‰ç¥¨æ•°ä»é«˜åˆ°ä½æ’åº
        let isSorted = false;

        // åˆ›å»ºå›¾è¡¨
        const chartDom = document.getElementById('voteChart');
        const myChart = echarts.init(chartDom);
        
        // é…ç½®å›¾è¡¨é€‰é¡¹
        const option = {
            tooltip: {
                trigger: 'axis',
                axisPointer: {
                    type: 'shadow'
                }
            },
            grid: {
                left: '5%',
                top: '10%',
                right: '10%',
                bottom: '5%',
                containLabel: true
            },
            xAxis: [
                {
                    type: 'category',
                    data: [],
                    axisTick: {
                        alignWithLabel: true
                    },
                    axisLabel: {
                        fontSize: 16
                    },
                    axisLine: {
                        show: true,
                        lineStyle: {
                            width: 2
                        },
                        symbol: ['none', 'arrow'],
                        symbolSize: [10, 15],
                        symbolOffset: [15, 0]
                    },
                    name: 'å­¦å·',
                    nameLocation: 'end',
                    nameTextStyle: {
                        fontSize: 18,
                        padding: [5, 0, 0, 0]
                    }
                }
            ],
            yAxis: [
                {
                    type: 'value',
                    minInterval: 1,
                    interval: 1,
                    max: function(value) {
                        return value.max > 5 ? value.max : 5;
                    },
                    axisLabel: {
                        fontSize: 18
                    },
                    axisLine: {
                        show: true,
                        lineStyle: {
                            width: 2
                        },
                        symbol: ['none', 'arrow'],
                        symbolSize: [10, 15],
                        symbolOffset: [0, 15]
                    },
                    name: 'ç¥¨',
                    nameLocation: 'end',
                    nameTextStyle: {
                        fontSize: 18,
                        padding: [0, 0, 5, 0]
                    }
                }
            ],
            series: [
                {
                    type: 'bar',
                    barWidth: '60%',
                    data: [],
                    itemStyle: {
                        color: '#3498db'
                    }
                }
            ]
        };
        
        // ä½¿ç”¨é…ç½®é¡¹æ˜¾ç¤ºå›¾è¡¨
        myChart.setOption(option);

        // æ›´æ–°å›¾è¡¨æ•°æ®çš„å‡½æ•°
        function updateChart() {
            const nonZeroData = [];
            const nonZeroLabels = [];
            
            // æ”¶é›†éé›¶æ•°æ®
            const dataWithIndex = [];
            voteData.forEach((count, index) => {
                if (count > 0) {
                    dataWithIndex.push({
                        count: count,
                        label: `${index + 1}`,
                        index: index
                    });
                }
            });
            
            // æ ¹æ®æ’åºçŠ¶æ€å†³å®šæ˜¯å¦æ’åº
            if (isSorted) {
                dataWithIndex.sort((a, b) => b.count - a.count);
            }
            
            // æå–æ’åºåçš„æ•°æ®å’Œæ ‡ç­¾
            dataWithIndex.forEach(item => {
                nonZeroData.push(item.count);
                nonZeroLabels.push(item.label);
            });
            
            myChart.setOption({
                xAxis: [{
                    data: nonZeroLabels
                }],
                series: [{
                    data: nonZeroData
                }]
            });
        }

        // åˆ›å»ºæŠ•ç¥¨åŒºåŸŸ
        const leftVoting = document.getElementById('leftVoting');
        const rightVoting = document.getElementById('rightVoting');
        
        // åˆ›å»ºå·¦ä¾§æŠ•ç¥¨åŒºåŸŸï¼ˆå­¦å·1-45ï¼‰
        const leftArea = document.createElement('div');
        leftArea.className = 'voting-area';
        leftArea.innerHTML = `
            <div class="number-buttons">
                ${Array.from({length: 50}, (_, i) => `
                    <button class="number-button" data-number="${i + 1}">${i + 1}</button>
                `).join('')}
                <button class="submit-button">ç¡®è®¤</button>
            </div>
        `;
        leftVoting.appendChild(leftArea);

        // åˆ›å»ºå³ä¾§æŠ•ç¥¨åŒºåŸŸï¼ˆå­¦å·1-45ï¼‰
        const rightArea = document.createElement('div');
        rightArea.className = 'voting-area';
        rightArea.innerHTML = `
            <div class="number-buttons">
                ${Array.from({length: 50}, (_, i) => `
                    <button class="number-button" data-number="${i + 1}">${i + 1}</button>
                `).join('')}
                <button class="submit-button">ç¡®è®¤</button>
            </div>
        `;
        rightVoting.appendChild(rightArea);

        // ä¸ºå·¦ä¾§æŠ•ç¥¨åŒºåŸŸæ·»åŠ äº‹ä»¶ç›‘å¬
        const leftNumberButtons = leftArea.querySelectorAll('.number-button');
        leftNumberButtons.forEach(button => {
            button.addEventListener('click', () => {
                button.classList.toggle('selected');
            });
        });

        const leftSubmitButton = leftArea.querySelector('.submit-button');
        leftSubmitButton.addEventListener('click', () => {
            const selectedButtons = leftArea.querySelectorAll('.number-button.selected');

            selectedButtons.forEach(button => {
                const number = parseInt(button.dataset.number) - 1;
                voteData[number]++;
                button.classList.remove('selected');
            });

            updateChart();
        });
        
        // æ·»åŠ æ ‡é¢˜ç‚¹å‡»äº‹ä»¶ï¼Œåˆ‡æ¢æ’åºçŠ¶æ€
        const sortButton = document.getElementById('sortButton');
        sortButton.addEventListener('click', () => {
            isSorted = !isSorted;
            
            // æ›´æ–°æŒ‰é’®æ–‡æœ¬æ˜¾ç¤ºå½“å‰çŠ¶æ€
            if (isSorted) {
                sortButton.textContent = 'å…¨ç­æŠ•ç¥¨å°å·¥å…· ğŸ“Š (å·²æ’åº)';
                sortButton.style.backgroundColor = '#e74c3c';
            } else {
                sortButton.textContent = 'å…¨ç­æŠ•ç¥¨å°å·¥å…· ğŸ“Š';
                sortButton.style.backgroundColor = '#3498db';
            }
            
            // æ›´æ–°å›¾è¡¨
            updateChart();
        });

        // ä¸ºå³ä¾§æŠ•ç¥¨åŒºåŸŸæ·»åŠ äº‹ä»¶ç›‘å¬
        const rightNumberButtons = rightArea.querySelectorAll('.number-button');
        rightNumberButtons.forEach(button => {
            button.addEventListener('click', () => {
                button.classList.toggle('selected');
            });
        });

        const rightSubmitButton = rightArea.querySelector('.submit-button');
        rightSubmitButton.addEventListener('click', () => {
            const selectedButtons = rightArea.querySelectorAll('.number-button.selected');

            selectedButtons.forEach(button => {
                const number = parseInt(button.dataset.number) - 1;
                voteData[number]++;
                button.classList.remove('selected');
            });

            updateChart();
        });
    </script>
</body>
</html>