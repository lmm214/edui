<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>1998—2021年全国总人口数统计图</title>
    <style>
        .vote-table {
            width: 100%;
            border-collapse: collapse;
            margin-bottom: 20px;
            background-color: white;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            overflow: hidden;
        }
        .vote-table th, .vote-table td {
            border: 1px solid #e0e0e0;
            padding: 5px;
            text-align: center;
            font-size: 18px;
            height: 30px;
            line-height: 30px;
            white-space: nowrap;  /* 确保单元格内容不换行 */
        }
        .vote-table th {
            background-color: #3498db;
            color: white;
        }
        .vote-table td.selected {
            background-color: #e8f4fc;
        }
        body {
            font-family: 'Microsoft YaHei', sans-serif;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f5f5f5;
            min-height: calc(100vh - 45px);
            display: flex;
            flex-direction: column;
        }
        .chart-container {
            background-color: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            flex: 1;
            min-height: 300px;
            max-height: 600px;
        }
        h2 {
            text-align: center;
            padding: 0;
            margin: 10px auto;
        }
    </style>
</head>
<body>
    <h2>1998—2021年全国总人口数统计表</h2>
    <table class="vote-table">
        <tr>
            <th>年份</th>
            <th>1998</th>
            <th>1999</th>
            <th>2000</th>
            <th>2001</th>
            <th>2002</th>
            <th>2003</th>
            <th>2004</th>
            <th>2005</th>
            <th>2006</th>
            <th>2007</th>
            <th>2008</th>
            <th>2009</th>
        </tr>
        <tr>
            <td>总人口数/万人</td>
            <td>124761</td>
            <td>125786</td>
            <td>126743</td>
            <td>127627</td>
            <td>128453</td>
            <td>129227</td>
            <td>129988</td>
            <td>130756</td>
            <td>131448</td>
            <td>132129</td>
            <td>132802</td>
            <td>133450</td>
        </tr>
        <tr>
            <th>年份</th>
            <th>2010</th>
            <th>2011</th>
            <th>2012</th>
            <th>2013</th>
            <th>2014</th>
            <th>2015</th>
            <th>2016</th>
            <th>2017</th>
            <th>2018</th>
            <th>2019</th>
            <th>2020</th>
            <th>2021</th>
        </tr>
        <tr>
            <td>总人口数/万人</td>
            <td>134091</td>
            <td>134916</td>
            <td>135922</td>
            <td>136726</td>
            <td>137646</td>
            <td>138326</td>
            <td>139232</td>
            <td>140011</td>
            <td>140541</td>
            <td>141008</td>
            <td>141212</td>
            <td>141260</td>
        </tr>
    </table>
    <div class="chart-container" id="voteChart"></div>

    <script src="https://lf26-cdn-tos.bytecdntp.com/cdn/expire-1-M/echarts/5.3.0/echarts.min.js" type="application/javascript"></script>
    <script>
        // 创建图表
        const chartDom = document.getElementById('voteChart');
        const myChart = echarts.init(chartDom);
        
        // 基础数据
        const years = ['1998', '1999', '2000', '2001', '2002', '2003', '2004', '2005', '2006', '2007', '2008', '2009',
                      '2010', '2011', '2012', '2013', '2014', '2015', '2016', '2017', '2018', '2019', '2020', '2021'];
        const population = [124761, 125786, 126743, 127627, 128453, 129227, 129988, 130756, 131448, 132129, 132802, 133450,
                          134091, 134916, 135922, 136726, 137646, 138326, 139232, 140011, 140541, 141008, 141212, 141260];

        // 图表配置生成函数
        function getChartOption(type = 'bar') {
            return {
                title: {
                    text: '1998—2021年全国总人口数统计图',
                    left: 'center',
                    textStyle: {
                        fontSize: 22
                    }
                },
                tooltip: {
                    trigger: 'axis',
                    formatter: function(params) {
                        return `${params[0].axisValue}年<br/>${params[0].value}万人`;
                    }
                },
                grid: {
                    left: '2%',
                    right: '5%',
                    bottom: '0%',
                    top: '10%',
                    containLabel: true
                },
                xAxis: {
                    type: 'category',
                    data: years,
                    name: '年份',
                    nameLocation: 'end',
                    nameGap: 15,
                    nameTextStyle: {
                        fontSize: 16,
                        align: 'end',
                        padding: [0, 0, 20, 0]
                    },
                    axisLabel: {
                        fontSize: 20,
                        rotate: 60,
                    },
                    axisTick: {
                        show: false  // 隐藏刻度
                    },
                    axisLine: {
                        lineStyle: {
                            width: 2
                        },
                        symbol: ['none', 'arrow'],
                        symbolOffset:[0,10],
                        symbolSize: [8, 12]
                    }
                },
                yAxis: {
                    type: 'value',
                    name: '人口数/万人',
                    nameLocation: 'end',
                    nameGap: 15,
                    nameTextStyle: {
                        fontSize: 18,
                        align: 'center',
                        padding: [0, 0, 20, 0]
                    },
                    min: 115000,
                    max: 145000,
                    axisLine: {
                        show: true,
                        lineStyle: {
                            width: 2
                        },
                        symbol: ['none', 'arrow'],
                        symbolOffset:[0,0],
                        symbolSize: [8, 12]
                    },
                    splitLine: {
                        show: true,
                        lineStyle: {
                            type: 'dashed'
                        }
                    },
                    splitArea: {
                        show: true
                    },
                    axisLabel: {
                        fontSize: 18,
                        formatter: function(value) {
                            const values = [120000, 125000, 130000, 135000, 140000, 145000, 150000];
                            if (values.includes(value)) return value.toString();
                            if (value === 115000) return '0';
                            return '';
                        }
                    },
                    axisTick: {
                        length: 6,
                        lineStyle: {
                            type: 'dashed'
                        }
                    },
                    interval: 5000
                },
                series: [{
                    data: population,
                    type: type,
                    itemStyle: {
                        color: '#87CEEB'
                    },
                    symbolSize: 8,
                    symbol: 'circle',
                    showSymbol: true,
                    barCategoryGap: '50%',  // 类目间距
                    emphasis: {
                        focus: 'series'
                    },
                    ...(type === 'line' ? {
                        smooth: true,
                        lineStyle: {
                            width: 3,
                            opacity: 0
                        },
                        animation: true,
                        animationDuration: 6000,
                        animationDelay: function (idx) {
                            return window.showLineAnimation ? idx * 100 : 0;
                        }
                    } : {
                        animation: true,
                        animationDuration: 1000
                    })
                }]
            };
        }

        // 初始显示条形图
        myChart.setOption(getChartOption('bar'));

        // 添加图表点击事件
        myChart.on('click', function(params) {
            if (currentChartType === 'bar') {
                const clickedIndex = params.dataIndex;
                const currentOption = myChart.getOption();
                
                // 获取当前显示的所有数据点
                let currentLineData = currentOption.series.find(s => s.type === 'line')?.data || 
                    Array(population.length).fill('-');
                
                // 获取当前显示的条形图数据
                let currentBarData = currentOption.series.find(s => s.type === 'bar')?.data || 
                    [...population];

                // 更新数据：添加新的数据点，保持已有的数据点
                currentLineData[clickedIndex] = population[clickedIndex];
                
                const option = {
                    ...getChartOption('bar'),
                    series: [
                        // 条形图
                        {
                            ...getChartOption('bar').series[0],
                            data: currentBarData,
                            z: 1
                        },
                        // 折线图数据点
                        {
                            type: 'line',
                            data: currentLineData,
                            itemStyle: {
                                color: '#FF6B6B'
                            },
                            symbolSize: 8,
                            symbol: 'circle',
                            showSymbol: true,
                            lineStyle: {
                                width: 0  // 设置线宽为0，相当于隐藏连线
                            },
                            z: 2
                        }
                    ]
                };
                myChart.setOption(option);

                // 500ms后隐藏点击的条形
                setTimeout(() => {
                    currentBarData[clickedIndex] = '-';
                    option.series[0].data = currentBarData;
                    myChart.setOption(option);
                }, 800);
            }
        });

        // 添加标题点击事件
        let currentChartType = 'bar';
        window.showLineAnimation = false;  // 添加全局控制变量
        document.querySelector('h2').addEventListener('click', () => {
            if (currentChartType === 'bar') {
                window.showLineAnimation = false;  // 重置动画控制
                // 步骤1：同时显示条形图和折线图的数据点
                const option = {
                    ...getChartOption('bar'),
                    series: [
                        // 条形图
                        {
                            ...getChartOption('bar').series[0],
                            z: 1,
                            itemStyle: {
                                color: '#87CEEB'  // 浅蓝色
                            }
                        },
                        // 折线图数据点
                        {
                            ...getChartOption('line').series[0],
                            lineStyle: {
                                opacity: 0,
                                color: '#FF6B6B'  // 红色
                            },
                            itemStyle: {
                                color: '#FF6B6B'  // 红色
                            },
                            z: 2
                        }
                    ]
                };
                myChart.setOption(option);

                // 步骤2：1.5s后隐藏条形图
                setTimeout(() => {
                    option.series = [option.series[1]];
                    myChart.setOption(option);

                    // 步骤3：再过500ms后显示连线
                    setTimeout(() => {
                        window.showLineAnimation = true;  // 启用连线动画
                        option.series[0].lineStyle.opacity = 1;
                        myChart.setOption(option);
                    }, 500);
                }, 1000);

                currentChartType = 'line';
            } else {
                window.showLineAnimation = false;  // 重置动画控制
                // 切换回条形图
                myChart.setOption(getChartOption('bar'));
                currentChartType = 'bar';
            }
        });

        // 设置标题鼠标样式为可点击
        document.querySelector('h2').style.cursor = 'pointer';

        // 响应窗口大小变化
        window.addEventListener('resize', () => {
            myChart.resize();
        });
    </script>
</body>
</html>