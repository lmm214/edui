<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ğŸ¤–ç¥ç§˜çš„æœºå™¨äºº</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'SF Pro Display', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            height: 100vh;
            overflow: hidden;
            background-color: #DCD9D4; background-image: linear-gradient(to bottom, rgba(255,255,255,0.50) 0%, rgba(0,0,0,0.50) 100%), radial-gradient(at 50% 0%, rgba(255,255,255,0.10) 0%, rgba(0,0,0,0.50) 50%); background-blend-mode: soft-light,screen;
        }

        .container {
            display: flex;
            height: 100vh;
            width: 100vw;
        }

        .left-section {
            width: 66.67%;
            display: flex;
            justify-content: right;
            align-items: center;
            position: relative;
        }

        .right-section {
            width: 33.33%;
            padding: 20px;
        }

        .image-container {
            position: relative;
            display: inline-block;
        }

        .robot-image {
            max-width: 100%;
            max-height: 80vh;
            width: auto;
            height: auto;
            transition: transform 0.3s ease;
        }

        .robot-image.animate {
            animation: robotDance 1s ease-in-out;
        }

        @keyframes robotDance {
            0%, 100% { 
                transform: rotate(0deg) translateY(0px) scale(1); 
            }
            10% { 
                transform: rotate(5deg) translateY(-15px) scale(1.05); 
            }
            20% { 
                transform: rotate(-8deg) translateY(10px) scale(0.95); 
            }
            30% { 
                transform: rotate(6deg) translateY(-20px) scale(1.08); 
            }
            40% { 
                transform: rotate(-10deg) translateY(15px) scale(0.92); 
            }
            50% { 
                transform: rotate(8deg) translateY(-25px) scale(1.1); 
            }
            60% { 
                transform: rotate(-12deg) translateY(20px) scale(0.9); 
            }
            70% { 
                transform: rotate(10deg) translateY(-18px) scale(1.06); 
            }
            80% { 
                transform: rotate(-6deg) translateY(12px) scale(0.96); 
            }
            90% { 
                transform: rotate(4deg) translateY(-8px) scale(1.02); 
            }
        }

        @keyframes robotSpin {
            0% { 
                transform: rotate(0deg); 
            }
            100% { 
                transform: rotate(720deg); 
            }
        }

        .robot-image.spin {
            animation: robotSpin 0.8s ease-in-out;
        }

        .input-box {
            position: absolute;
            width: 140px;
            height: 80px;
            border: 2px solid rgba(255, 255, 255, 0.3);
            border-radius: 20px;
            background: rgba(255, 255, 255, 0.15);
            backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px);
            text-align: center;
            font-size: 48px;
            font-weight: 700;
            color: #333;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 
                0 8px 32px rgba(0,0,0,0.1),
                inset 0 1px 0 rgba(255,255,255,0.5),
                inset 0 -1px 0 rgba(255,255,255,0.2);
        }

        .input-box:hover {
            background: rgba(255, 255, 255, 0.25);
            border-color: rgba(255, 255, 255, 0.5);
            transform: scale(1.05);
            box-shadow: 
                0 12px 40px rgba(0,0,0,0.15),
                inset 0 1px 0 rgba(255,255,255,0.6),
                inset 0 -1px 0 rgba(255,255,255,0.3);
        }

        .top-left-input {
            top: -15px;
            left: -40px;
        }

        .bottom-right-input {
            bottom: 30px;
            right: 15px;
            background: rgba(102, 126, 234, 0.15);
            border-color: rgba(102, 126, 234, 0.3);
            color: #667eea;
        }

        .bottom-right-input:hover {
            background: rgba(102, 126, 234, 0.25);
            border-color: rgba(102, 126, 234, 0.5);
        }

        .records-section {
            margin-top: 20px;
        }

        .records-title {
            color: #333;
            font-size: 24px;
            font-weight: 700;
            margin-bottom: 15px;
            text-align: center;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .records-table {
            width: 100%;
            border-collapse: collapse;
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px);
            border-radius: 15px;
            overflow: hidden;
            border: 1px solid rgba(255, 255, 255, 0.2);
            box-shadow: 
                0 8px 32px rgba(0,0,0,0.1),
                inset 0 1px 0 rgba(255,255,255,0.3),
                inset 0 -1px 0 rgba(255,255,255,0.1);
        }

        .records-table th {
            background: rgba(102, 126, 234, 0.2);
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
            color: #333;
            padding: 12px 8px;
            font-size: 24px;
            text-align: center;
            border-bottom: 1px solid rgba(255, 255, 255, 0.2);
            font-weight: 700;
        }

        .records-table td {
            font-size: 50px;
            padding: 10px 8px;
            text-align: center;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
            font-weight: 500;
            color: #333;
            background: rgba(255, 255, 255, 0.05);
        }

        .records-table tr:nth-child(even) td {
            background: rgba(255, 255, 255, 0.1);
        }

        .records-table tr:hover td {
            background: rgba(102, 126, 234, 0.15);
            backdrop-filter: blur(5px);
            -webkit-backdrop-filter: blur(5px);
        }

        /* æ“ä½œç±»å‹é¢œè‰²æ ‡è¯† */
        .operation-indicator {
            display: inline-block;
            width: 18px;
            height: 18px;
            border-radius: 50%;
            margin-right: 8px;
            vertical-align: middle;
        }

        .operation-add30 {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            box-shadow: 0 2px 4px rgba(102, 126, 234, 0.3);
        }

        .operation-multiply4 {
            background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
            box-shadow: 0 2px 4px rgba(240, 147, 251, 0.3);
        }

        .operation-custom {
            background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
            box-shadow: 0 2px 4px rgba(79, 172, 254, 0.3);
        }

        .keyboard-overlay {
            position: absolute;
            display: none;
            z-index: 1000;
        }

        .keyboard {
            background: rgba(255, 255, 255, 0.15);
            backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px);
            border-radius: 20px;
            padding: 15px;
            border: 1px solid rgba(255, 255, 255, 0.3);
            box-shadow: 
                0 15px 35px rgba(0,0,0,0.15),
                inset 0 1px 0 rgba(255,255,255,0.3),
                inset 0 -1px 0 rgba(255,255,255,0.1);
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 8px;
            width: 240px;
        }

        .key {
            width: 60px;
            height: 50px;
            border: none;
            border-radius: 12px;
            background: rgba(255, 255, 255, 0.2);
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
            font-size: 24px;
            cursor: pointer;
            transition: all 0.2s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            color: #333;
            border: 1px solid rgba(255, 255, 255, 0.2);
            box-shadow: 
                0 3px 10px rgba(0,0,0,0.1),
                inset 0 1px 0 rgba(255,255,255,0.4);
        }

        .key:hover {
            background: rgba(255, 255, 255, 0.3);
            transform: translateY(-1px);
            box-shadow: 
                0 5px 15px rgba(0,0,0,0.15),
                inset 0 1px 0 rgba(255,255,255,0.5);
        }

        .key:active {
            transform: translateY(0);
            box-shadow: 
                0 2px 5px rgba(0,0,0,0.1),
                inset 0 1px 0 rgba(255,255,255,0.3);
        }

        .key.confirm {
            background: rgba(102, 126, 234, 0.3);
            border-color: rgba(102, 126, 234, 0.4);
            color: #667eea;
        }

        .key.confirm:hover {
            background: rgba(102, 126, 234, 0.4);
        }

        .key.clear {
            background: rgba(255, 107, 107, 0.3);
            border-color: rgba(255, 107, 107, 0.4);
            color: #ff6b6b;
        }

        .key.clear:hover {
            background: rgba(255, 107, 107, 0.4);
        }

        /* å·¦ä¸‹è§’åœ†å½¢æŒ‰é’®æ ·å¼ */
        .operation-buttons {
            position: fixed;
            bottom: 30px;
            left: 30px;
            display: flex;
            flex-direction: column;
            gap: 15px;
            z-index: 100;
        }

        .operation-btn {
            width: 60px;
            height: 60px;
            border-radius: 50%;
            border: 3px solid rgba(255, 255, 255, 0.3);
            cursor: pointer;
            font-size: 0; /* éšè—æ–‡å­—å†…å®¹ */
            font-weight: bold;
            color: transparent; /* æ–‡å­—é€æ˜ */
            transition: all 0.3s ease;
            box-shadow: 
                0 4px 15px rgba(0,0,0,0.2),
                inset 0 2px 4px rgba(255,255,255,0.3),
                inset 0 -2px 4px rgba(0,0,0,0.2);
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
            display: flex;
            align-items: center;
            justify-content: center;
            position: relative;
            opacity: 0.5;
        }

        .operation-btn:hover {
            opacity: 0.8;
            transform: scale(1.1);
            box-shadow: 
                0 6px 20px rgba(0,0,0,0.3),
                inset 0 2px 4px rgba(255,255,255,0.4),
                inset 0 -2px 4px rgba(0,0,0,0.3);
        }

        .operation-btn:active {
            transform: scale(0.95);
            box-shadow: 
                0 2px 10px rgba(0,0,0,0.2),
                inset 0 1px 2px rgba(255,255,255,0.2),
                inset 0 -1px 2px rgba(0,0,0,0.4);
        }

        .operation-btn.selected {
            opacity: 1;
            width: 75px;
            height: 75px;
            border: 4px solid rgba(255, 255, 255, 0.6);
            box-shadow: 
                0 8px 25px rgba(0,0,0,0.4),
                inset 0 3px 6px rgba(255,255,255,0.4),
                inset 0 -3px 6px rgba(0,0,0,0.3),
                0 0 0 2px rgba(255,255,255,0.2);
        }

        .btn-add30 {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }

        .btn-add30:hover {
            background: linear-gradient(135deg, #5a6fd8 0%, #6a4190 100%);
        }

        .btn-multiply4 {
            background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
        }

        .btn-multiply4:hover {
            background: linear-gradient(135deg, #e081e9 0%, #e3455a 100%);
        }

        .btn-custom {
            background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
        }

        .btn-custom:hover {
            background: linear-gradient(135deg, #3d9aec 0%, #00e0ec 100%);
        }

        /* è‡ªå®šä¹‰è¿ç®—å¼¹çª—æ ·å¼ */
        .custom-operation-modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            backdrop-filter: blur(5px);
            -webkit-backdrop-filter: blur(5px);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 1001;
        }

        .modal-content {
            background: rgba(255, 255, 255, 0.5);
            backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px);
            border-radius: 20px;
            padding: 30px;
            border: 1px solid rgba(255, 255, 255, 0.3);
            box-shadow: 0 15px 35px rgba(0,0,0,0.15);
            text-align: center;
            min-width: 300px;
        }

        .modal-title {
            color: #333;
            font-size: 24px;
            font-weight: 700;
            margin-bottom: 20px;
        }

        .operation-input {
            width: 100%;
            padding: 12px;
            border: 2px solid rgba(255, 255, 255, 0.3);
            border-radius: 10px;
            background: rgba(255, 255, 255, 0.2);
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
            color: #333;
            font-size: 16px;
            text-align: center;
            outline: none;
            margin-bottom: 20px;
        }

        .operation-input:focus {
            border-color: #667eea;
            box-shadow: 0 0 10px rgba(102, 126, 234, 0.3);
        }

        /* è‡ªå®šä¹‰è¿ç®—é”®ç›˜æ ·å¼ */
        .custom-keyboard {
            margin: 20px 0;
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        .custom-keyboard-row {
            display: flex;
            gap: 8px;
            justify-content: center;
        }

        .custom-key {
            width: 60px;
            height: 60px;
            border: none;
            border-radius: 8px;
            font-size: 24px;
            cursor: pointer;
            transition: all 0.2s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            border: 1px solid rgba(255, 255, 255, 0.2);
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }

        .custom-key:hover {
            transform: translateY(-1px);
            box-shadow: 0 4px 8px rgba(0,0,0,0.15);
        }

        .custom-key:active {
            transform: translateY(0);
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
        }

        .custom-key.operator {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }

        .custom-key.operator:hover {
            background: linear-gradient(135deg, #5a6fd8 0%, #6a4190 100%);
        }

        .custom-key.number {
            background: rgba(255, 255, 255, 0.2);
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
            color: #333;
        }

        .custom-key.number:hover {
            background: rgba(255, 255, 255, 0.3);
        }

        .custom-key.clear {
            background: rgba(255, 107, 107, 0.3);
            color: #ff6b6b;
        }

        .custom-key.clear:hover {
            background: rgba(255, 107, 107, 0.4);
        }

        .custom-key.backspace {
            background: rgba(255, 193, 7, 0.3);
            color: #ffc107;
        }

        .custom-key.backspace:hover {
            background: rgba(255, 193, 7, 0.4);
        }

        .modal-buttons {
            display: flex;
            gap: 15px;
            justify-content: center;
        }

        .modal-btn {
            padding: 10px 20px;
            border: none;
            border-radius: 10px;
            cursor: pointer;
            font-size: 16px;
            font-weight: 600;
            transition: all 0.3s ease;
        }

        .modal-btn.confirm {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }

        .modal-btn.confirm:hover {
            background: linear-gradient(135deg, #5a6fd8 0%, #6a4190 100%);
            transform: translateY(-1px);
        }

        .modal-btn.cancel {
            background: rgba(255, 255, 255, 0.3);
            color: #333;
            border: 1px solid rgba(255, 255, 255, 0.5);
        }

        .modal-btn.cancel:hover {
            background: rgba(255, 255, 255, 0.4);
            transform: translateY(-1px);
        }

        .display {
            grid-column: span 3;
            background: linear-gradient(135deg, #333 0%, #555 100%);
            color: white;
            font-size: 28px;
            font-weight: 600;
            padding: 10px;
            text-align: center;
            border-radius: 15px;
            margin-bottom: 15px;
            min-height: 70px;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: inset 0 2px 10px rgba(0,0,0,0.3);
        }

        @media (max-width: 768px) {
            .container {
                flex-direction: column;
            }
            
            .left-section, .right-section {
                width: 100%;
            }
            
            .left-section {
                height: 50vh;
            }
            
            .right-section {
                height: 50vh;
            }
            
            .robot-image {
                max-height: 60vh;
            }
            .top-left-input{left:10px;top:-35px;}
            .bottom-right-input{right: 10px;bottom:5px;}
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="left-section">
            <div class="image-container">
                <img src="jqr.png" alt="JQR Robot" class="robot-image" id="robotImage">
                <div class="input-box top-left-input" id="topLeftInput"></div>
                <div class="input-box bottom-right-input" id="bottomRightInput"></div>
            </div>
        </div>
        <div class="right-section">
            <div class="records-section">
                <table class="records-table" id="recordsTable">
                    <thead>
                        <tr>
                            <th></th>
                            <th>å…¥å£</th>
                            <th>å‡ºå£</th>
                        </tr>
                    </thead>
                    <tbody id="recordsBody">
                        <!-- è®°å½•å°†åŠ¨æ€æ·»åŠ åˆ°è¿™é‡Œ -->
                    </tbody>
                </table>
            </div>
        </div>
    </div>

    <!-- å·¦ä¸‹è§’æ“ä½œæŒ‰é’® -->
    <div class="operation-buttons">
        <button class="operation-btn btn-add30" id="btnAdd30" title="è¾“å…¥+30">+30</button>
        <button class="operation-btn btn-multiply4" id="btnMultiply4" title="è¾“å…¥Ã—4">Ã—4</button>
        <button class="operation-btn btn-custom" id="btnCustom" title="è‡ªå®šä¹‰è¿ç®—">?</button>
    </div>

    <div class="keyboard-overlay" id="keyboardOverlay">
        <div class="keyboard">
            <div class="display" id="display">0</div>
            <button class="key" onclick="inputNumber(7)">7</button>
            <button class="key" onclick="inputNumber(8)">8</button>
            <button class="key" onclick="inputNumber(9)">9</button>
            <button class="key" onclick="inputNumber(4)">4</button>
            <button class="key" onclick="inputNumber(5)">5</button>
            <button class="key" onclick="inputNumber(6)">6</button>
            <button class="key" onclick="inputNumber(1)">1</button>
            <button class="key" onclick="inputNumber(2)">2</button>
            <button class="key" onclick="inputNumber(3)">3</button>
            <button class="key" onclick="inputNumber(0)">0</button>
            <button class="key clear" onclick="clearInput()">æ¸…é™¤</button>
            <button class="key confirm" onclick="confirmInput()">ç¡®è®¤</button>
        </div>
    </div>

    <!-- è‡ªå®šä¹‰è¿ç®—å¼¹çª— -->
    <div class="custom-operation-modal" id="customModal">
        <div class="modal-content">
            <div class="modal-title">è‡ªå®šä¹‰è¿ç®—</div>
            <input type="text" class="operation-input" id="operationInput" placeholder="ä¾‹å¦‚: +50, *3, -20, /2">
            
            <!-- è‡ªå®šä¹‰è¿ç®—é”®ç›˜ -->
             <div class="custom-keyboard">
                 <div class="custom-keyboard-row">
                     <button class="custom-key operator" onclick="addToCustomInput('+')">+</button>
                     <button class="custom-key operator" onclick="addToCustomInput('-')">-</button>
                     <button class="custom-key operator" onclick="addToCustomInput('*')">Ã—</button>
                     <button class="custom-key operator" onclick="addToCustomInput('/')">/</button>
                 </div>
                 <div class="custom-keyboard-row">
                     <button class="custom-key number" onclick="addToCustomInput('7')">7</button>
                     <button class="custom-key number" onclick="addToCustomInput('8')">8</button>
                     <button class="custom-key number" onclick="addToCustomInput('9')">9</button>
                     <button class="custom-key clear" onclick="clearCustomInput()">æ¸…é™¤</button>
                 </div>
                 <div class="custom-keyboard-row">
                     <button class="custom-key number" onclick="addToCustomInput('4')">4</button>
                     <button class="custom-key number" onclick="addToCustomInput('5')">5</button>
                     <button class="custom-key number" onclick="addToCustomInput('6')">6</button>
                     <button class="custom-key backspace" onclick="backspaceCustomInput()">â†</button>
                 </div>
                 <div class="custom-keyboard-row">
                     <button class="custom-key number" onclick="addToCustomInput('1')">1</button>
                     <button class="custom-key number" onclick="addToCustomInput('2')">2</button>
                     <button class="custom-key number" onclick="addToCustomInput('3')">3</button>
                     <button class="custom-key number" onclick="addToCustomInput('0')">0</button>
                 </div>
             </div>

            <div class="modal-buttons">
                <button class="modal-btn confirm" onclick="confirmCustomOperation()">ç¡®è®¤</button>
                <button class="modal-btn cancel" onclick="closeCustomModal()">å–æ¶ˆ</button>
            </div>
        </div>
    </div>

    <script>
        let currentInput = '';
        let isInputting = false;
        let calculationCount = 0;
        let currentOperation = '+30'; // é»˜è®¤æ“ä½œ

        // è·å–DOMå…ƒç´ 
        const topLeftInput = document.getElementById('topLeftInput');
        const bottomRightInput = document.getElementById('bottomRightInput');
        const keyboardOverlay = document.getElementById('keyboardOverlay');
        const display = document.getElementById('display');
        const robotImage = document.getElementById('robotImage');
        const recordsBody = document.getElementById('recordsBody');
        const btnAdd30 = document.getElementById('btnAdd30');
        const btnMultiply4 = document.getElementById('btnMultiply4');
        const btnCustom = document.getElementById('btnCustom');
        const customModal = document.getElementById('customModal');
        const operationInput = document.getElementById('operationInput');

        // æ“ä½œæŒ‰é’®äº‹ä»¶ç›‘å¬
        btnAdd30.addEventListener('click', function() {
            if (currentOperation !== '+30') {
                triggerRobotSpin();
                currentOperation = '+30';
                updateButtonStyles();
            }
            clearInputBoxes();
        });

        btnMultiply4.addEventListener('click', function() {
            if (currentOperation !== '*4') {
                triggerRobotSpin();
                currentOperation = '*4';
                updateButtonStyles();
            }
            clearInputBoxes();
        });

        btnCustom.addEventListener('click', function() {
            clearInputBoxes();
            showCustomModal();
        });

        // æ¸…ç©ºè¾“å…¥æ¡†å†…å®¹
        function clearInputBoxes() {
            topLeftInput.textContent = '';
            bottomRightInput.textContent = '';
        }

        // è§¦å‘æœºå™¨äººæ—‹è½¬åŠ¨æ•ˆ
        function triggerRobotSpin() {
            robotImage.classList.add('spin');
            setTimeout(() => {
                robotImage.classList.remove('spin');
            }, 800);
        }

        // æ›´æ–°æŒ‰é’®æ ·å¼ä»¥æ˜¾ç¤ºå½“å‰é€‰ä¸­çš„æ“ä½œ
        function updateButtonStyles() {
            // ç§»é™¤æ‰€æœ‰æŒ‰é’®çš„é€‰ä¸­çŠ¶æ€
            btnAdd30.classList.remove('selected');
            btnMultiply4.classList.remove('selected');
            btnCustom.classList.remove('selected');
            
            // ä¸ºå½“å‰æ“ä½œçš„æŒ‰é’®æ·»åŠ é€‰ä¸­çŠ¶æ€
            if (currentOperation === '+30') {
                btnAdd30.classList.add('selected');
            } else if (currentOperation === '*4') {
                btnMultiply4.classList.add('selected');
            } else {
                btnCustom.classList.add('selected');
            }
        }

        // æ˜¾ç¤ºè‡ªå®šä¹‰è¿ç®—å¼¹çª—
        function showCustomModal() {
            customModal.style.display = 'flex';
            operationInput.value = '';
            operationInput.focus();
        }

        // å…³é—­è‡ªå®šä¹‰è¿ç®—å¼¹çª—
        function closeCustomModal() {
            customModal.style.display = 'none';
        }

        // ç¡®è®¤è‡ªå®šä¹‰è¿ç®—
        function confirmCustomOperation() {
            const operation = operationInput.value.trim();
            if (operation && isValidOperation(operation)) {
                if (currentOperation !== operation) {
                    triggerRobotSpin();
                }
                currentOperation = operation;
                updateButtonStyles();
                closeCustomModal();
            } else {
                alert('è¯·è¾“å…¥æœ‰æ•ˆçš„è¿ç®—è¡¨è¾¾å¼ï¼Œä¾‹å¦‚: +50, *3, -20, /2');
            }
        }

        // è‡ªå®šä¹‰é”®ç›˜åŠŸèƒ½å‡½æ•°
        function addToCustomInput(value) {
            const input = document.getElementById('operationInput');
            input.value += value;
            input.focus();
        }

        function clearCustomInput() {
            const input = document.getElementById('operationInput');
            input.value = '';
            input.focus();
        }

        function backspaceCustomInput() {
            const input = document.getElementById('operationInput');
            input.value = input.value.slice(0, -1);
            input.focus();
        }

        // éªŒè¯è¿ç®—è¡¨è¾¾å¼æ˜¯å¦æœ‰æ•ˆ
        function isValidOperation(operation) {
            const pattern = /^[+\-*/]\d+$/;
            return pattern.test(operation);
        }

        // æ‰§è¡Œè¿ç®—
        function performOperation(inputNumber, operation) {
            const operator = operation.charAt(0);
            const operand = parseInt(operation.substring(1));
            
            switch (operator) {
                case '+':
                    return inputNumber + operand;
                case '-':
                    return inputNumber - operand;
                case '*':
                    return inputNumber * operand;
                case '/':
                    return Math.floor(inputNumber / operand);
                default:
                    return inputNumber;
            }
        }

        // ç‚¹å‡»å·¦ä¸Šè§’è¾“å…¥æ¡†æ˜¾ç¤ºé”®ç›˜
        topLeftInput.addEventListener('click', function() {
            if (!isInputting) {
                showKeyboard();
            }
        });

        // ç‚¹å‡»é¡µé¢å…¶ä»–åœ°æ–¹å…³é—­é”®ç›˜
        document.addEventListener('click', function(e) {
            if (!keyboardOverlay.contains(e.target) && e.target !== topLeftInput && isInputting) {
                hideKeyboard();
            }
        });

        function showKeyboard() {
            // è·å–è¾“å…¥æ¡†çš„ä½ç½®
            const rect = topLeftInput.getBoundingClientRect();
            const containerRect = topLeftInput.parentElement.getBoundingClientRect();
            
            // è®¾ç½®é”®ç›˜ä½ç½®åœ¨è¾“å…¥æ¡†ä¸‹æ–¹
            keyboardOverlay.style.display = 'block';
            keyboardOverlay.style.left = (rect.left) + 'px';
            keyboardOverlay.style.top = (rect.bottom + 10) + 'px';
            
            currentInput = '';
            display.textContent = '0';
            isInputting = true;
        }

        function hideKeyboard() {
            keyboardOverlay.style.display = 'none';
            isInputting = false;
        }

        function inputNumber(num) {
            if (currentInput.length < 4) { // é™åˆ¶è¾“å…¥é•¿åº¦
                if (currentInput === '') {
                    currentInput = num.toString();
                } else if (currentInput !== '') {
                    currentInput += num.toString();
                }
                display.textContent = currentInput || '0';
            }
        }

        function clearInput() {
            currentInput = '';
            display.textContent = '0';
        }

        function confirmInput() {
            if (currentInput !== '') {
                const inputNumber = parseInt(currentInput);
                const result = performOperation(inputNumber, currentOperation);
                calculationCount++;
                
                // æ’­æ”¾éŸ³æ•ˆ
                const audio = new Audio('diu.mp3');
                audio.play().catch(e => console.log('éŸ³æ•ˆæ’­æ”¾å¤±è´¥:', e));
                
                // éšè—é”®ç›˜
                hideKeyboard();
                
                // æ›´æ–°å·¦ä¸Šè§’æ˜¾ç¤º
                topLeftInput.textContent = inputNumber;
                
                // å¼€å§‹æœºå™¨äººæ—‹è½¬æ™ƒåŠ¨åŠ¨ç”»
                robotImage.classList.add('animate');
                
                // 2ç§’åæ˜¾ç¤ºç»“æœå¹¶åœæ­¢åŠ¨ç”»
                setTimeout(() => {
                    robotImage.classList.remove('animate');
                    bottomRightInput.textContent = result;
                    
                    // æ·»åŠ è®°å½•åˆ°è¡¨æ ¼
                    addRecord(calculationCount, inputNumber, result);
                }, 1200);
            }
        }

        function addRecord(count, input, output) {
            // æ ¹æ®å½“å‰æ“ä½œç±»å‹ç¡®å®šé¢œè‰²æ ‡è¯†
            let operationClass = '';
            if (currentOperation === '+30') {
                operationClass = 'operation-add30';
            } else if (currentOperation === '*4') {
                operationClass = 'operation-multiply4';
            } else {
                operationClass = 'operation-custom';
            }

            const row = document.createElement('tr');
            row.innerHTML = `
                <td><span class="operation-indicator ${operationClass}"></span></td>
                <td>${input}</td>
                <td>${output}</td>
            `;
            recordsBody.appendChild(row);
            
            // å¦‚æœè®°å½•å¤ªå¤šï¼Œåˆ é™¤æœ€æ—§çš„è®°å½•ï¼ˆä¿æŒæœ€å¤š10æ¡ï¼‰
            if (recordsBody.children.length > 10) {
                recordsBody.removeChild(recordsBody.firstChild);
            }
        }

        // é”®ç›˜äº‹ä»¶æ”¯æŒ
        document.addEventListener('keydown', function(e) {
            if (isInputting) {
                if (e.key >= '0' && e.key <= '9') {
                    inputNumber(parseInt(e.key));
                } else if (e.key === 'Enter') {
                    confirmInput();
                } else if (e.key === 'Escape') {
                    hideKeyboard();
                } else if (e.key === 'Backspace') {
                    if (currentInput.length > 0) {
                        currentInput = currentInput.slice(0, -1);
                        display.textContent = currentInput || '0';
                    }
                }
            } else if (customModal.style.display === 'flex') {
                if (e.key === 'Enter') {
                    confirmCustomOperation();
                } else if (e.key === 'Escape') {
                    closeCustomModal();
                }
            }
        });

        // åˆå§‹åŒ–æŒ‰é’®æ ·å¼
        updateButtonStyles();
    </script>
</body>
</html>