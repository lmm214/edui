<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ÂàÜ‰∏éÂêà</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Arial', sans-serif;
            background-image: linear-gradient(to top, #c1dfc4 0%, #deecdd 100%);
            height: 100vh;
            display: flex;
            flex-direction: column;
            margin: 0;
        }

        .container {
            width: 100%;
            height: 100%;
            display: flex;
            flex-direction: column;
        }

        /* È°∂ÈÉ®Êï∞Â≠óÊòæÁ§∫ */
        .top-numbers {
            display: flex;
            justify-content: center;
            align-items: center;
            margin: 20px auto;
            position: relative;
        }

        .number-circle {
            width: 80px;
            height: 80px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 56px;
            color: black;
            border: 3px solid #333;
            position: absolute;
            z-index: 2;
            cursor: pointer;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .number-circle:hover {
            transform: scale(1.05);
        }

        .number-circle.updating {
            animation: numberUpdate 0.4s ease-in-out;
        }

        @keyframes numberUpdate {
            0% { transform: scale(1); }
            50% { transform: scale(1.2); background-color: #FFE4B5; }
            100% { transform: scale(1); }
        }

        .number-1 { background-color: #A8D4FF; }
        .number-2 { background-color: #F9FFA8; }
        .number-3 { background-color: #90EE90; }

        .top-container {
            background-color: transparent;
            padding: 15px 10px 10px;
            position: relative;
            width: 200px;
            height: 180px;
        }

        /* ‰∏âËßíÂΩ¢Â∏ÉÂ±Ä */
        .number-circle.number-3 {
            top: 0;
            left: 50%;
            transform: translateX(-50%);
        }

        .number-circle.number-2 {
            bottom: 0;
            left: 0;
        }

        .number-circle.number-1 {
            bottom: 0;
            right: 0;
        }

        /* SVGËøûÊé•Á∫øÊ†∑Âºè */
        .connection-svg {
            pointer-events: none;
        }

        /* ‰∏ªË¶ÅÊ∏∏ÊàèÂå∫Âüü */
        .main-area {
            flex: 1;
            display: flex;
            position: relative;
            margin-bottom: 20px;
            min-width: 800px;
            justify-content: center;
            align-items: center;
        }

        .canvas-container {
            position: relative;
            overflow: hidden;
            width: 90vw;
            max-width: calc(100vw - 300px);
            height: calc(90vh - 300px);
            min-height: 300px;
        }

        #gameCanvas {
            display: block;
            cursor: crosshair;
            width: 100%;
            height: auto;
            border: 3px solid #333;
            border-radius: 10px;
            transition: filter 0.2s ease;
        }

        #gameCanvas.dragging {
            filter: brightness(1.1) contrast(1.05);
        }



        /* Â∫ïÈÉ®ÂÖÉÁ¥†ÈÄâÊã©Âô® */
        .bottom-controls {
            display: flex;
            justify-content: center;
            gap: 10px;
            margin: 20px auto;
        }

        .element-btn {
            width: 80px;
            height: 80px;
            border: 2px solid #ccc;
            border-radius: 8px;
            background: white;
            cursor: pointer;
            font-size: 36px;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s;
        }

        .element-btn:hover {
            border-color: #333;
            transform: scale(1.1);
        }

        .element-btn.active {
            border-color: #333;
            background-color: #e7f3ff;
        }



        /* Êï∞Â≠óÂ∞èÈîÆÁõòÊ†∑Âºè */
        .number-keypad {
            position: absolute;
            top: 100%;
            left: 50%;
            transform: translateX(-50%);
            background: white;
            border: 2px solid #333;
            border-radius: 12px;
            padding: 15px;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.2);
            z-index: 10;
            opacity: 0;
            visibility: hidden;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            margin-top: -80px;
        }

        .number-keypad.show {
            opacity: 1;
            visibility: visible;
            transform: translateX(-50%) translateY(0);
        }

        .keypad-grid {
            display: grid;
            grid-template-columns: repeat(5, 1fr);
            gap: 8px;
            width: 380px;
        }

        .keypad-btn {
            width: 60px;
            height: 60px;
            background-color: #B8E6B8;
            border: 2px solid #aaa;
            border-radius: 8px;
            font-size: 32px;
            cursor: pointer;
            transition: all 0.2s;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .keypad-btn:hover {
            background-color: #A5D6A5;
            border-color: #6B9A6B;
            transform: scale(1.05);
        }

        .keypad-btn:active {
            transform: scale(0.95);
        }

        /* ÂìçÂ∫îÂºèËÆæËÆ° */
        @media (max-width: 768px) {
            .main-area {
                flex-direction: column;
                height: auto;
            }
            
            .keypad-grid {
                grid-template-columns: repeat(3, 1fr);
                width: 180px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- È°∂ÈÉ®Êï∞Â≠óÊòæÁ§∫ -->
        <div class="top-numbers">
            <div class="top-container">
                <svg class="connection-svg" width="200" height="180" style="position: absolute; top: 0; left: 0; z-index: 1;">
                    <!-- Â∑¶‰æßËøûÊé•Á∫øÔºö‰ªéÈ°∂ÈÉ®‰∏≠ÂøÉÂà∞Â∑¶‰∏ãËßí -->
                    <line x1="100" y1="40" x2="25" y2="155" stroke="#333" stroke-width="3"/>
                    <!-- Âè≥‰æßËøûÊé•Á∫øÔºö‰ªéÈ°∂ÈÉ®‰∏≠ÂøÉÂà∞Âè≥‰∏ãËßí -->
                    <line x1="100" y1="40" x2="175" y2="155" stroke="#333" stroke-width="3"/>
                </svg>
                <div class="number-circle number-3" id="num3" onclick="toggleKeypad()">3</div>
                <div class="number-circle number-2" id="num2" onclick="toggleLeftSide()">2</div>
                <div class="number-circle number-1" id="num1" onclick="toggleRightSide()">1</div>
                
                <!-- ÊµÆÂä®Êï∞Â≠óÂ∞èÈîÆÁõò -->
                <div class="number-keypad" id="numberKeypad">
                    <div class="keypad-grid">
                        <button class="keypad-btn" onclick="selectNumber(1)">1</button>
                        <button class="keypad-btn" onclick="selectNumber(2)">2</button>
                        <button class="keypad-btn" onclick="selectNumber(3)">3</button>
                        <button class="keypad-btn" onclick="selectNumber(4)">4</button>
                        <button class="keypad-btn" onclick="selectNumber(5)">5</button>
                        <button class="keypad-btn" onclick="selectNumber(6)">6</button>
                        <button class="keypad-btn" onclick="selectNumber(7)">7</button>
                        <button class="keypad-btn" onclick="selectNumber(8)">8</button>
                        <button class="keypad-btn" onclick="selectNumber(9)">9</button>
                        <button class="keypad-btn" onclick="selectNumber(10)">10</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- ‰∏ªË¶ÅÊ∏∏ÊàèÂå∫Âüü -->
        <div class="main-area">
            <div class="canvas-container">
                <canvas id="gameCanvas"></canvas>
            </div>


        </div>

        <!-- Â∫ïÈÉ®ÂÖÉÁ¥†ÈÄâÊã©Âô® -->
        <div class="bottom-controls">
            <button class="element-btn active" onclick="changeElement(this, 'üçé')" title="ËãπÊûú">üçé</button>
            <button class="element-btn" onclick="changeElement(this, '‚öΩÔ∏è')" title="Ë∂≥ÁêÉ">‚öΩÔ∏è</button>
            <button class="element-btn" onclick="changeElement(this, 'ü¶ã')" title="Ëù¥Ëù∂">ü¶ã</button>
            <button class="element-btn" onclick="changeElement(this, '1')" title="Êï∞Â≠ó">1</button>
        </div>
    </div>

    <script>
        let currentElement = 'üçé';
        let totalNumber = 6;
        let leftCount = 0;
        let rightCount = 0;
        let draggedElement = null;
        let elements = [];
        let canvas, ctx;
        let isDragging = false;
        let dragOffset = { x: 0, y: 0 };
        let leftHidden = false;
        let rightHidden = false;
        let keypadVisible = false;

        // ÂÖÉÁ¥†ÂØπË±°Á±ª
        class GameElement {
            constructor(x, y, symbol) {
                this.x = x;
                this.y = y;
                this.symbol = symbol;
                this.size = 50;
                this.isLeft = x < canvas.getBoundingClientRect().width / 2;
            }

            draw() {
                ctx.font = '48px Arial';
                ctx.textAlign = 'center';
                ctx.textBaseline = 'middle';
                ctx.fillText(this.symbol, this.x, this.y);
            }

            contains(x, y) {
                const distance = Math.sqrt((x - this.x) ** 2 + (y - this.y) ** 2);
                return distance <= this.size / 2;
            }

            updateZone() {
                const wasLeft = this.isLeft;
                this.isLeft = this.x < canvas.getBoundingClientRect().width / 2;
                
                if (wasLeft !== this.isLeft) {
                    if (wasLeft) {
                        leftCount--;
                        rightCount++;
                    } else {
                        rightCount--;
                        leftCount++;
                    }
                    updateCounts();
                }
            }
        }

        // ÂàùÂßãÂåñCanvasÂ∞∫ÂØ∏
        function resizeCanvas() {
            const container = canvas.parentElement;
            const containerRect = container.getBoundingClientRect();
            
            // ËÆæÁΩÆCanvasÂ∞∫ÂØ∏‰∏∫ÂÆπÂô®ÁöÑÂÆûÈôÖÂ∞∫ÂØ∏
            const canvasWidth = containerRect.width;
            const canvasHeight = containerRect.height;
            
            // ‰ºòÂåñCanvasÊ∏ÖÊô∞Â∫¶
            const dpr = window.devicePixelRatio || 1;
            canvas.width = canvasWidth * dpr;
            canvas.height = canvasHeight * dpr;
            ctx.scale(dpr, dpr);
            canvas.style.width = canvasWidth + 'px';
            canvas.style.height = canvasHeight + 'px';
        }

        // ÂàùÂßãÂåñ
        function init() {
            canvas = document.getElementById('gameCanvas');
            ctx = canvas.getContext('2d');
            
            // ÂàùÂßãÂåñCanvasÂ∞∫ÂØ∏
            resizeCanvas();
            
            // Ê∑ªÂä†Á™óÂè£Â§ßÂ∞èÂèòÂåñÁõëÂê¨Âô®
            window.addEventListener('resize', () => {
                resizeCanvas();
                draw();
            });
            
            // Ê∑ªÂä†‰∫ã‰ª∂ÁõëÂê¨Âô®
            canvas.addEventListener('mousedown', handleMouseDown);
            canvas.addEventListener('mousemove', handleMouseMove);
            canvas.addEventListener('mouseup', handleMouseUp);
            canvas.addEventListener('touchstart', handleTouchStart, { passive: false });
            canvas.addEventListener('touchmove', handleTouchMove, { passive: false });
            canvas.addEventListener('touchend', handleTouchEnd);
            
            refreshTopNumbers();
            generateElements();
        }

        // Êõ¥Êñ∞È°∂ÈÉ®Êï∞Â≠óÊòæÁ§∫Ôºà‰∏éÂ∑¶Âè≥Êï∞Èáè‰øùÊåÅ‰∏ÄËá¥Ôºâ
        function refreshTopNumbers() {
            const num3 = leftCount + rightCount; // ÊÄªÊï∞
            const num2Element = document.getElementById('num2');
            const num1Element = document.getElementById('num1');
            const num3Element = document.getElementById('num3');
            
            // Ê£ÄÊü•Êï∞Â≠óÊòØÂê¶ÂèëÁîüÂèòÂåñÔºåÂ¶ÇÊûúÂèòÂåñÂàôÊ∑ªÂä†Âä®Áîª
            if (num2Element.textContent !== leftCount.toString() && !leftHidden) {
                num2Element.classList.add('updating');
                setTimeout(() => num2Element.classList.remove('updating'), 400);
            }
            
            if (num1Element.textContent !== rightCount.toString() && !rightHidden) {
                num1Element.classList.add('updating');
                setTimeout(() => num1Element.classList.remove('updating'), 400);
            }
            
            // Êõ¥Êñ∞Êï∞Â≠óÂÜÖÂÆπ
            if (!leftHidden) num2Element.textContent = leftCount; // Â∑¶‰æßÊï∞Èáè
            if (!rightHidden) num1Element.textContent = rightCount; // Âè≥‰æßÊï∞Èáè
            num3Element.textContent = num3; // ÊÄªÊï∞
        }

        // ÁîüÊàêÂÖÉÁ¥†
        function generateElements() {
            elements = [];
            leftCount = 0;
            rightCount = 0;

            const rect = canvas.getBoundingClientRect();
            // ÁîüÊàêÊñ∞ÂÖÉÁ¥†
            for (let i = 0; i < totalNumber; i++) {
                const isLeft = Math.random() < 0.5;
                const x = isLeft ? 
                    Math.random() * (rect.width / 2 - 80) + 40 : 
                    Math.random() * (rect.width / 2 - 80) + rect.width / 2 + 40;
                const y = Math.random() * (rect.height - 160) + 80;

                const element = new GameElement(x, y, currentElement);
                elements.push(element);
                if (isLeft) leftCount++; else rightCount++;
            }

            updateCounts();
            draw();
        }

        // CanvasÁªòÂà∂ÂáΩÊï∞
        function draw() {
            const rect = canvas.getBoundingClientRect();
            // Ê∏ÖÈô§ÁîªÂ∏É
            ctx.clearRect(0, 0, rect.width, rect.height);
            
            // ÁªòÂà∂ËÉåÊôØ
            ctx.fillStyle = '#F9FFA8'; // Â∑¶‰æßÈªÑËâ≤
            ctx.fillRect(0, 0, rect.width / 2, rect.height);
            
            ctx.fillStyle = '#A8D4FF'; // Âè≥‰æßËìùËâ≤
            ctx.fillRect(rect.width / 2, 0, rect.width / 2, rect.height);
            
            // ÁªòÂà∂‰∏≠Èó¥ËôöÁ∫øÔºàÁßªÈô§Â∞èÈªëÁÇπÔºâ
            ctx.setLineDash([8, 8]);
            ctx.strokeStyle = '#333';
            ctx.lineWidth = 3;
            ctx.beginPath();
            ctx.moveTo(rect.width / 2, 0);
            ctx.lineTo(rect.width / 2, rect.height);
            ctx.stroke();
            ctx.setLineDash([]);
            
            // ÁªòÂà∂ÊâÄÊúâÂÖÉÁ¥†
            ctx.fillStyle = 'black';
            elements.forEach(element => {
                if (!element.hidden && 
                    !(leftHidden && element.isLeft) && 
                    !(rightHidden && !element.isLeft)) {
                    element.draw();
                }
            });
        }

        // Ëé∑ÂèñÈº†Ê†áÂú®Canvas‰∏≠ÁöÑÂùêÊ†á
        function getCanvasCoordinates(e) {
            const rect = canvas.getBoundingClientRect();
            return {
                x: e.clientX - rect.left,
                y: e.clientY - rect.top
            };
        }

        // Ëé∑ÂèñËß¶Êë∏Âú®Canvas‰∏≠ÁöÑÂùêÊ†á
        function getTouchCoordinates(e) {
            const rect = canvas.getBoundingClientRect();
            return {
                x: e.touches[0].clientX - rect.left,
                y: e.touches[0].clientY - rect.top
            };
        }

        // Èº†Ê†á‰∫ã‰ª∂Â§ÑÁêÜ
        function handleMouseDown(e) {
            const coords = getCanvasCoordinates(e);
            
            // Êü•ÊâæË¢´ÁÇπÂáªÁöÑÂÖÉÁ¥†
            for (let i = elements.length - 1; i >= 0; i--) {
                if (elements[i].contains(coords.x, coords.y)) {
                    draggedElement = elements[i];
                    isDragging = true;
                    dragOffset.x = coords.x - draggedElement.x;
                    dragOffset.y = coords.y - draggedElement.y;
                    canvas.classList.add('dragging');
                    break;
                }
            }
        }

        function handleMouseMove(e) {
            const coords = getCanvasCoordinates(e);
            
            if (isDragging && draggedElement) {
                const rect = canvas.getBoundingClientRect();
                draggedElement.x = coords.x - dragOffset.x;
                draggedElement.y = coords.y - dragOffset.y;
                
                // ÈôêÂà∂Âú®ÁîªÂ∏ÉËåÉÂõ¥ÂÜÖ
                draggedElement.x = Math.max(25, Math.min(rect.width - 25, draggedElement.x));
                draggedElement.y = Math.max(25, Math.min(rect.height - 25, draggedElement.y));
                
                // ÂÆûÊó∂Êõ¥Êñ∞Âå∫Âüü
                draggedElement.updateZone();
                
                draw();
            } else {
                // Ê£ÄÊü•Èº†Ê†áÊòØÂê¶ÊÇ¨ÂÅúÂú®ÂÖÉÁ¥†‰∏äÔºåÊîπÂèòÈº†Ê†áÊ†∑Âºè
                let isOverElement = false;
                for (let i = elements.length - 1; i >= 0; i--) {
                    if (elements[i].contains(coords.x, coords.y) && 
                        !elements[i].hidden && 
                        !(leftHidden && elements[i].isLeft) && 
                        !(rightHidden && !elements[i].isLeft)) {
                        isOverElement = true;
                        break;
                    }
                }
                canvas.style.cursor = isOverElement ? 'pointer' : 'crosshair';
            }
        }

        function handleMouseUp(e) {
            isDragging = false;
            draggedElement = null;
            canvas.classList.remove('dragging');
        }

        // Ëß¶Êë∏‰∫ã‰ª∂Â§ÑÁêÜ
        function handleTouchStart(e) {
            e.preventDefault();
            const coords = getTouchCoordinates(e);
            
            // Êü•ÊâæË¢´Ëß¶Êë∏ÁöÑÂÖÉÁ¥†
            for (let i = elements.length - 1; i >= 0; i--) {
                if (elements[i].contains(coords.x, coords.y)) {
                    draggedElement = elements[i];
                    isDragging = true;
                    dragOffset.x = coords.x - draggedElement.x;
                    dragOffset.y = coords.y - draggedElement.y;
                    canvas.classList.add('dragging');
                    break;
                }
            }
        }

        function handleTouchMove(e) {
            e.preventDefault();
            if (!isDragging || !draggedElement) return;
            
            const coords = getTouchCoordinates(e);
            const rect = canvas.getBoundingClientRect();
            draggedElement.x = coords.x - dragOffset.x;
            draggedElement.y = coords.y - dragOffset.y;
            
            // ÈôêÂà∂Âú®ÁîªÂ∏ÉËåÉÂõ¥ÂÜÖ
            draggedElement.x = Math.max(25, Math.min(rect.width - 25, draggedElement.x));
            draggedElement.y = Math.max(25, Math.min(rect.height - 25, draggedElement.y));
            
            // ÂÆûÊó∂Êõ¥Êñ∞Âå∫Âüü
            draggedElement.updateZone();
            
            draw();
        }

        function handleTouchEnd(e) {
            isDragging = false;
            draggedElement = null;
            canvas.classList.remove('dragging');
        }

        // Êõ¥Êñ∞ËÆ°Êï∞ÊòæÁ§∫ÔºàÂπ∂Âà∑Êñ∞È°∂ÈÉ®Êï∞Â≠óÔºâ
        function updateCounts() {
            refreshTopNumbers();
        }

        // ÊîπÂèòÊï∞Â≠óÔºàËÆæÁΩÆÊÄªÊï∞Âπ∂ÈáçÊñ∞ÈöèÊú∫ÊëÜÊîæÔºâ
        function changeNumber(num) {
            totalNumber = num;
            generateElements();
        }

        // ÊîπÂèòÂÖÉÁ¥†Á±ªÂûã
        function changeElement(btn, element) {
            // Êõ¥Êñ∞ÊåâÈíÆÁä∂ÊÄÅ
            document.querySelectorAll('.element-btn').forEach(b => b.classList.remove('active'));
            btn.classList.add('active');

            currentElement = element;

            // Êõ¥Êñ∞Áé∞ÊúâÂÖÉÁ¥†
            elements.forEach(el => {
                el.symbol = currentElement;
            });
            
            draw();
        }

        // ÂàáÊç¢Â∑¶‰æßÊòæÁ§∫
        function toggleLeftSide() {
            leftHidden = !leftHidden;
            const num2 = document.getElementById('num2');
            if (leftHidden) {
                num2.textContent = '?';
                num2.style.backgroundColor = '#DDD';
            } else {
                num2.textContent = leftCount;
                num2.style.backgroundColor = '#F0E68C';
            }
            draw();
        }

        // ÂàáÊç¢Âè≥‰æßÊòæÁ§∫
        function toggleRightSide() {
            rightHidden = !rightHidden;
            const num1 = document.getElementById('num1');
            if (rightHidden) {
                num1.textContent = '?';
                num1.style.backgroundColor = '#DDD';
            } else {
                num1.textContent = rightCount;
                num1.style.backgroundColor = '#87CEEB';
            }
            draw();
        }

        // ÂàáÊç¢Â∞èÈîÆÁõòÊòæÁ§∫/ÈöêËóè
        function toggleKeypad() {
            const keypad = document.getElementById('numberKeypad');
            keypadVisible = !keypadVisible;
            
            if (keypadVisible) {
                keypad.classList.add('show');
            } else {
                keypad.classList.remove('show');
            }
        }

        // ÈÄâÊã©Êï∞Â≠ó
        function selectNumber(num) {
            totalNumber = num;
            generateElements();
            
            // ÈöêËóèÂ∞èÈîÆÁõò
            const keypad = document.getElementById('numberKeypad');
            keypad.classList.remove('show');
            keypadVisible = false;
        }

        // ÁÇπÂáªÈ°µÈù¢ÂÖ∂‰ªñÂú∞ÊñπÈöêËóèÂ∞èÈîÆÁõò
        document.addEventListener('click', function(e) {
            const keypad = document.getElementById('numberKeypad');
            const num3 = document.getElementById('num3');
            
            if (keypadVisible && !keypad.contains(e.target) && e.target !== num3) {
                keypad.classList.remove('show');
                keypadVisible = false;
            }
        });

        // È°µÈù¢Âä†ËΩΩÂÆåÊàêÂêéÂàùÂßãÂåñ
        window.addEventListener('load', init);

        // Èò≤Ê≠¢È°µÈù¢ÊªöÂä®ÂΩ±ÂìçÊãñÊãΩ
        document.addEventListener('touchmove', function(e) {
            if (draggedElement) {
                e.preventDefault();
            }
        }, { passive: false });
    </script>
</body>
</html>