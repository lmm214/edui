<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8"/>
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    <meta http-equiv="X-UA-Compatible" content="ie=edge"/>
    <title>è§‚å¯Ÿç»„åˆæ­£æ–¹ä½“</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            display: flex;
            height: 100vh;
            font-family: Arial;
            overflow: hidden; /* ç¦æ­¢é¡µé¢æ»šåŠ¨ */
        }


        /* æ§åˆ¶é¢æ¿ */
        #control-panel {
            width: 14%;
            height: 100vh;
            overflow-y: auto; /* å…è®¸å‚ç›´æ»šåŠ¨ */
            padding: 10px;
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        /* åœºæ™¯å®¹å™¨ */
        #scene-container {
            width: 85%;
            overflow: hidden;
            display: grid;
            grid-template-columns: 4fr 1fr;
            align-items: start;
        }

        /* ä¸»è§†å›¾å®¹å™¨ */
        #main-view {
            width: 100%;
            aspect-ratio: 1.3;
        }

        /* è¾…åŠ©è§†å›¾å®¹å™¨ */
        #side-views {
        }

        .side-view {
            width: 100%;
            aspect-ratio: 1;
            position: relative;  /* æ·»åŠ ç›¸å¯¹å®šä½ */
        }

        .side-view-title {
            position: absolute;
            top: 5px;
            left: 5px;
            font-size: 12px;
            color: #666;
            background: rgba(255,255,255,0.8);
            padding: 2px 5px;
            border-radius: 3px;
            z-index: 1;  /* ç¡®ä¿æ ‡é¢˜åœ¨æ¸²æŸ“å™¨ä¸Šæ–¹ */
            display: flex;
            align-items: center;
            gap: 5px;
            cursor: pointer;
        }

        /* æ§åˆ¶æŒ‰é’®ç»„ */
        .control-group {
            margin: 10px 0;
            border-radius: 8px;
            width: 100%;
        }

        /* æ§åˆ¶ç½‘æ ¼ */
        .grid-control {
            display: grid;
            grid-template-columns: repeat(5, 1fr);
            gap: 1px;
            margin: 0;
            width: 100%;
        }

        /*æ§åˆ¶æŒ‰é’®*/
        .grid-btn {
            aspect-ratio: 1;
            background: white;
            cursor: pointer;
            transition: background 0.2s;
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 20px;
            width: 100%;
            height: auto;
            border: 1px solid #ddd;
            border-radius:3px;
            box-shadow: 0 1px 2px rgba(0,0,0,0.05);
        }

        .grid-btn:hover {
            background: #f0f0f0;
            transform: scale(1.05);
        }

        /* æ·»åŠ ä¸­å¿ƒç‚¹æ ‡è®°æ ·å¼ */
        .grid-btn.center {
            border-color: #4CAF50;
            background-color: #f0fff0;
        }

        /*è§†å›¾æ§åˆ¶*/
        .viewpoint-control-group {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 5px;
            margin: 0;
            width: 100%;
        }
        .viewpoint-control-group button{
            font-size: 24px;
            color: #fff;
            font-weight: 800;
        }
        #front {
            background: #28a3dd;
        }

        #sideLeft {
            background: #f3db52
        }

        #top {
            background: #ed84b5
        }

        #d3 {
            background: #4ab74e
        }

        /* é‡ç½®æ’¤å›*/
        .global-control-group,.quick-control-group {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 5px;
            margin-top: 10px;
        }


        #reset {
            color: #4ab74e
        }

        #withdraw {
            color: #9179c0
        }
        .instruction {
            margin: 0;
            padding: 15px;
            background: #f8f8f8;
            border-radius: 4px;
            width: 100%;
            box-sizing: border-box;
        }

        /* æ›¿æ¢ wired-button æ ·å¼ */
        button {
            padding: 8px 16px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            background: #f5f5f5;
            transition: all 0.3s;
        }

        button:hover {
            background: #e0e0e0;
        }

        /* çœ¼ç›å›¾æ ‡æ ·å¼ */
        .eye-icon {
            width: 16px;
            height: 16px;
            display: inline-flex;
            align-items: center;
            justify-content: center;
        }
        
        .eye-icon.closed::before {
            content: "ğŸ‘ï¸";
            opacity: 0.5;
        }
        
        .eye-icon.open::before {
            content: "ğŸ‘ï¸";
            opacity: 1;
        }
        
        /* éšè— canvas */
        .side-view canvas.hidden {
            display: none !important;
        }

    </style>
</head>

<body>
<!--æ§åˆ¶åŒº-->
<div id="control-panel" class="card">
    <div class="control-group">
        <div class="instruction card">
            <h3>è§‚å¯Ÿç»„åˆæ­£æ–¹ä½“</h3>
            <p>1. ç‚¹å‡»æ•°å­—æ·»åŠ å°æ­£æ–¹ä½“</p>
            <p>2. ç‚¹å‡»æŒ‰é’®åˆ‡æ¢ä¸åŒè§†è§’</p>
            <p>3. æŒ‰ä½é¼ æ ‡å·¦é”®è¿›è¡Œæ—‹è½¬</p>
        </div>
    </div>
    
    <div class="control-group grid-control" id="control-grid"></div>

    <div class="control-group">
        <div class="viewpoint-control-group" id="viewpoint-control-group">
            <button id="front" data-view="front">æ­£</button>
            <button id="sideLeft" data-view="sideLeft">å·¦</button>
            <button id="top" data-view="top">ä¸Š</button>
            <button id="d3" data-view="3d">3D</button>
        </div>
    </div>
    
    <div class="control-group">
        <div class="global-control-group">
            <button id="reset">é‡ç½®</button>
            <button id="withdraw">æ’¤å›</button>
        </div>
    </div>
    <div class="control-group">
        <div class="quick-control-group">
            <button id="quick-2">2x2</button>
            <button id="quick-3">3x3</button>
            <button id="quick-4">4x4</button>
            <button id="quick-5">5x5</button>
        </div>
    </div>

</div>

<!--åœºæ™¯-->
<div id="scene-container" class="card">
    <div id="main-view"></div>
    <div id="side-views">
        <div class="side-view hidden" id="top-view">
            <div class="side-view-title">
                <span class="eye-icon closed"></span>
                ä¿¯è§†å›¾
            </div>
        </div>
        <div class="side-view hidden" id="front-view">
            <div class="side-view-title">
                <span class="eye-icon closed"></span>
                æ­£è§†å›¾
            </div>
        </div>
        <div class="side-view hidden" id="left-view">
            <div class="side-view-title">
                <span class="eye-icon closed"></span>
                å·¦è§†å›¾
            </div>
        </div>
    </div>
</div>

</body>
<!--å¯¼å…¥Threejs-->
<script type="importmap">
    {
      "imports": {
        "three": "./three.module.js",
        "controls": "./OrbitControls.js",
        "tween": "./tween.esm.js"
      }
    }
</script>


<script type="module">
    import * as THREE from 'three';
    import {OrbitControls} from 'controls';
    import * as TWEEN from 'tween';

    //æ–¹å—ç”Ÿæˆæ§åˆ¶æŒ‰é’®
    const gridData = {}
    let scene, camera, renderer, controls;
    let topRenderer, frontRenderer, leftRenderer;
    let topCamera, frontCamera, leftCamera;
    const viewSize = 8; // å¯è§†èŒƒå›´åŠå¾„
    //æ–¹å—
    const cubes = [];


    // åˆ›å»ºä¸åŒé¢æè´¨ï¼ˆé¢œè‰²å¯è‡ªå®šä¹‰ï¼‰
    const materials = [
        // Xè½´æ–¹å‘çš„ä¸¤ä¸ªé¢ï¼ˆå·¦/å³ï¼‰
        new THREE.MeshBasicMaterial({
            color: "#f3db52"
        }), // å·¦
        new THREE.MeshBasicMaterial({color: "#f3db52"}), // å³

        // Yè½´æ–¹å‘çš„ä¸¤ä¸ªé¢ï¼ˆä¸Š/ä¸‹ï¼‰
        new THREE.MeshBasicMaterial({color: "#ed84b5"}), // ä¸Š: ç»¿è‰²
        new THREE.MeshBasicMaterial({color: "#ed84b5"}), // ä¸‹: æµ…ç»¿è‰²

        // Zè½´æ–¹å‘çš„ä¸¤ä¸ªé¢ï¼ˆå‰/åï¼‰
        new THREE.MeshBasicMaterial({color: "#28a3dd"}), // å‰
        new THREE.MeshBasicMaterial({color: "#28a3dd"})  // å
    ];

    /**
     * åˆå§‹åŒ–åœºæ™¯
     */
    function initScene() {
        const container = document.getElementById('main-view');
        let clientWidth = container.clientWidth - 30;
        let clientHeight = container.clientHeight - 30;

        // åˆ›å»ºåœºæ™¯
        scene = new THREE.Scene();
        scene.background = new THREE.Color(0x444488);

        // è®¾ç½®ä¸»è§†å›¾ç›¸æœºå’Œæ¸²æŸ“å™¨
        const aspect = clientWidth / clientHeight;
        camera = new THREE.OrthographicCamera(
            -viewSize * aspect / 2,
            viewSize * aspect / 2,
            viewSize / 2 + 150/clientHeight * viewSize,  // ä»50æ”¹ä¸º150
            -viewSize / 2 + 150/clientHeight * viewSize,  // ä»50æ”¹ä¸º150
            1,
            1000
        );

        renderer = new THREE.WebGLRenderer({antialias: true});
        renderer.setSize(clientWidth, clientHeight);
        renderer.setAnimationLoop(animate);
        container.appendChild(renderer.domElement);
        
        // åˆå§‹åŒ–è¾…åŠ©è§†å›¾
        initSideViews();
        
        //è½¨é“æ§åˆ¶å™¨
        controls = new OrbitControls(camera, renderer.domElement);
        // å¯ç”¨é˜»å°¼æ•ˆæœä½¿åŠ¨ç”»æ›´å¹³æ»‘
        controls.enableDamping = true;
        controls.dampingFactor = 0.05;
        
        // è‡ªå®šä¹‰ç¼©æ”¾è¡Œä¸º
        controls.enableZoom = true;
        controls.zoomSpeed = 0.5;
        
        // ç›‘å¬ç¼©æ”¾äº‹ä»¶
        controls.addEventListener('zoom', (event) => {
            // è·å–ç¼©æ”¾æ¯”ä¾‹
            const zoomScale = controls.target.distanceTo(camera.position) / 
                             controls._lastDistance || 1;
            
            // åˆ›å»ºç¼©æ”¾åŠ¨ç”»
            new TWEEN.Tween({
                left: camera.left,
                right: camera.right,
                top: camera.top,
                bottom: camera.bottom
            })
            .to({
                left: camera.left * zoomScale,
                right: camera.right * zoomScale,
                top: camera.top * zoomScale,
                bottom: camera.bottom * zoomScale
            }, 300)
            .easing(TWEEN.Easing.Quadratic.InOut)
            .onUpdate((props) => {
                camera.left = props.left;
                camera.right = props.right;
                camera.top = props.top;
                camera.bottom = props.bottom;
                camera.updateProjectionMatrix();
            })
            .start();
            
            // ä¿å­˜å½“å‰è·ç¦»ç”¨äºä¸‹æ¬¡è®¡ç®—
            controls._lastDistance = controls.target.distanceTo(camera.position);
        });

        // æ·»åŠ æ§åˆ¶å™¨äº‹ä»¶ç›‘å¬
        controls.addEventListener('start', () => {
            animate.isDragging = true;
        });
        controls.addEventListener('end', () => {
            animate.isDragging = false;
            // æ‹–åŠ¨ç»“æŸæ—¶æ›´æ–°æ‰€æœ‰è§†å›¾
            updateSideViews();
        });

        // æ·»åŠ å…‰æº
        const ambientLight = new THREE.AmbientLight(0xcccccc);
        scene.add(ambientLight);

        const directionalLight = new THREE.DirectionalLight(0xffffff, 3);
        directionalLight.position.set(10, 10, 10);
        scene.add(directionalLight);

        //åæ ‡è½´
        addHelpers()

        // é»˜è®¤è§†å›¾
        setView('3d');
        // çª—å£å¤§å°æ”¹å˜å¤„ç†
        window.addEventListener('resize', onWindowResize);


        // äº‹ä»¶ç›‘å¬
        document.querySelectorAll('#viewpoint-control-group > *').forEach(btn => {
            btn.addEventListener('click', () => {
                setView(btn.dataset.view);
            });
        });

        // æ·»åŠ è§†å›¾åˆ‡æ¢äº‹ä»¶
        document.querySelectorAll('.side-view-title').forEach(title => {
            title.addEventListener('click', () => {
                const view = title.closest('.side-view').querySelector('canvas');
                const eyeIcon = title.querySelector('.eye-icon');
                
                view.classList.toggle('hidden');
                eyeIcon.classList.toggle('closed');
                eyeIcon.classList.toggle('open');
                
                // ç«‹å³æ›´æ–°è§†å›¾çŠ¶æ€
                updateSideViews();
            });
        });

    }

    // åˆå§‹åŒ–è¾…åŠ©è§†å›¾
    function initSideViews() {
        const sideSize = document.querySelector('.side-view').clientWidth - 10;
        
        // ä¿¯è§†å›¾
        topCamera = new THREE.OrthographicCamera(-5, 5, 5, -5, 1, 1000);
        topCamera.position.set(0, 15, 0);
        topCamera.up.set(0, 0, -1);
        topCamera.lookAt(0, 0, 0);
        
        topRenderer = new THREE.WebGLRenderer({antialias: true});
        topRenderer.setSize(sideSize, sideSize);
        topRenderer.setClearColor(0x444488);
        document.getElementById('top-view').appendChild(topRenderer.domElement);
        
        // æ­£è§†å›¾
        frontCamera = new THREE.OrthographicCamera(-5, 5, 5, -5, 1, 1000);
        frontCamera.position.set(0, 0, 15);
        frontCamera.position.y = 2.5; // å‘ä¸Šåç§»ä»¥å±…ä¸­æ˜¾ç¤º
        frontCamera.lookAt(0, 2.5, 0); // çœ‹å‘åç§»åçš„ä¸­å¿ƒç‚¹
        
        frontRenderer = new THREE.WebGLRenderer({antialias: true});
        frontRenderer.setSize(sideSize, sideSize);
        frontRenderer.setClearColor(0x444488);
        document.getElementById('front-view').appendChild(frontRenderer.domElement);
        
        // å·¦è§†å›¾
        leftCamera = new THREE.OrthographicCamera(-5, 5, 5, -5, 1, 1000);
        leftCamera.position.set(-15, 0, 0);
        leftCamera.position.y = 2.5; // å‘ä¸Šåç§»ä»¥å±…ä¸­æ˜¾ç¤º
        leftCamera.lookAt(0, 2.5, 0); // çœ‹å‘åç§»åçš„ä¸­å¿ƒç‚¹
        
        leftRenderer = new THREE.WebGLRenderer({antialias: true});
        leftRenderer.setSize(sideSize, sideSize);
        leftRenderer.setClearColor(0x444488);
        document.getElementById('left-view').appendChild(leftRenderer.domElement);
    }

    // æ·»åŠ è¾…åŠ©å·¥å…·
    function addHelpers() {
        // åæ ‡è½´
        const axesHelper = new THREE.AxesHelper(5);
        scene.add(axesHelper);
        // ç½‘æ ¼
        const gridHelper = new THREE.GridHelper(10, 10);
        gridHelper.material.opacity = 0.2;
        gridHelper.material.transparent = true;
        scene.add(gridHelper);
    }

    // è®¾ç½®è§†å›¾
    function setView(viewType) {
        const currentPosition = camera.position.clone();
        const currentUp = camera.up.clone();
        
        let targetPosition = new THREE.Vector3();
        let targetUp = new THREE.Vector3(0, 1, 0);
        
        // æ£€æŸ¥æ˜¯å¦æ˜¯å·¦å³è§†å›¾ä¹‹é—´çš„åˆ‡æ¢
        if ((viewType === 'sideLeft' && camera.position.x > 10) || 
            (viewType === 'sideRight' && camera.position.x < -10)) {
            // å…ˆåˆ‡æ¢åˆ°3Dè§†å›¾
            new TWEEN.Tween({
                x: currentPosition.x,
                y: currentPosition.y,
                z: currentPosition.z
            })
            .to({
                x: 5,
                y: 5,
                z: 10
            }, 500)
            .easing(TWEEN.Easing.Quadratic.InOut)
            .onUpdate((coords) => {
                camera.position.set(coords.x, coords.y, coords.z);
                camera.lookAt(0, 0, 0);
            })
            .onComplete(() => {
                // ç„¶ååˆ‡æ¢åˆ°ç›®æ ‡è§†å›¾
                const finalPosition = viewType === 'sideLeft' ? 
                    {x: -15, y: 0, z: 0} : 
                    {x: 15, y: 0, z: 0};
                
                new TWEEN.Tween({
                    x: camera.position.x,
                    y: camera.position.y,
                    z: camera.position.z
                })
                .to(finalPosition, 500)
                .easing(TWEEN.Easing.Quadratic.InOut)
                .onUpdate((coords) => {
                    camera.position.set(coords.x, coords.y, coords.z);
                    camera.lookAt(0, 0, 0);
                })
                .start();
            })
            .start();
            return;
        }
        
        // å…¶ä»–è§†å›¾åˆ‡æ¢ä¿æŒåŸæ¥çš„é€»è¾‘
        switch (viewType) {
            case 'front':
                targetPosition.set(0, 0, 15);
                break;
            case 'top':
                targetPosition.set(0, 15, 0);
                targetUp.set(0, 0, -1);
                break;
            case 'sideLeft':
                targetPosition.set(-15, 0, 0);
                break;
            case 'sideRight':
                targetPosition.set(15, 0, 0);
                break;
            case '3d':
                targetPosition.set(5, 5, 10);
                break;
        }

        // åˆ›å»ºç›¸æœºä½ç½®åŠ¨ç”»
        new TWEEN.Tween({
            x: currentPosition.x,
            y: currentPosition.y,
            z: currentPosition.z
        })
        .to({
            x: targetPosition.x,
            y: targetPosition.y,
            z: targetPosition.z
        }, 1000)
        .easing(TWEEN.Easing.Quadratic.InOut)
        .onUpdate((coords) => {
            camera.position.set(coords.x, coords.y, coords.z);
            camera.lookAt(0, 0, 0);
        })
        .start();

        // åˆ›å»ºç›¸æœºæœå‘åŠ¨ç”»
        new TWEEN.Tween({
            x: currentUp.x,
            y: currentUp.y,
            z: currentUp.z
        })
        .to({
            x: targetUp.x,
            y: targetUp.y,
            z: targetUp.z
        }, 1000)
        .easing(TWEEN.Easing.Quadratic.InOut)
        .onUpdate((coords) => {
            camera.up.set(coords.x, coords.y, coords.z);
        })
        .start();
    }

    // åŠ¨ç”»å¾ªç¯
    function animate() {
        TWEEN.update();
        controls.update();
        
        // å§‹ç»ˆæ¸²æŸ“ä¸»è§†å›¾
        renderer.render(scene, camera);
        
        // å¦‚æœæœ‰åŠ¨ç”»æˆ–è€…è§†å›¾å˜åŒ–ï¼Œæ›´æ–°è¾…åŠ©è§†å›¾
        const tweens = TWEEN.getAll();
        if (tweens.length > 0 || animate.isDragging) {
            updateSideViews();
        }
    }

    // æ›´æ–°è¾…åŠ©è§†å›¾
    function updateSideViews() {
        // åªæ›´æ–°æœªéšè—çš„è§†å›¾
        if (!document.getElementById('top-view').querySelector('canvas').classList.contains('hidden')) {
            topRenderer.render(scene, topCamera);
        }
        if (!document.getElementById('front-view').querySelector('canvas').classList.contains('hidden')) {
            frontRenderer.render(scene, frontCamera);
        }
        if (!document.getElementById('left-view').querySelector('canvas').classList.contains('hidden')) {
            leftRenderer.render(scene, leftCamera);
        }
    }

    // çª—å£å°ºå¯¸å˜åŒ–å¤„ç†
    function onWindowResize() {
        let container = document.getElementById('main-view');
        let clientWidth = container.clientWidth - 30;
        let clientHeight = container.clientHeight - 30;
        
        const aspect = clientWidth / clientHeight;
        
        renderer.setSize(clientWidth, clientHeight);
        camera.aspect = clientWidth / clientHeight;
        camera.left = -viewSize * aspect / 2;
        camera.right = viewSize * aspect / 2;
        camera.top = viewSize / 2 + 150/clientHeight * viewSize;  // ä»50æ”¹ä¸º150
        camera.bottom = -viewSize / 2 + 150/clientHeight * viewSize;  // ä»50æ”¹ä¸º150
        camera.updateProjectionMatrix();
        
        // æ›´æ–°è¾…åŠ©è§†å›¾å°ºå¯¸
        const sideSize = document.querySelector('.side-view').clientWidth - 10;
        [topRenderer, frontRenderer, leftRenderer].forEach(renderer => {
            renderer.setSize(sideSize, sideSize);
        });
    }


    // åˆ›å»ºæ§åˆ¶ç½‘æ ¼
    function createControlGrid() {
        const container = document.getElementById('control-grid');
        for (let z = -2; z < 3; z++) {
            for (let x = -2; x < 3; x++) {
                const btn = document.createElement('div');
                
                let key = `${x}-${z}`
                gridData[key] = {
                    x: x + 0.5,
                    y: 0,
                    z: z + 0.5,
                    key
                }
                btn.className = 'grid-btn';
                if (x === 0 && z === 0) {
                    btn.className += ' center';
                }
                btn.textContent = gridData[key].z;
                btn.id = key
                btn.addEventListener('click', () => {
                    gridData[btn.id].y++
                    btn.textContent = gridData[key].y
                    addCube(gridData[btn.id])
                });
                container.appendChild(btn);
            }
        }
    }

    /**
     * æ·»åŠ æ–¹å—
     * @param point
     */
    function addCube(point) {
        // ä½¿ç”¨æè´¨æ•°ç»„åˆ›å»ºç«‹æ–¹ä½“
        const geometry = new THREE.BoxGeometry(1, 1, 1);
        const cube = new THREE.Mesh(geometry, materials);
        cube.position.set(point.x, point.y - 0.5, point.z)

        const edges = new THREE.EdgesGeometry(geometry);
        const lineSegments = new THREE.LineSegments(
            edges,
            new THREE.LineDashedMaterial(
                {
                    color: "#0c0c0c",
                    linewidth: 1.5
                }
            )
        );
        lineSegments.computeLineDistances();
        cube.add(lineSegments);
        scene.add(cube);
        cubes.push({
            key: point.key,
            cube: cube
        })
        // æ·»åŠ æ–¹å—åæ›´æ–°æ‰€æœ‰è§†å›¾
        renderer.render(scene, camera);
        updateSideViews();
    }

    // é‡ç½®æ‰€æœ‰
    function resetAll() {
        setView("3d")
        document.querySelectorAll('.grid-btn').forEach(btn => {
            btn.textContent = '0'
            gridData[btn.id].y = 0
        });
        cubes.forEach(item => scene.remove(item.cube));
        cubes.length = 0;
        // é‡ç½®åæ›´æ–°æ‰€æœ‰è§†å›¾
        renderer.render(scene, camera);
        updateSideViews();
    }

    /**
     * æ’¤å›
     */
    function withdraw() {
        if (cubes.length > 0) {
            const lastElement = cubes.pop();
            let key = lastElement.key;
            gridData[key].y -= 1
            document.getElementById(lastElement.key).textContent = gridData[key].y
            scene.remove(lastElement.cube);
            // æ’¤å›åæ›´æ–°æ‰€æœ‰è§†å›¾
            renderer.render(scene, camera);
            updateSideViews();
        }
    }

    /**
     * å¿«é€Ÿç”Ÿæˆ nÃ—nÃ—n çš„ç«‹æ–¹ä½“ç»„åˆ
     * @param n å°ºå¯¸
     */
    function quickBuild(n) {
        // é¦–å…ˆé‡ç½®åœºæ™¯
        resetAll();
        
        // ç¡®ä¿ n ä¸è¶…è¿‡ç½‘æ ¼å¤§å°
        n = Math.min(n, 5);
        
        // è®¡ç®—èµ·å§‹ä½ç½®ï¼Œä½¿ç«‹æ–¹ä½“ç»„åˆå±…ä¸­
        const start = Math.max(-2, -Math.floor(n/2));
        const end = Math.min(2, start + n - 1);
        
        // éå†ç”Ÿæˆç«‹æ–¹ä½“
        for(let x = start; x <= end; x++) {
            for(let z = start; z <= end; z++) {
                for(let y = 0; y < n; y++) {
                    const key = `${x}-${z}`;
                    if (gridData[key]) {
                        gridData[key].y = y + 1;
                        // æ›´æ–°æŒ‰é’®æ˜¾ç¤º
                        document.getElementById(key).textContent = gridData[key].y;
                        // æ·»åŠ ç«‹æ–¹ä½“
                        addCube(gridData[key]);
                    }
                }
            }
        }
    }

    // åˆå§‹åŒ–
    window.addEventListener('load', () => {
        initScene();
        createControlGrid();
        resetAll();
        document.getElementById('reset').addEventListener('click', resetAll);
        document.getElementById('withdraw').addEventListener('click', withdraw);
        
        // æ·»åŠ å¿«é€Ÿç”ŸæˆæŒ‰é’®çš„äº‹ä»¶ç›‘å¬
        document.getElementById('quick-2').addEventListener('click', () => quickBuild(2));
        document.getElementById('quick-3').addEventListener('click', () => quickBuild(3));
        document.getElementById('quick-4').addEventListener('click', () => quickBuild(4));
        document.getElementById('quick-5').addEventListener('click', () => quickBuild(5));
    });


</script>

</html>