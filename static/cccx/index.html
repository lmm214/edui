<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>虚拟曹冲称象</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Microsoft YaHei', Arial, sans-serif;
            overflow: hidden;
            background-image: linear-gradient(to top, #dfe9f3 0%, white 100%);
            height: 100vh;
            width: 100vw;
        }

        .container {
            width: 100vw;
            height: 100vh;
            position: relative;
            display: flex;
        }

        .main-area {
            flex: 1;
            position: relative;
            overflow: hidden;
        }

        .water-surface {
            position: absolute;
            bottom: 0;
            left: 0;
            width: 100%;
            height: 280px;
            background-image: url('shuimian.png');
            background-size: auto 130%;
            background-position: 0 center;
            background-repeat: repeat-x;
            z-index: 99;
            opacity: 0.6;
            animation: water-flow 40s linear infinite;
        }

        @keyframes water-flow {
            0% {
                background-position: 0 center;
            }
            50% {
                background-position: 100% center;
            }
            100% {
                background-position: 0 center;
            }
        }

        .boat {
            position: absolute;
            bottom: 200px;
            left: 25%;
            width: 680px;
            height: auto;
            z-index: 10;
            transition: transform 0.3s ease;
        }
        .boat-img{
            opacity: 0.8;
        }
        .boat img {
            opacity:0.88;
            width: 100%;
            height: auto;
            filter: drop-shadow(2px 2px 4px rgba(0,0,0,0.3));
            animation: boat-float 4s ease-in-out infinite;
        }

        .water-line {
            position: absolute;
            left: 20%;
            right: 25%;
            height: 4px;
            background-color: #fff;
            z-index: 15;
            top: 55%;
            transform: translateY(-50%);
            box-shadow: 0 0 5px rgba(231, 76, 60, 0.6);
            animation: boat-float 4s ease-in-out infinite;
        }

        .boat-stones {
            position: absolute;
            bottom: 135px;
            left: 70px;
            width: 500px;
            height: auto;
            display: flex;
            flex-wrap: wrap-reverse;
            justify-content: center;
            align-items: flex-end;
            gap:0;
        }

        .control-panel {
            width: 300px;
            background:#fff;
            padding: 20px;
            box-shadow: -2px 0 10px rgba(0,0,0,0.1);
            display: flex;
            flex-direction: column;
            gap: 20px;
        }

        .panel-title {
            text-align: center;
            font-size: 24px;
            font-weight: bold;
            color: #2c3e50;
            margin-bottom: 10px;
        }

        .stones-container {
            padding: 25px;
            background: rgba(240, 240, 240, 0.8);
            border-radius: 10px;
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 20px;
        }

        .stone {
            width: 100px;
            height: 100px;
            cursor: grab;
            transition: transform 0.2s ease;
            filter: drop-shadow(2px 2px 4px rgba(0,0,0,0.3));
        }

        .stone:hover {
            transform: scale(1.1);
        }

        .stone:active {
            cursor: grabbing;
        }

        .stone img {
            width: 100%;
            height: 100%;
            object-fit: contain;
        }

        .stone-on-boat {
            width: 100px !important;
            height: 100px !important;
            position: relative;
            margin: -50px -20px 0;
            cursor: grab;
            transition: transform 0.2s ease;
        }

        .stone-on-boat:hover {
            transform: scale(1.05);
        }

        .stone-on-boat:active {
            cursor: grabbing;
        }

        .reset-btn {
            padding: 12px 24px;
            background: #e74c3c;
            color: white;
            border: none;
            border-radius: 8px;
            font-size: 16px;
            cursor: pointer;
            transition: background 0.3s ease;
        }

        .reset-btn:hover {
            background: #c0392b;
        }

        .dragging {
            z-index: 1000;
            width: 100px;
            height: 100px;
            opacity: 0.8;
        }

        @keyframes boat-float {
            0%, 100% { 
                transform: translateY(0px) rotate(0deg); 
            }
            25% { 
                transform: translateY(-1px) rotate(0.1deg); 
            }
            50% { 
                transform: translateY(0px) rotate(0deg); 
            }
            75% { 
                transform: translateY(1px) rotate(-0.1deg); 
            }
        }

        .boat {
            position: absolute;
            bottom: 200px;
            left: 25%;
            width: 680px;
            height: auto;
            z-index: 10;
            transition: transform 0.3s ease;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="main-area">
            <div class="water-surface"></div>
            <div class="boat floating" id="boat">
                <img class="boat-img" src="chuan.png" alt="小船">
                <div class="water-line" id="waterLine"></div>
                <div class="boat-stones" id="boatStones"></div>
            </div>
        </div>
        
        <div class="control-panel">
            <h2 class="panel-title">曹冲称象</h2>
            
            <div class="stones-container" id="stonesContainer">
                <div class="stone" data-weight="4" data-stone="3">
                    <img src="st-3.png" alt="石头3">
                </div>
                <div class="stone" data-weight="8" data-stone="2">
                    <img src="st-2.png" alt="石头2">
                </div>
                <div class="stone" data-weight="10" data-stone="4">
                    <img src="st-4.png" alt="石头4">
                </div>
                <div class="stone" data-weight="10" data-stone="7">
                    <img src="st-7.png" alt="石头7">
                </div>
                <div class="stone" data-weight="18" data-stone="6">
                    <img src="st-6.png" alt="石头6">
                </div>
                <div class="stone" data-weight="20" data-stone="1">
                    <img src="st-1.png" alt="石头1">
                </div>
                <div class="stone" data-weight="30" data-stone="5">
                    <img src="st-5.png" alt="石头5">
                </div>
            </div>
            
            <button class="reset-btn" onclick="resetBoat()">重置</button>
            
        </div>
    </div>

    <script>
        let totalWeight = 0;
        let stonesOnBoat = [];
        let draggedElement = null;
        let stoneCounter = {}; // 记录每种石头的数量

        // 初始化拖拽功能
        function initDragAndDrop() {
            const stones = document.querySelectorAll('.stone');
            const boat = document.getElementById('boat');
            const boatStones = document.getElementById('boatStones');
            const controlPanel = document.querySelector('.control-panel');

            stones.forEach(stone => {
                // 鼠标事件
                stone.addEventListener('mousedown', startDrag);
                stone.addEventListener('dragstart', e => e.preventDefault());
                
                // 触摸事件
                stone.addEventListener('touchstart', startTouchDrag, {passive: false});
            });

            // 鼠标事件
            document.addEventListener('mousemove', drag);
            document.addEventListener('mouseup', endDrag);
            
            // 触摸事件
            document.addEventListener('touchmove', touchDrag, {passive: false});
            document.addEventListener('touchend', endTouchDrag);

            // 设置船只为放置目标
            boat.addEventListener('dragover', e => e.preventDefault());
            //boat.addEventListener('drop', dropOnBoat);
            
            // 设置控制面板为放置目标（用于拖回石头）
            controlPanel.addEventListener('dragover', e => e.preventDefault());
        }

        function startDrag(e) {
            e.preventDefault();
            draggedElement = e.target.closest('.stone') || e.target.closest('.stone-on-boat');
            if (draggedElement) {
                draggedElement.classList.add('dragging');
                
                // 创建拖拽副本
                createDragClone();
                updateClonePosition(e);
            }
        }

        function startTouchDrag(e) {
            e.preventDefault();
            draggedElement = e.target.closest('.stone') || e.target.closest('.stone-on-boat');
            if (draggedElement) {
                draggedElement.classList.add('dragging');
                
                // 创建拖拽副本
                createDragClone();
                const touch = e.touches[0];
                updateClonePosition(touch);
            }
        }

        function createDragClone() {
            const clone = draggedElement.cloneNode(true);
            clone.style.position = 'fixed';
            clone.style.pointerEvents = 'none';
            clone.style.zIndex = '1000';
            clone.style.width = '100px';
            clone.style.height = '100px';
            clone.id = 'dragClone';
            
            // 确保克隆元素内的图片也是100px
            const img = clone.querySelector('img');
            if (img) {
                img.style.width = '100px';
                img.style.height = '100px';
            }
            
            document.body.appendChild(clone);
        }

        function drag(e) {
            if (draggedElement) {
                updateClonePosition(e);
            }
        }

        function touchDrag(e) {
            if (draggedElement) {
                e.preventDefault();
                const touch = e.touches[0];
                updateClonePosition(touch);
            }
        }

        function updateClonePosition(e) {
            const clone = document.getElementById('dragClone');
            if (clone) {
                clone.style.left = (e.clientX - 50) + 'px';
                clone.style.top = (e.clientY - 50) + 'px';
            }
        }

        function endDrag(e) {
            if (draggedElement) {
                const clone = document.getElementById('dragClone');
                if (clone) {
                    document.body.removeChild(clone);
                }

                // 检查是否放置在船上
                checkDropOnBoat(e.clientX, e.clientY);

                draggedElement.classList.remove('dragging');
                draggedElement = null;
            }
        }

        function endTouchDrag(e) {
            if (draggedElement) {
                const clone = document.getElementById('dragClone');
                if (clone) {
                    document.body.removeChild(clone);
                }

                // 检查是否放置在船上
                const touch = e.changedTouches[0];
                checkDropOnBoat(touch.clientX, touch.clientY);

                draggedElement.classList.remove('dragging');
                draggedElement = null;
            }
        }

        function checkDropOnBoat(x, y) {
            const boat = document.getElementById('boat');
            const boatRect = boat.getBoundingClientRect();
            const controlPanel = document.querySelector('.control-panel');
            const controlRect = controlPanel.getBoundingClientRect();
            
            // 检查是否拖拽到控制面板（拖回）
            if (x >= controlRect.left && x <= controlRect.right &&
                y >= controlRect.top && y <= controlRect.bottom) {
                if (draggedElement.classList.contains('stone-on-boat')) {
                    removeStoneFromBoat(draggedElement);
                }
                return;
            }
            
            // 检查是否拖拽到船上（添加）
            if (x >= boatRect.left && x <= boatRect.right &&
                y >= boatRect.top && y <= boatRect.bottom) {
                if (draggedElement.classList.contains('stone')) {
                    addStoneToBoat(draggedElement);
                }
            }
        }

        function addStoneToBoat(stoneElement) {
            const weight = parseInt(stoneElement.dataset.weight);
            const stoneType = stoneElement.dataset.stone;
            
            // 初始化计数器
            if (!stoneCounter[stoneType]) {
                stoneCounter[stoneType] = 0;
            }
            
            // 增加计数
            stoneCounter[stoneType]++;

            // 添加到船上
            const boatStone = document.createElement('div');
            boatStone.className = 'stone-on-boat';
            boatStone.innerHTML = `<img src="st-${stoneType}.png" alt="石头${stoneType}">`;
            boatStone.dataset.weight = weight;
            boatStone.dataset.stone = stoneType;
            boatStone.dataset.id = `${stoneType}-${stoneCounter[stoneType]}`;
            
            // 添加点击删除功能和拖拽功能
            boatStone.addEventListener('click', function() {
                removeStoneFromBoat(this);
            });
            
            // 为船上的石头添加拖拽事件
            boatStone.addEventListener('mousedown', startDrag);
            boatStone.addEventListener('touchstart', startTouchDrag, {passive: false});
            boatStone.addEventListener('dragstart', e => e.preventDefault());
            
            document.getElementById('boatStones').appendChild(boatStone);
            
            // 更新数据
            stonesOnBoat.push({
                type: stoneType, 
                weight: weight, 
                element: boatStone,
                id: `${stoneType}-${stoneCounter[stoneType]}`
            });
            totalWeight += weight;
            
            updateDisplay();
        }

        function removeStoneFromBoat(stoneElement) {
            const weight = parseInt(stoneElement.dataset.weight);
            const stoneId = stoneElement.dataset.id;
            
            // 从数组中移除
            stonesOnBoat = stonesOnBoat.filter(stone => stone.id !== stoneId);
            totalWeight -= weight;
            
            // 从DOM中移除
            stoneElement.remove();
            
            updateDisplay();
        }

        function updateDisplay() {
            // 船只和水位线下沉效果
            const boat = document.getElementById('boat');
            const waterLine = document.getElementById('waterLine');
            const targetWeight = 200; // 水位线重量
            const sinkAmount = (totalWeight / targetWeight) * 45; // 最多下沉40px
            
            // 船只整体下沉，但保持浮动动画
            boat.style.transform = `translateY(${sinkAmount}px)`;
            
            // 检查是否达到水位线
            if (totalWeight >= targetWeight - 10 && totalWeight <= targetWeight + 10) {
                waterLine.style.backgroundColor = '#27ae60';
                waterLine.style.boxShadow = '0 0 10px rgba(39, 174, 96, 0.9)';
            } else {
                waterLine.style.backgroundColor = '#fff';
                waterLine.style.boxShadow = '0 0 5px rgba(231, 76, 60, 0.6)';
            }
        }

        function resetBoat() {
            // 清空船上的石头
            document.getElementById('boatStones').innerHTML = '';
            
            // 重置数据
            stonesOnBoat = [];
            totalWeight = 0;
            stoneCounter = {};
            
            // 重置船只位置
            const boat = document.getElementById('boat');
            boat.style.transform = 'translateY(0px)';
            
            updateDisplay();
        }

        // 页面加载完成后初始化
        document.addEventListener('DOMContentLoaded', function() {
            initDragAndDrop();
            updateDisplay();
        });
    </script>
</body>
</html>
