<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>五年级上册"小数乘法"单元互动教学</title>
    <link href="https://lf9-cdn-tos.bytecdntp.com/cdn/expire-1-M/tailwindcss/2.2.19/tailwind.css" type="text/css" rel="stylesheet" />
    <script src="https://lf6-cdn-tos.bytecdntp.com/cdn/expire-1-M/Chart.js/3.7.1/chart.min.js" type="application/javascript"></script>
    <style>
        body {
            font-family: 'Noto Sans SC', sans-serif;
        }
        header{background-color: #fefefe;}
        .demo-section {
            font-size: 1rem;
        }
        .large-display {
            font-size: 1.5rem;
            font-weight: bold;
        }
        .extra-large-display {
            font-size: 2rem;
            font-weight: bold;
        }
        .interactive-button {
            font-size: 1rem;
            padding: 0.75rem 1.5rem;
            min-width: 120px;
        }
        .input-large {
            font-size: 1rem;
            padding: 0.75rem;
            min-width: 100px;
        }
        
        /* 响应式字体和间距 */
        @media (min-width: 1024px) {
            .large-display {
                font-size: 1.75rem;
            }
            .extra-large-display {
                font-size: 2.5rem;
            }
        }
        
        @media (min-width: 1280px) {
            .demo-section {
                font-size: 1.2rem;
            }
            .large-display {
                font-size: 2rem;
            }
            .extra-large-display {
                font-size: 3rem;
            }
            .interactive-button {
                font-size: 1.25rem;
                padding: 1rem 2rem;
                min-width: 160px;
            }
            .input-large {
                font-size: 1.25rem;
                padding: 1rem;
                min-width: 120px;
            }
        }
        
        @media (min-width: 1536px) {
            .demo-section {
                font-size: 1.3rem;
            }
            .interactive-button {
                font-size: 1.5rem;
                min-width: 200px;
            }
            .input-large {
                font-size: 1.5rem;
                min-width: 150px;
            }
        }
        
        /* 小屏幕优化 */
         @media (max-width: 1023px) {
             .demo-section {
                 padding: 1.5rem !important;
             }
             .grid.lg\:grid-cols-3 {
                 grid-template-columns: 1fr;
                 gap: 1rem;
             }
             .lg\:col-span-2 {
                 grid-column: span 1;
             }
             .grid.lg\:grid-cols-4 {
                 grid-template-columns: repeat(2, 1fr);
             }
         }
         
         /* 超小屏幕优化 */
         @media (max-width: 640px) {
             .demo-section {
                 padding: 1rem !important;
             }
             .grid.lg\:grid-cols-4 {
                 grid-template-columns: 1fr;
             }
             .grid.lg\:grid-cols-2 {
                 grid-template-columns: 1fr;
             }
             .hidden.md\:flex {
                 display: none !important;
             }
         }
         
         /* 图表响应式 */
         @media (max-width: 768px) {
             #l4_chart {
                 height: 300px !important;
             }
         }
         
         @media (max-width: 480px) {
             #l4_chart {
                 height: 250px !important;
             }
         }
        html {
            scroll-behavior: smooth;
        }
        .nav-link {
            transition: all 0.3s ease;
        }
        .nav-link.active {
            color: #14b8a6;
            border-bottom-color: #14b8a6;
        }
        .pulse-animation {
            animation: pulse 2s infinite;
        }
        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.7; }
        }
        .slide-in {
            animation: slideIn 0.5s ease-out;
        }
        @keyframes slideIn {
            from { transform: translateY(20px); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }
    </style>
</head>
<body class="bg-gradient-to-br from-blue-50 to-teal-50 text-slate-800">

    <header class="bg-white/90 backdrop-blur-lg sticky top-0 z-50 shadow-lg">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex items-center justify-between h-16 sm:h-18 lg:h-20">
                <h1 class="text-lg sm:text-xl md:text-2xl lg:text-3xl xl:text-4xl font-bold text-teal-600">小数乘法单元互动教学</h1>
                <nav class="hidden md:flex space-x-4 lg:space-x-6 xl:space-x-8" id="desktop-nav">
                    <a href="#overview" class="nav-link text-sm lg:text-base xl:text-lg text-slate-600 hover:text-teal-600 border-b-2 border-transparent pb-1">单元概览</a>
                    <a href="#lesson1" class="nav-link text-sm lg:text-base xl:text-lg text-slate-600 hover:text-teal-600 border-b-2 border-transparent pb-1">小数乘整数</a>
                    <a href="#lesson2" class="nav-link text-sm lg:text-base xl:text-lg text-slate-600 hover:text-teal-600 border-b-2 border-transparent pb-1">小数乘小数</a>
                    <a href="#lesson3" class="nav-link text-sm lg:text-base xl:text-lg text-slate-600 hover:text-teal-600 border-b-2 border-transparent pb-1">估算应用</a>
                    <a href="#lesson4" class="nav-link text-sm lg:text-base xl:text-lg text-slate-600 hover:text-teal-600 border-b-2 border-transparent pb-1">分段计费</a>
                </nav>
            </div>
        </div>
    </header>

    <main class="max-w-7xl mx-auto p-6 lg:p-8">

        <section id="overview" class="demo-section mb-12 lg:mb-16 xl:mb-20 scroll-mt-16 lg:scroll-mt-20 xl:scroll-mt-24">
            <h2 class="text-3xl sm:text-4xl lg:text-5xl xl:text-6xl font-bold text-slate-900 mb-6 lg:mb-8 text-center">单元教学核心思路</h2>
            <div class="text-center mb-8 lg:mb-12">
                <p class="text-lg sm:text-xl lg:text-2xl text-slate-700 leading-relaxed px-4">结构化与情境化并行，将知识点视为有机整体</p>
            </div>
            <div class="grid sm:grid-cols-2 lg:grid-cols-4 gap-4 sm:gap-6 lg:gap-8">
                <div class="bg-white p-4 sm:p-6 lg:p-8 rounded-2xl shadow-xl border-2 border-teal-200 hover:shadow-2xl transition-all duration-300 transform hover:scale-105">
                    <div class="text-4xl sm:text-5xl lg:text-6xl mb-3 lg:mb-4 text-center">🎯</div>
                    <h3 class="font-bold text-teal-700 text-lg sm:text-xl lg:text-2xl mb-2 lg:mb-4 text-center">逻辑起点</h3>
                    <p class="text-slate-600 text-sm sm:text-base lg:text-lg text-center">小数乘整数为基础<br>转化为已知知识</p>
                </div>
                <div class="bg-white p-4 sm:p-6 lg:p-8 rounded-2xl shadow-xl border-2 border-blue-200 hover:shadow-2xl transition-all duration-300 transform hover:scale-105">
                    <div class="text-4xl sm:text-5xl lg:text-6xl mb-3 lg:mb-4 text-center">🔍</div>
                    <h3 class="font-bold text-blue-700 text-lg sm:text-xl lg:text-2xl mb-2 lg:mb-4 text-center">核心拓展</h3>
                    <p class="text-slate-600 text-sm sm:text-base lg:text-lg text-center">小数乘小数探究<br>面积模型突破难点</p>
                </div>
                <div class="bg-white p-4 sm:p-6 lg:p-8 rounded-2xl shadow-xl border-2 border-purple-200 hover:shadow-2xl transition-all duration-300 transform hover:scale-105">
                    <div class="text-4xl sm:text-5xl lg:text-6xl mb-3 lg:mb-4 text-center">📝</div>
                    <h3 class="font-bold text-purple-700 text-lg sm:text-xl lg:text-2xl mb-2 lg:mb-4 text-center">算理归纳</h3>
                    <p class="text-slate-600 text-sm sm:text-base lg:text-lg text-center">总结一般法则<br>形成通用方法</p>
                </div>
                <div class="bg-white p-4 sm:p-6 lg:p-8 rounded-2xl shadow-xl border-2 border-green-200 hover:shadow-2xl transition-all duration-300 transform hover:scale-105">
                    <div class="text-4xl sm:text-5xl lg:text-6xl mb-3 lg:mb-4 text-center">🚀</div>
                    <h3 class="font-bold text-green-700 text-lg sm:text-xl lg:text-2xl mb-2 lg:mb-4 text-center">应用深化</h3>
                    <p class="text-slate-600 text-sm sm:text-base lg:text-lg text-center">估算与分段计费<br>培养模型思想</p>
                </div>
            </div>
        </section>

        <section id="lesson1" class="demo-section bg-white p-6 sm:p-8 lg:p-12 rounded-2xl lg:rounded-3xl shadow-2xl border-2 border-teal-200 mb-12 lg:mb-16 xl:mb-20 scroll-mt-16 lg:scroll-mt-20 xl:scroll-mt-24">
            <h2 class="text-3xl sm:text-4xl lg:text-5xl xl:text-6xl font-bold text-slate-900 mb-4 lg:mb-6 text-center">小数乘整数</h2>
            <p class="text-lg sm:text-xl lg:text-2xl text-slate-600 mb-8 lg:mb-12 text-center">核心思想：转化与迁移</p>
            
            <div class="grid sm:grid-cols-1 lg:grid-cols-3 gap-4 sm:gap-6 lg:gap-8">
                <!-- 方法一：加法模型演示 -->
                <div class="bg-gradient-to-r from-purple-50 to-pink-50 p-4 sm:p-6 rounded-xl lg:rounded-2xl">
                    <h3 class="text-lg sm:text-xl lg:text-2xl font-semibold mb-3 lg:mb-4 text-center">方法一：加法模型</h3>
                    <div class="flex flex-col items-center space-y-4 mb-6">
                        <div class="flex items-center space-x-2">
                            <input type="number" id="l1_add_num1" value="3.5" class="w-24 p-2 text-center border-2 border-purple-300 rounded-lg focus:ring-2 focus:ring-purple-200 focus:border-purple-500">
                            <span class="text-lg">连加</span>
                            <input type="number" id="l1_add_num2" value="3" class="w-24 p-2 text-center border-2 border-purple-300 rounded-lg focus:ring-2 focus:ring-purple-200 focus:border-purple-500">
                            <span class="text-lg">次</span>
                        </div>
                        <button id="l1_addBtn" class="px-4 py-2 bg-purple-600 text-white font-semibold rounded-lg hover:bg-purple-700 transition">演示</button>
                    </div>
                    <div id="l1_add_result" class="p-4 bg-white rounded-xl shadow-md text-lg leading-relaxed min-h-[250px]">
                        <p class="text-center text-gray-500">点击演示按钮，查看连加过程</p>
                    </div>
                </div>

                <!-- 方法二：单位换算演示 -->
                <div class="bg-gradient-to-r from-green-50 to-emerald-50 p-4 sm:p-6 rounded-xl lg:rounded-2xl">
                    <h3 class="text-lg sm:text-xl lg:text-2xl font-semibold mb-3 lg:mb-4 text-center">方法二：单位换算</h3>
                    <div class="flex flex-col items-center space-y-4 mb-6">
                        <div class="flex items-center space-x-4">
                            <div class="text-center">
                                <p class="text-lg mb-1">价格（元）</p>
                                <input type="number" id="l1_unit_price" value="3.5" class="w-24 p-2 text-center border-2 border-green-300 rounded-lg focus:ring-2 focus:ring-green-200 focus:border-green-500">
                            </div>
                            <span class="text-2xl font-bold">×</span>
                            <div class="text-center">
                                <p class="text-lg mb-1">数量</p>
                                <input type="number" id="l1_unit_count" value="3" class="w-24 p-2 text-center border-2 border-green-300 rounded-lg focus:ring-2 focus:ring-green-200 focus:border-green-500">
                            </div>
                        </div>
                        <button id="l1_unitBtn" class="px-4 py-2 bg-green-600 text-white font-semibold rounded-lg hover:bg-green-700 transition">换算</button>
                    </div>
                    <div id="l1_unit_result" class="p-4 bg-white rounded-xl shadow-md text-lg leading-relaxed min-h-[250px]">
                        <p class="text-center text-gray-500">点击换算按钮，查看元角换算过程</p>
                    </div>
                </div>

                <!-- 方法三：算理转化演示 -->
                <div class="bg-gradient-to-r from-teal-50 to-blue-50 p-4 sm:p-6 rounded-xl lg:rounded-2xl">
                    <h3 class="text-lg sm:text-xl lg:text-2xl font-semibold mb-3 lg:mb-4 text-center">方法三：算理转化</h3>
                    <div class="flex flex-col items-center space-y-4 mb-6">
                        <div class="flex items-center space-x-4">
                            <input type="number" id="l1_num1" value="3.5" class="w-24 p-2 text-center border-2 border-teal-300 rounded-lg focus:ring-2 focus:ring-teal-200 focus:border-teal-500">
                            <span class="text-2xl font-bold">×</span>
                            <input type="number" id="l1_num2" value="3" class="w-24 p-2 text-center border-2 border-teal-300 rounded-lg focus:ring-2 focus:ring-teal-200 focus:border-teal-500">
                        </div>
                        <button id="l1_calcBtn" class="px-4 py-2 bg-blue-600 text-white font-semibold rounded-lg hover:bg-blue-700 transition">计算</button>
                    </div>
                    <div id="l1_result" class="p-4 bg-white rounded-xl shadow-md text-lg leading-relaxed min-h-[250px]">
                        <p class="text-center text-gray-500">点击计算按钮，查看算理分解步骤</p>
                    </div>
                </div>
            </div>
        </section>

        <section id="lesson2" class="demo-section bg-white p-6 sm:p-8 lg:p-12 rounded-2xl lg:rounded-3xl shadow-2xl border-2 border-blue-200 mb-12 lg:mb-16 xl:mb-20 scroll-mt-16 lg:scroll-mt-20 xl:scroll-mt-24">
            <h2 class="text-3xl sm:text-4xl lg:text-5xl xl:text-6xl font-bold text-slate-900 mb-4 lg:mb-6 text-center">小数乘小数</h2>
            <p class="text-lg sm:text-xl lg:text-2xl text-slate-600 mb-8 lg:mb-12 text-center">核心思想：面积模型支撑，归纳发现</p>
            
            <div class="grid lg:grid-cols-3 gap-8 items-start">
                <div class="bg-gradient-to-r from-blue-50 to-purple-50 p-4 sm:p-6 lg:p-8 rounded-xl lg:rounded-2xl lg:col-span-1 space-y-6">
                    <h3 class="text-xl sm:text-2xl lg:text-3xl font-semibold text-center">面积模型互动探究</h3>
                    <div class="">
                        <p class="text-base sm:text-lg lg:text-xl mb-6 lg:mb-8 text-center text-slate-700">拖动滑块，观察长宽变化如何影响面积</p>
                        <div class="space-y-6">
                            <div>
                                <label class="block mb-3 text-2xl font-medium">长: <span id="l2_val1" class="text-teal-600 font-bold">0.8</span> 米</label>
                                <input type="range" id="l2_num1" min="0.1" max="1" step="0.1" value="0.8" class="w-full h-4 bg-teal-200 rounded-lg appearance-none cursor-pointer">
                            </div>
                            <div>
                                <label class="block mb-3 text-2xl font-medium">宽: <span id="l2_val2" class="text-blue-600 font-bold">0.6</span> 米</label>
                                <input type="range" id="l2_num2" min="0.1" max="1" step="0.1" value="0.6" class="w-full h-4 bg-blue-200 rounded-lg appearance-none cursor-pointer">
                            </div>
                        </div>
                        <div class="mt-8 p-6 bg-white rounded-2xl shadow-lg text-center">
                            <p class="text-2xl mb-2">面积计算：</p>
                            <p class="extra-large-display text-purple-600"><span id="l2_result">0.48</span> 平方米</p>
                        </div>
                    </div>
                </div>
                
                <div class="lg:col-span-2 bg-gradient-to-r from-green-50 to-teal-50 p-8 rounded-2xl">
                    <h3 class="text-xl sm:text-2xl lg:text-3xl font-semibold mb-4 lg:mb-6 text-center">可视化面积模型</h3>
                    <canvas id="l2_canvas" class="w-full aspect-square rounded-2xl bg-white shadow-lg border-4 border-gray-200"></canvas>
                    <div class="mt-6 text-center">
                        <p class="text-xl text-slate-700">绿色区域 = 长 × 宽</p>
                        <p class="text-lg text-slate-600 mt-2">观察：两个小于1的数相乘，积更小</p>
                    </div>
                </div>
            </div>
        </section>

        <section id="lesson3" class="demo-section bg-white p-6 sm:p-8 lg:p-12 rounded-2xl lg:rounded-3xl shadow-2xl border-2 border-orange-200 mb-12 lg:mb-16 xl:mb-20 scroll-mt-16 lg:scroll-mt-20 xl:scroll-mt-24">
            <h2 class="text-3xl sm:text-4xl lg:text-5xl xl:text-6xl font-bold text-slate-900 mb-4 lg:mb-6 text-center">估算策略应用</h2>
            <p class="text-lg sm:text-xl lg:text-2xl text-slate-600 mb-8 lg:mb-12 text-center">核心思想：按需估算，策略择优</p>
            
            <div class="bg-gradient-to-r from-orange-50 to-red-50 p-4 sm:p-6 lg:p-8 rounded-xl lg:rounded-2xl">
                <div class="grid lg:grid-cols-2 gap-8">
                    <div class="bg-white p-6 rounded-2xl shadow-lg">
                        <p class="text-xl mb-4 text-center font-medium">🛒 购物情境</p>
                        <p class="text-lg mb-4 text-center">妈妈带100元，要买4.8千克苹果，每千克19.8元</p>
                        <p class="text-2xl text-center font-bold text-red-600">问题：钱够不够？</p>
                    </div>
                    
                    <div id="l3_quiz" class="space-y-4">
                        <p class="text-xl font-medium mb-4 text-center">选择最佳估算策略：</p>
                        <div class="space-y-3">
                            <label class="flex items-center p-4 border-2 border-orange-300 rounded-xl hover:bg-orange-100 cursor-pointer transition-colors">
                                <input type="radio" name="strategy" value="up" class="mr-4 w-5 h-5 text-orange-600 focus:ring-orange-500">
                                <div>
                                    <span class="text-lg font-semibold">策略A：都往大估</span>
                                    <p class="text-sm text-slate-600 mt-1">19.8 ≈ 20，4.8 ≈ 5，计算 20 × 5 = 100</p>
                                </div>
                            </label>
                            <label class="flex items-center p-4 border-2 border-orange-300 rounded-xl hover:bg-orange-100 cursor-pointer transition-colors">
                                <input type="radio" name="strategy" value="down" class="mr-4 w-5 h-5 text-orange-600 focus:ring-orange-500">
                                <div>
                                    <span class="text-lg font-semibold">策略B：都往小估</span>
                                    <p class="text-sm text-slate-600 mt-1">19.8 ≈ 19，4.8 ≈ 4，计算 19 × 4 = 76</p>
                                </div>
                            </label>
                        </div>
                    </div>
                </div>
                <div id="l3_feedback" class="mt-6 p-6 rounded-2xl text-lg font-medium hidden"></div>
            </div>
        </section>

        <section id="lesson4" class="demo-section bg-white p-6 sm:p-8 lg:p-12 rounded-2xl lg:rounded-3xl shadow-2xl border-2 border-green-200 mb-12 lg:mb-16 xl:mb-20 scroll-mt-16 lg:scroll-mt-20 xl:scroll-mt-24">
            <h2 class="text-3xl sm:text-4xl lg:text-5xl xl:text-6xl font-bold text-slate-900 mb-4 lg:mb-6 text-center">分段计费问题</h2>
            <p class="text-lg sm:text-xl lg:text-2xl text-slate-600 mb-8 lg:mb-12 text-center">核心思想：理解规则，化繁为简</p>
            
            <div class="grid lg:grid-cols-3 gap-8 items-start">
                <div class="bg-gradient-to-r from-green-50 to-blue-50 p-4 sm:p-6 lg:p-8 rounded-xl lg:rounded-2xl space-y-6">
                    <h3 class="text-xl sm:text-2xl lg:text-3xl font-semibold text-center">水费计算器</h3>
                    <div class="">
                        <div class="bg-white p-6 rounded-xl shadow-md mb-6">
                            <h4 class="text-2xl font-bold mb-4 text-center">计费规则</h4>
                            <div class="space-y-3 text-lg">
                                <p>📊 第一档：≤20吨，每吨 <span class="font-bold text-green-600">2.8元</span></p>
                                <p>📈 第二档：>20吨，每吨 <span class="font-bold text-red-600">3.5元</span></p>
                            </div>
                        </div>
                        
                        <div class="flex items-center justify-center space-x-4 mb-8">
                            <label class="text-2xl font-medium">用水量：</label>
                            <input type="number" id="l4_usage" value="25" class="input-large text-center border-2 border-green-300 rounded-xl focus:ring-4 focus:ring-green-200 focus:border-green-500">
                            <span class="text-2xl font-medium">吨</span>
                        </div>
                        
                        <div id="l4_result" class="p-8 bg-white rounded-2xl shadow-lg text-xl leading-relaxed min-h-[200px]">
                        </div>
                    </div>
                </div>
                
                <div class="lg:col-span-2 bg-gradient-to-r from-purple-50 to-pink-50 p-8 rounded-2xl">
                    <h3 class="text-xl sm:text-2xl lg:text-3xl font-semibold mb-4 lg:mb-6 text-center">用水量可视化</h3>
                    <div class="bg-white p-6 rounded-2xl shadow-lg">
                        <canvas id="l4_chart" class="w-full" style="height: 400px;"></canvas>
                    </div>
                </div>
            </div>
        </section>

    </main>

    <footer class="bg-gradient-to-r from-slate-800 to-slate-900 text-white mt-12 lg:mt-16 xl:mt-20">
        <div class="max-w-7xl mx-auto py-8 sm:py-10 lg:py-12 px-4 sm:px-6 lg:px-8 text-center">
            <h3 class="text-xl sm:text-2xl lg:text-3xl font-bold mb-2 lg:mb-4">五年级上册"小数乘法"单元互动教学</h3>
            <p class="text-base sm:text-lg lg:text-xl text-slate-300">让数学学习更生动，让课堂互动更精彩</p>
        </div>
    </footer>

    <script>
        document.addEventListener('DOMContentLoaded', () => {

            // Navigation scroll highlighting
            const sections = document.querySelectorAll('section');
            const navLinks = document.querySelectorAll('.nav-link');

            const observer = new IntersectionObserver((entries) => {
                entries.forEach(entry => {
                    if (entry.isIntersecting) {
                        navLinks.forEach(link => {
                            link.classList.toggle('active', link.getAttribute('href').substring(1) === entry.target.id);
                        });
                    }
                });
            }, { rootMargin: '-50% 0px -50% 0px' });

            sections.forEach(section => {
                observer.observe(section);
            });

            // Lesson 1: Decimal x Integer
            const l1_num1 = document.getElementById('l1_num1');
            const l1_num2 = document.getElementById('l1_num2');
            const l1_calcBtn = document.getElementById('l1_calcBtn');
            const l1_result = document.getElementById('l1_result');

            function calculateL1() {
                const num1 = parseFloat(l1_num1.value) || 0;
                const num2 = parseInt(l1_num2.value) || 0;
                if (!num1 || !num2) {
                    l1_result.innerHTML = '<p class="text-center text-gray-500 text-xl">请输入有效的数字</p>';
                    return;
                }

                const decimalPlaces = (num1.toString().split('.')[1] || '').length;
                const multiplier = Math.pow(10, decimalPlaces);
                const intNum1 = Math.round(num1 * multiplier);
                const product = intNum1 * num2;
                const finalResult = product / multiplier;

                l1_result.innerHTML = `
                    <div class="space-y-4 slide-in">
                        <div class="text-center p-4 bg-teal-50 rounded-xl">
                            <p class="text-2xl font-bold text-teal-700">算式：${num1} × ${num2}</p>
                        </div>
                        <div class="p-4 bg-blue-50 rounded-xl">
                            <p class="text-xl"><span class="font-bold">步骤1：</span>将 ${num1} 扩大 ${multiplier} 倍 → ${intNum1}</p>
                        </div>
                        <div class="p-4 bg-purple-50 rounded-xl">
                            <p class="text-xl"><span class="font-bold">步骤2：</span>计算整数乘法：${intNum1} × ${num2} = ${product}</p>
                        </div>
                        <div class="p-4 bg-green-50 rounded-xl">
                            <p class="text-xl"><span class="font-bold">步骤3：</span>将积缩小 ${multiplier} 倍 → ${finalResult}</p>
                        </div>
                        <div class="text-center p-6 bg-gradient-to-r from-teal-100 to-blue-100 rounded-xl">
                            <p class="text-3xl font-bold text-teal-600">最终答案：${finalResult}</p>
                        </div>
                    </div>
                `;
            }
            l1_calcBtn.addEventListener('click', calculateL1);

            // Lesson 1: Addition Model
            const l1_add_num1 = document.getElementById('l1_add_num1');
            const l1_add_num2 = document.getElementById('l1_add_num2');
            const l1_addBtn = document.getElementById('l1_addBtn');
            const l1_add_result = document.getElementById('l1_add_result');

            function calculateL1Add() {
                const num1 = parseFloat(l1_add_num1.value) || 0;
                const num2 = parseInt(l1_add_num2.value) || 0;
                if (!num1 || !num2) {
                    l1_add_result.innerHTML = '<p class="text-center text-gray-500 text-xl">请输入有效的数字</p>';
                    return;
                }

                let additionSteps = [];
                let sum = 0;
                for (let i = 1; i <= num2; i++) {
                    sum += num1;
                    additionSteps.push(`第${i}次：${num1} + ${(sum - num1).toFixed(1)} = ${sum.toFixed(1)}`);
                }

                l1_add_result.innerHTML = `
                    <div class="space-y-3 slide-in">
                        <div class="text-center p-4 bg-purple-50 rounded-xl">
                            <p class="text-2xl font-bold text-purple-700">连加过程：${num1} + ${num1} + ... (${num2}次)</p>
                        </div>
                        ${additionSteps.map(step => `
                            <div class="p-3 bg-white rounded-lg border-l-4 border-purple-400">
                                <p class="text-lg">${step}</p>
                            </div>
                        `).join('')}
                        <div class="text-center p-6 bg-gradient-to-r from-purple-100 to-pink-100 rounded-xl">
                            <p class="text-3xl font-bold text-purple-600">最终结果：${sum.toFixed(1)}</p>
                        </div>
                    </div>
                `;
            }
            l1_addBtn.addEventListener('click', calculateL1Add);

            // Lesson 1: Unit Conversion
            const l1_unit_price = document.getElementById('l1_unit_price');
            const l1_unit_count = document.getElementById('l1_unit_count');
            const l1_unitBtn = document.getElementById('l1_unitBtn');
            const l1_unit_result = document.getElementById('l1_unit_result');

            function calculateL1Unit() {
                const price = parseFloat(l1_unit_price.value) || 0;
                const count = parseInt(l1_unit_count.value) || 0;
                if (!price || !count) {
                    l1_unit_result.innerHTML = '<p class="text-center text-gray-500 text-xl">请输入有效的数字</p>';
                    return;
                }

                const priceInJiao = price * 10;
                const totalJiao = priceInJiao * count;
                const totalYuan = totalJiao / 10;

                l1_unit_result.innerHTML = `
                    <div class="space-y-4 slide-in">
                        <div class="text-center p-4 bg-green-50 rounded-xl">
                            <p class="text-2xl font-bold text-green-700">单位换算过程</p>
                        </div>
                        <div class="p-4 bg-blue-50 rounded-xl">
                            <p class="text-xl"><span class="font-bold">步骤1：</span>将价格换算成角：${price}元 = ${priceInJiao}角</p>
                        </div>
                        <div class="p-4 bg-purple-50 rounded-xl">
                            <p class="text-xl"><span class="font-bold">步骤2：</span>计算总角数：${priceInJiao}角 × ${count} = ${totalJiao}角</p>
                        </div>
                        <div class="p-4 bg-yellow-50 rounded-xl">
                            <p class="text-xl"><span class="font-bold">步骤3：</span>换算回元：${totalJiao}角 = ${totalYuan}元</p>
                        </div>
                        <div class="text-center p-6 bg-gradient-to-r from-green-100 to-emerald-100 rounded-xl">
                            <p class="text-3xl font-bold text-green-600">最终答案：${totalYuan}元</p>
                        </div>
                    </div>
                `;
            }
            l1_unitBtn.addEventListener('click', calculateL1Unit);

            // Lesson 2: Decimal x Decimal
            const l2_num1 = document.getElementById('l2_num1');
            const l2_num2 = document.getElementById('l2_num2');
            const l2_val1 = document.getElementById('l2_val1');
            const l2_val2 = document.getElementById('l2_val2');
            const l2_result = document.getElementById('l2_result');
            const l2_canvas = document.getElementById('l2_canvas');
            const ctx2 = l2_canvas.getContext('2d');

            function drawL2() {
                const num1 = parseFloat(l2_num1.value);
                const num2 = parseFloat(l2_num2.value);
                l2_val1.textContent = num1.toFixed(1);
                l2_val2.textContent = num2.toFixed(1);
                l2_result.textContent = (num1 * num2).toFixed(2);

                const width = l2_canvas.width;
                const height = l2_canvas.height;
                ctx2.clearRect(0, 0, width, height);
                
                // Draw grid
                ctx2.strokeStyle = '#e5e7eb';
                ctx2.lineWidth = 2;
                for (let i = 1; i < 10; i++) {
                    ctx2.beginPath();
                    ctx2.moveTo(i * width / 10, 0);
                    ctx2.lineTo(i * width / 10, height);
                    ctx2.moveTo(0, i * height / 10);
                    ctx2.lineTo(width, i * height / 10);
                    ctx2.stroke();
                }

                // Draw bounding box
                ctx2.strokeStyle = '#374151';
                ctx2.lineWidth = 4;
                ctx2.strokeRect(0, 0, width, height);

                // Draw rectangle
                ctx2.fillStyle = 'rgba(34, 197, 94, 0.7)';
                ctx2.fillRect(0, 0, num1 * width, num2 * height);

                ctx2.strokeStyle = '#16a34a';
                ctx2.lineWidth = 4;
                ctx2.strokeRect(0, 0, num1 * width, num2 * height);

                // Add labels
                ctx2.fillStyle = '#1f2937';
                ctx2.font = 'bold 16px sans-serif';
                ctx2.fillText(`长: ${num1}`, 10, height - 10);
                ctx2.fillText(`宽: ${num2}`, width - 80, 25);
            }

            l2_num1.addEventListener('input', drawL2);
            l2_num2.addEventListener('input', drawL2);
            
            // Initial draw for L2
            setTimeout(() => {
                const canvasSize = Math.min(l2_canvas.getBoundingClientRect().width, 500);
                l2_canvas.width = canvasSize;
                l2_canvas.height = canvasSize;
                drawL2();
            }, 100);

            // Lesson 3: Estimation Quiz
            const l3_quiz = document.getElementById('l3_quiz');
            const l3_feedback = document.getElementById('l3_feedback');
            l3_quiz.addEventListener('change', (e) => {
                if (e.target.name === 'strategy') {
                    l3_feedback.classList.remove('hidden', 'bg-red-100', 'text-red-800', 'bg-green-100', 'text-green-800');
                    l3_feedback.classList.add('slide-in');
                    if (e.target.value === 'up') {
                        l3_feedback.classList.add('bg-green-100', 'text-green-800');
                        l3_feedback.innerHTML = `
                            <div class="text-center">
                                <div class="text-4xl mb-4">✅</div>
                                <p class="text-2xl font-bold mb-4">正确！策略A最有效</p>
                                <p class="text-xl">都往大估算出100元，因为实际花费比100元少，所以能确定钱够用。</p>
                                <p class="text-lg mt-4 text-green-600">💡 解决"够不够"问题时，要选择能得出确切结论的策略</p>
                            </div>
                        `;
                    } else {
                        l3_feedback.classList.add('bg-red-100', 'text-red-800');
                        l3_feedback.innerHTML = `
                            <div class="text-center">
                                <div class="text-4xl mb-4">❌</div>
                                <p class="text-2xl font-bold mb-4">再想想哦</p>
                                <p class="text-xl">都往小估算出76元，我们只能确定花费比76元多，但无法确定是否超过100元。</p>
                                <p class="text-lg mt-4 text-red-600">💭 这个策略无法帮我们得出确切的结论</p>
                            </div>
                        `;
                    }
                }
            });

            // Lesson 4: Tiered Pricing
            const l4_usageInput = document.getElementById('l4_usage');
            const l4_result = document.getElementById('l4_result');
            const l4_ctx = document.getElementById('l4_chart').getContext('2d');
            let l4_chart;

            function calculateL4() {
                const usage = parseFloat(l4_usageInput.value) || 0;
                const tier1Rate = 2.8;
                const tier2Rate = 3.5;
                const tier1Limit = 20;

                let tier1Usage = 0;
                let tier2Usage = 0;
                let tier1Cost = 0;
                let tier2Cost = 0;
                let totalCost = 0;

                if (usage > tier1Limit) {
                    tier1Usage = tier1Limit;
                    tier2Usage = usage - tier1Limit;
                } else {
                    tier1Usage = usage;
                    tier2Usage = 0;
                }

                tier1Cost = tier1Usage * tier1Rate;
                tier2Cost = tier2Usage * tier2Rate;
                totalCost = tier1Cost + tier2Cost;

                l4_result.innerHTML = `
                    <div class="space-y-4 slide-in">
                        <div class="text-center p-4 bg-green-50 rounded-xl">
                            <p class="text-2xl font-bold text-green-700">用水量分段计算</p>
                        </div>
                        <div class="p-4 bg-blue-50 rounded-xl">
                            <p class="text-xl"><span class="font-bold">第一档 (≤20吨):</span> ${tier1Usage.toFixed(1)}吨 × ${tier1Rate}元/吨 = <span class="font-bold text-blue-600">${tier1Cost.toFixed(2)}元</span></p>
                        </div>
                        <div class="p-4 bg-red-50 rounded-xl">
                            <p class="text-xl"><span class="font-bold">第二档 (>20吨):</span> ${tier2Usage.toFixed(1)}吨 × ${tier2Rate}元/吨 = <span class="font-bold text-red-600">${tier2Cost.toFixed(2)}元</span></p>
                        </div>
                        <div class="text-center p-6 bg-gradient-to-r from-green-100 to-blue-100 rounded-xl">
                            <p class="text-3xl font-bold text-purple-600">总费用: ${totalCost.toFixed(2)}元</p>
                        </div>
                    </div>
                `;

                updateL4Chart(tier1Usage, tier2Usage);
            }

            function updateL4Chart(tier1, tier2) {
                if (l4_chart) {
                    l4_chart.data.datasets[0].data = [tier1];
                    l4_chart.data.datasets[1].data = [tier2];
                    l4_chart.update();
                }
            }

            l4_chart = new Chart(l4_ctx, {
                type: 'bar',
                data: {
                    labels: ['用水量分段'],
                    datasets: [{
                        label: '第一档用量 (≤20吨)',
                        data: [0],
                        backgroundColor: 'rgba(34, 197, 94, 0.8)',
                        borderColor: 'rgba(34, 197, 94, 1)',
                        borderWidth: 2
                    }, {
                        label: '第二档用量 (>20吨)',
                        data: [0],
                        backgroundColor: 'rgba(239, 68, 68, 0.8)',
                        borderColor: 'rgba(239, 68, 68, 1)',
                        borderWidth: 2
                    }]
                },
                options: {
                    indexAxis: 'y',
                    scales: {
                        x: {
                            stacked: true,
                            title: { 
                                display: true, 
                                text: '用水量 (吨)',
                                font: { size: 16, weight: 'bold' }
                            },
                            ticks: { font: { size: 14 } }
                        },
                        y: {
                            stacked: true,
                            ticks: { font: { size: 14 } }
                        }
                    },
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        title: {
                            display: true,
                            text: '用水量分段可视化',
                            font: { size: 20, weight: 'bold' }
                        },
                        legend: {
                            labels: { font: { size: 14 } }
                        },
                        tooltip: {
                            titleFont: { size: 16 },
                            bodyFont: { size: 14 },
                            callbacks: {
                                label: function(context) {
                                    let label = context.dataset.label || '';
                                    if (label) {
                                        label += ': ';
                                    }
                                    if (context.parsed.x !== null) {
                                        label += context.parsed.x + ' 吨';
                                    }
                                    return label;
                                }
                            }
                        }
                    }
                }
            });

            l4_usageInput.addEventListener('input', calculateL4);
            calculateL4();
        });
    </script>
</body>
</html>