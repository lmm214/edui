<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ã€Šç”¨æ•°å¯¹ç¡®å®šä½ç½®ã€‹äº’åŠ¨æ•™å­¦å¹³å°</title>
    <link href="https://lf9-cdn-tos.bytecdntp.com/cdn/expire-1-M/tailwindcss/2.2.19/tailwind.css" type="text/css" rel="stylesheet" />
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, "Noto Sans", sans-serif, "Apple Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol", "Noto Color Emoji";
        }
        .tab-btn.active {
            border-color: #0d9488; /* teal-600 */
            color: #0d9488;
            background-color: #f0fdfa; /* teal-50 */
        }
        .content-pane {
            display: none;
        }
        .content-pane.active {
            display: block;
            animation: fadeIn 0.5s;
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .grid-cell {
            transition: all 0.3s ease-in-out;
            background-color: white;
            cursor: pointer;
            font-size: 1.5rem;
            font-weight: bold;
            min-height: 4rem;
        }
        #cinema-grid{gap: 0.25rem 1.25rem;}
        #cinema-grid .grid-cell{border-radius: 15px;}
        .grid-cell.selected {
            background-color: #0d9488;
            border: 3px solid #042f2e;
            color: white;
            transform: scale(1.1);
        }
        .grid-cell.highlight {
            background-color: #f59e0b;
            transform: scale(1.15);
            border: 3px solid #b45309;
            z-index: 10;
            box-shadow: 0 0 20px rgba(245, 158, 11, 0.6);
            animation: pulse 1s infinite;
        }
        .grid-cell.path {
            background-color: #a7f3d0;
            animation: pathGlow 0.5s ease-in-out;
        }
        .grid-cell.treasure {
            background-color: #facc15;
            font-size: 2rem;
            line-height: 1;
            animation: treasureFound 1s ease-in-out;
        }
        .grid-cell.cinema-seat {
            background-color: #a6afbc;
            color: white;
            font-size: 0.8rem;
        }
        .grid-cell.cinema-available {
            background-color: #22c55e;
            color: white;
        }
        .grid-cell.grid-style {
            border: 1px solid #ccc;
            background: transparent;
            position: relative;
        }
        .grid-cell.grid-style.selected {
            background-color: #e0f2fe;
            border-color: #0891b2;
        }
        .grid-intersection {
            position: absolute;
            width: 18px;
            height: 18px;
            background: transparent;
            border-radius: 50%;
            cursor: pointer;
            z-index: 10;
            transform: translate(-50%, -50%);
            transition: all 0.2s ease;
        }
        .grid-intersection:hover {
            background: #3b82f6;
            box-shadow: 0 0 8px rgba(59, 130, 246, 0.5);
        }
        .grid-intersection.selected {
            background: #ef4444;
            box-shadow: 0 0 12px rgba(239, 68, 68, 0.7);
        }
        .grid-intersection.animal-point {
            background: #ef4444;
            box-shadow: 0 0 8px rgba(239, 68, 68, 0.6);
        }
        .grid-intersection.treasure-point {
            background: #10b981;
            box-shadow: 0 0 8px rgba(16, 185, 129, 0.6);
        }
        .grid-intersection.treasure-final {
            background: #f59e0b;
            box-shadow: 0 0 12px rgba(245, 158, 11, 0.8);
            width: 16px;
            height: 16px;
        }
        .grid-cell.animal-cell {
            position: relative;
        }
        .grid-cell.animal-cell::before {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 8px;
            height: 8px;
            background: #ef4444;
            border-radius: 50%;
            box-shadow: 0 0 8px rgba(239, 68, 68, 0.6);
            z-index: 2;
        }
        .grid-cell.animal-cell .animal-icon {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-40%, -40%);
            font-size: 1.2rem;
            z-index: 1;
        }
        .grid-cell.origin-cell {
            font-size: 1.2rem;
            font-weight: bold;
            color: #1f2937;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        .animal-icon {
            position: absolute;
            left: 15px;
            top: 15px;
            font-size: 1.8rem;
            pointer-events: none;
            z-index: 1;
        }
        .treasure-label-style {
            position: absolute;
            top: -25px;
            left: 50%;
            transform: translateX(-50%);
            background: #10b981;
            color: white;
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 1rem;
            font-weight: bold;
            z-index: 3;
        }
        .treasure-label-style.final {
            background: #f59e0b;
        }
        .treasure-path-line {
            position: absolute;
            background: #10b981;
            z-index: 1;
            pointer-events: none;
        }
        .treasure-path-point {
            position: relative;
        }
        .treasure-path-point::after {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 12px;
            height: 12px;
            background: #10b981;
            border-radius: 50%;
            z-index: 2;
        }
        .treasure-path-point.treasure-final::after {
            background: #f59e0b;
            width: 16px;
            height: 16px;
        }
        .treasure-label {
            position: absolute;
            top: -20px;
            left: 50%;
            transform: translateX(-50%);
            background: #10b981;
            color: white;
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 1rem;
            font-weight: bold;
            z-index: 3;
        }
        .treasure-label.final {
            background: #f59e0b;
        }
        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.7; }
        }
        @keyframes pathGlow {
            0% { box-shadow: none; }
            50% { box-shadow: 0 0 15px rgba(16, 185, 129, 0.8); }
            100% { box-shadow: none; }
        }
        @keyframes treasureFound {
            0% { transform: scale(1); }
            50% { transform: scale(1.3) rotate(180deg); }
            100% { transform: scale(1) rotate(360deg); }
        }
        @keyframes slideIn {
            from { transform: translateX(-100%); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }
        .slide-in {
            animation: slideIn 0.5s ease-out;
        }
        #shape-canvas {
            position: absolute;
            top: 0;
            left: 0;
            pointer-events: none;
        }
    </style>
</head>
<body class="bg-stone-50 text-slate-800">

    <div class="container mx-auto p-4 md:p-8">
        
        <header class="text-center">
            <h2 class="text-2xl md:text-4xl font-bold text-teal-700 mb-4">ã€Šç”¨æ•°å¯¹ç¡®å®šä½ç½®ã€‹äº’åŠ¨æ•™å­¦å¹³å°</h2>
        </header>

        <div class="w-full p-3 sticky top-0 z-20">
            <nav id="tab-nav" class="flex flex-wrap justify-center space-x-2 md:space-x-6">
                <button data-tab="mystery" class="tab-btn active text-base md:text-xl font-medium p-3 px-6 rounded-md border-2 border-transparent transition-colors duration-300">ğŸ­ ç¥ç§˜å˜‰å®¾</button>
                <button data-tab="cinema" class="tab-btn text-base md:text-xl font-medium p-3 px-6 rounded-md border-2 border-transparent transition-colors duration-300">ğŸ¬ ç”µå½±é™¢</button>
                <button data-tab="practice" class="tab-btn text-base md:text-xl font-medium p-3 px-6 rounded-md border-2 border-transparent transition-colors duration-300">ğŸ¦ åŠ¨ç‰©å›­</button>
                <button data-tab="treasure" class="tab-btn text-base md:text-xl font-medium p-3 px-6 rounded-md border-2 border-transparent transition-colors duration-300">ğŸ’ å¯»å®å¥‡å…µ</button>

            </nav>
        </div>

        <main id="tab-content">
            <!-- ç¥ç§˜å˜‰å®¾ -->
            <section id="mystery" class="content-pane active">
                <div class="bg-white p-6 rounded-lg shadow-lg">
                    <p class="mb-6 text-xl text-center md:text-2xl">ç­çº§é‡Œæ¥äº†ä¸€ä½ç¥ç§˜å˜‰å®¾ï¼è€å¸ˆåªç»™ä¸€ä¸ªæç¤ºï¼Œä½ èƒ½æ‰¾åˆ°ä»–å—ï¼Ÿ</p>
                    <div class="flex flex-col lg:flex-row gap-8 items-start">
                        <div class="flex-grow">
                            <div class="max-w-4xl mx-auto">
                                <div class="flex">
                                    <!-- è¡Œæ ‡ç­¾ -->
                                    <div id="mystery-row-labels" class="flex flex-col gap-2 pr-2 mt-4">
                                        <!-- Row labels will be generated by JS -->
                                    </div>
                                    <!-- ç½‘æ ¼ -->
                                    <div class="flex-1">
                                        <div id="mystery-grid" class="grid grid-cols-6 gap-2 bg-slate-200 p-4 rounded-md">
                                            <!-- Grid cells will be generated by JS -->
                                        </div>
                                        <!-- åˆ—æ ‡ç­¾ -->
                                        <div id="mystery-col-labels" class="grid grid-cols-6 gap-2 px-4 mt-1">
                                            <!-- Column labels will be generated by JS -->
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="w-full lg:w-80 bg-slate-50 p-6 rounded-lg border">
                            <h5 class="font-bold mb-4 text-center text-lg md:text-xl">ğŸ” æ¢ç´¢åŒºåŸŸ</h5>
                            <div id="mystery-clue" class="w-full p-4 bg-white rounded-md text-center text-lg md:text-xl h-24 flex items-center justify-center mb-4 border-2 border-dashed border-teal-300">
                                ç‚¹å‡»"å¼€å§‹æ¢ç´¢"è·å–çº¿ç´¢
                            </div>
                            <div class="mb-4">
                                <label class="block text-lg md:text-xl font-medium mb-2">ä½ çš„çŒœæµ‹:</label>
                                <div id="mystery-guess" class="w-full p-3 bg-white rounded-md text-center font-mono text-2xl md:text-3xl h-12 flex items-center justify-center border-2">--</div>
                            </div>
                            <div class="grid grid-cols-2 gap-3">
                                <button id="mystery-start-btn" class="w-full bg-teal-600 text-white px-4 py-3 rounded-md hover:bg-teal-700 transition-colors text-lg md:text-xl font-medium">å¼€å§‹æ¢ç´¢</button>
                                <button id="mystery-reset-btn" class="w-full bg-amber-500 text-white px-4 py-3 rounded-md hover:bg-amber-600 transition-colors text-lg md:text-xl font-medium">é‡æ–°å¼€å§‹</button>
                            </div>
                        </div>
                    </div>
                </div>
            </section>

            <!-- ç”µå½±é™¢åº§ä½ -->
            <section id="cinema" class="content-pane">
                <div class="bg-white p-6 rounded-lg shadow-lg">
                    <p class="mb-6 text-xl text-center md:text-2xl">æ¬¢è¿æ¥åˆ°æ˜Ÿå…‰ç”µå½±é™¢ï¼è¯·æ ¹æ®ç”µå½±ç¥¨ä¸Šçš„æ•°å¯¹æ‰¾åˆ°ä½ çš„åº§ä½ã€‚</p>
                    <div class="flex flex-col lg:flex-row gap-8 items-start">
                        <div class="flex-grow">
                            <div class="max-w-4xl mx-auto">
                                <div class="flex">
                                    <!-- è¡Œæ ‡ç­¾ -->
                                    <div id="cinema-row-labels" class="flex flex-col gap-1 pr-2 mt-4">
                                        <!-- Row labels will be generated by JS -->
                                    </div>
                                    <!-- ç½‘æ ¼ -->
                                    <div class="flex-1">
                                        <div id="cinema-grid" class="grid grid-cols-8 gap-1 bg-slate-200 p-4 rounded-md">
                                            <!-- Grid cells will be generated by JS -->
                                        </div>
                                        <!-- åˆ—æ ‡ç­¾ -->
                                        <div id="cinema-col-labels" class="grid grid-cols-8 gap-1 px-4 mt-1">
                                            <!-- Column labels will be generated by JS -->
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="flex justify-center gap-6 mt-4 text-xl md:text-2xl">
                                <div class="flex items-center gap-2">
                                    <div class="w-4 h-4 bg-green-500 rounded"></div>
                                    <span>å¯é€‰åº§ä½</span>
                                </div>
                                <div class="flex items-center gap-2">
                                    <div class="w-4 h-4 bg-slate-500 rounded"></div>
                                    <span>å·²å”®åº§ä½</span>
                                </div>
                            </div>
                        </div>
                        <div class="w-full lg:w-80 bg-slate-50 p-6 rounded-lg border">
                            <h5 class="font-bold mb-4 text-center text-lg md:text-xl">ğŸ« ç”µå½±ç¥¨</h5>
                            <div id="cinema-ticket" class="w-full p-4 bg-gradient-to-r from-purple-400 to-pink-400 text-white rounded-md text-center mb-4">
                                <div class="text-xl md:text-2xl font-bold mb-2">ã€Šæ•°å­¦å¥‡å¹»ä¹‹æ—…ã€‹</div>
                                <div class="text-lg md:text-xl">åº§ä½å·: <span id="ticket-seat" class="font-mono text-2xl md:text-3xl">--</span></div>
                                <div class="text-base md:text-lg mt-2">ç¥¨ä»·: Â¥35</div>
                            </div>
                            <div class="mb-4">
                                <label class="block text-lg md:text-xl font-medium mb-2">ç‚¹å‡»çš„åº§ä½:</label>
                                <div id="cinema-clicked" class="w-full p-3 bg-white rounded-md text-center font-mono text-2xl md:text-3xl h-12 flex items-center justify-center border-2">--</div>
                            </div>
                            <div class="grid grid-cols-2 gap-3">
                                <button id="cinema-new-ticket" class="w-full bg-teal-600 text-white px-4 py-3 rounded-md hover:bg-teal-700 transition-colors text-lg md:text-xl font-medium">æ–°ç”µå½±ç¥¨</button>
                                <button id="cinema-find-seat" class="w-full bg-amber-500 text-white px-4 py-3 rounded-md hover:bg-amber-600 transition-colors text-lg md:text-xl font-medium">æ‰¾åº§ä½</button>
                            </div>
                        </div>
                    </div>
                </div>
            </section>

            <!-- åŠ¨ç‰©å›­å¯¼è§ˆ -->
            <section id="practice" class="content-pane">
                <div class="bg-white p-6 rounded-lg shadow-lg">
                    <p class="mb-6 text-xl text-center md:text-2xl">æ¬¢è¿æ¥åˆ°å¥‡å¹»åŠ¨ç‰©å›­ï¼ç‚¹å‡»æ ¼å­æŸ¥çœ‹åŠ¨ç‰©ä½ç½®ï¼Œæˆ–è¾“å…¥æ•°å¯¹å¯»æ‰¾ä½ æœ€å–œæ¬¢çš„åŠ¨ç‰©æœ‹å‹ã€‚</p>
                    <div class="flex flex-col lg:flex-row gap-8 items-start">
                        <div class="flex-grow">
                            <div class="max-w-4xl mx-auto">
                                <div class="flex">
                                    <!-- è¡Œæ ‡ç­¾ -->
                                    <div id="zoo-row-labels" class="flex flex-col pr-2" style="justify-content: space-between;margin-top:-20px;padding-bottom: 20px;">
                                        <!-- Row labels will be generated by JS -->
                                    </div>
                                    <!-- ç½‘æ ¼ -->
                                    <div class="flex-1">
                                        <div id="zoo-grid" class="grid grid-cols-6 gap-0 bg-white border border-slate-400 relative" style="grid-template-rows: repeat(6, 3rem);">
                                            <!-- Grid cells will be generated by JS -->
                                        </div>
                                        <!-- åˆ—æ ‡ç­¾ -->
                                        <div id="zoo-col-labels" class="flex justify-between mt-1">
                                            <!-- Column labels will be generated by JS -->
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="mt-4 text-center">
                                <div class="inline-flex flex-wrap gap-2 text-xl md:text-2xl">
                                    <span class="bg-blue-100 px-2 py-1 rounded">ğŸ˜ å¤§è±¡é¦†</span>
                                    <span class="bg-green-100 px-2 py-1 rounded">ğŸµ çŒ´å±±</span>
                                    <span class="bg-yellow-100 px-2 py-1 rounded">ğŸ¦ ç‹®å­å›­</span>
                                    <span class="bg-purple-100 px-2 py-1 rounded">ğŸ§ ä¼é¹…é¦†</span>
                                    <span class="bg-pink-100 px-2 py-1 rounded">ğŸ¦’ é•¿é¢ˆé¹¿</span>
                                </div>
                            </div>
                        </div>
                        <div class="w-full lg:w-80 bg-slate-50 p-6 rounded-lg border">
                            <h5 class="font-bold mb-4 text-center text-lg md:text-xl">ğŸ—ºï¸ å¯¼è§ˆæ§åˆ¶å°</h5>
                            <div class="mb-6">
                                <label class="block text-lg md:text-xl font-medium mb-2">ç‚¹å‡»çš„ä½ç½®:</label>
                                <div id="clicked-coords" class="w-full p-3 bg-white rounded-md text-center font-mono text-2xl md:text-3xl h-12 flex items-center justify-center border-2">--</div>
                            </div>
                            <div class="mb-6">
                                <label class="block text-lg md:text-xl font-medium mb-2">å¯»æ‰¾æ•°å¯¹:</label>
                                <div class="flex items-center gap-2 mb-2">
                                    <span class="font-bold text-xl">(</span>
                                    <input type="number" id="find-col" min="0" max="6" class="w-16 text-center p-2 border-2 rounded-md text-xl font-mono">
                                    <span class="font-bold text-xl">,</span>
                                    <input type="number" id="find-row" min="0" max="6" class="w-16 text-center p-2 border-2 rounded-md text-xl font-mono">
                                    <span class="font-bold text-xl">)</span>
                                </div>
                                <button id="find-btn" class="w-full bg-teal-600 text-white px-4 py-3 rounded-md hover:bg-teal-700 transition-colors text-lg md:text-xl font-medium">ğŸ” å¯»æ‰¾ä½ç½®</button>
                                <p id="find-result" class="text-base md:text-lg text-red-600 mt-2 h-6"></p>
                            </div>
                            <button id="zoo-random" class="w-full bg-amber-500 text-white px-4 py-3 rounded-md hover:bg-amber-600 transition-colors text-lg md:text-xl font-medium">ğŸ² éšæœºæ¢ç´¢</button>
                        </div>
                    </div>
                </div>
            </section>

            <!-- å¯»å®å¥‡å…µ -->
            <section id="treasure" class="content-pane">
                <div class="bg-white p-6 rounded-lg shadow-lg">
                    <p class="mb-6 text-xl text-center md:text-2xl">è·Ÿéšç¥ç§˜çš„è—å®å›¾ï¼Œè¿ç”¨æ•°å¯¹çŸ¥è¯†æ‰¾åˆ°ä¼ è¯´ä¸­çš„å®è—ï¼æ¯ä¸€æ­¥éƒ½éœ€è¦ç²¾ç¡®çš„åæ ‡ã€‚</p>
                    <div class="flex flex-col lg:flex-row gap-8 items-start">
                        <div class="flex-grow">
                            <div class="max-w-4xl mx-auto">
                                <div class="flex">
                                    <!-- è¡Œæ ‡ç­¾ -->
                                    <div id="treasure-row-labels" class="flex flex-col gap-0 pr-6" style="margin-top:-20px;padding-bottom: 20px;">
                                        <!-- Row labels will be generated by JS -->
                                    </div>
                                    <!-- ç½‘æ ¼ -->
                                    <div class="flex-1">
                                        <div id="treasure-grid" class="grid grid-cols-6 gap-0 bg-white border border-slate-400 relative" style="grid-template-rows: repeat(6, 4rem);">
                                            <!-- Grid cells will be generated by JS -->
                                        </div>
                                        <!-- åˆ—æ ‡ç­¾ -->
                                        <div id="treasure-col-labels" class="flex justify-between mt-1">
                                            <!-- Column labels will be generated by JS -->
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="mt-4 text-center">
                                <div class="inline-flex flex-wrap gap-2 text-xl md:text-2xl">
                                    <span class="bg-amber-100 px-2 py-1 rounded">ğŸ›ï¸ ç¥åº™</span>
                                    <span class="bg-blue-100 px-2 py-1 rounded">ğŸ’§ ç€‘å¸ƒ</span>
                                    <span class="bg-gray-100 px-2 py-1 rounded">ğŸ•³ï¸ æ´ç©´</span>
                                    <span class="bg-green-100 px-2 py-1 rounded">ğŸŒ¿ æ²¼æ³½</span>
                                    <span class="bg-yellow-100 px-2 py-1 rounded">ğŸŒ´ æ¤°å­æ ‘</span>
                                </div>
                            </div>
                        </div>
                        <div class="w-full lg:w-80 bg-slate-50 p-6 rounded-lg border">
                            <h5 class="font-bold mb-4 text-center text-lg md:text-xl">ğŸ—ºï¸ è—å®å›¾çº¿ç´¢</h5>
                            <div id="clue-display" class="w-full p-4 bg-white rounded-md text-center text-xl md:text-2xl h-32 flex items-center justify-center mb-4 border-2 border-dashed border-amber-300">ç‚¹å‡»"å¼€å§‹å¯»å®"è·å–ç¬¬ä¸€æ¡çº¿ç´¢ã€‚</div>
                            <div class="space-y-3">
                                <button id="treasure-start-btn" class="w-full bg-teal-600 text-white px-4 py-3 rounded-md hover:bg-teal-700 transition-colors text-lg md:text-xl font-medium">ğŸš€ å¼€å§‹å¯»å®</button>
                                <button id="treasure-restart-btn" class="w-full bg-gray-500 text-white px-4 py-3 rounded-md hover:bg-gray-600 transition-colors text-lg md:text-xl font-medium" style="display: none;">ğŸ”„ é‡æ–°å¼€å§‹</button>
                            </div>
                        </div>
                    </div>
                </div>
            </section>


        </main>
    </div>

    <script>
    document.addEventListener('DOMContentLoaded', function() {
        // === æ¸¸æˆé…ç½®æ•°æ® ===
        const gameConfigs = {
            mystery: {
                gridSize: { cols: 6, rows: 5 },
                labelPrefix: { row: 'ç¬¬', col: 'ç¬¬' },
                labelSuffix: { row: 'è¡Œ', col: 'åˆ—' },
                students: [
                    { name: 'å°æ˜', pos: [3, 4], clue: 'ä»–ååœ¨ç¬¬3åˆ—' },
                    { name: 'å°çº¢', pos: [5, 2], clue: 'å¥¹ååœ¨ç¬¬5åˆ—' },
                    { name: 'å°æ', pos: [2, 3], clue: 'ä»–ååœ¨ç¬¬2åˆ—' },
                    { name: 'å°ç‹', pos: [4, 5], clue: 'å¥¹ååœ¨ç¬¬4åˆ—' },
                    { name: 'å°å¼ ', pos: [1, 1], clue: 'ä»–ååœ¨ç¬¬1åˆ—' }
                ]
            },
            cinema: {
                gridSize: { cols: 8, rows: 6 },
                labelPrefix: { row: '', col: '' },
                labelSuffix: { row: '', col: '' },
                bookedSeatsCount: 15
            },
            zoo: {
                gridSize: { cols: 6, rows: 6 },
                labelPrefix: { row: '', col: '' },
                labelSuffix: { row: '', col: '' },
                animals: {
                    '1-5': { emoji: 'ğŸ˜', name: 'å¤§è±¡é¦†' },
                    '4-3': { emoji: 'ğŸµ', name: 'çŒ´å±±' },
                    '2-4': { emoji: 'ğŸ¦', name: 'ç‹®å­å›­' },
                    '0-1': { emoji: 'ğŸ§', name: 'ä¼é¹…é¦†' },
                    '5-6': { emoji: 'ğŸ¦’', name: 'é•¿é¢ˆé¹¿å›­' }
                }
            },
            treasure: {
                gridSize: { cols: 6, rows: 6 },
                labelPrefix: { row: '', col: '' },
                labelSuffix: { row: '', col: '' },
                locations: {
                    '0-0': 'èµ·ç‚¹', '1-0': 'æ²™æ»©', '2-0': 'å®ç®±', '3-0': 'å®ç®±', '4-0': 'è’åœ°', '5-0': 'è’åœ°', '6-0': 'è’åœ°',
                    '0-1': 'ä¼é¹…é¦†', '1-1': 'æ¤°å­æ ‘', '2-1': 'æ¤°å­æ ‘', '3-1': 'çŸ³æ¡¥', '4-1': 'è’åœ°', '5-1': 'è’åœ°', '6-1': 'å¤äº•',
                    '0-2': 'ç€‘å¸ƒ', '1-2': 'ç€‘å¸ƒ', '2-2': 'ç€‘å¸ƒ', '3-2': 'ç€‘å¸ƒ', '4-2': 'æ£®æ—', '5-2': 'æ´ç©´', '6-2': 'å±±å³°',
                    '0-3': 'æ²¼æ³½', '1-3': 'æ²¼æ³½', '2-3': 'æ²¼æ³½', '3-3': 'æ£®æ—', '4-3': 'æ£®æ—', '5-3': 'æ‚¬å´–', '6-3': 'æ‚¬å´–',
                    '0-4': 'çŸ³æ¡¥', '1-4': 'çŸ³æ¡¥', '2-4': 'çŸ³æ¡¥', '3-4': 'ç€‘å¸ƒ', '4-4': 'æ£®æ—', '5-4': 'å°å²›', '6-4': 'æµ·æ´‹',
                    '0-5': 'ç¥åº™', '1-5': 'ç¥åº™', '2-5': 'ç¥åº™', '3-5': 'æ£®æ—', '4-5': 'å°å²›', '5-5': 'æµ·æ´‹', '6-5': 'æµ·æ´‹',
                    '0-6': 'é«˜å¡”', '1-6': 'é«˜å¡”', '2-6': 'ç¯å¡”', '3-6': 'æ£®æ—', '4-6': 'æµ·æ´‹', '5-6': 'æµ·æ´‹', '6-6': 'æµ·æ´‹'
                },
                routes: [
                    [
                        { coord: [1, 5], text: "ä»(1, 5)çš„å¤è€ç¥åº™å‡ºå‘ã€‚" },
                        { coord: [3, 4], text: "å‘ä¸œå—èµ°åˆ°(3, 4)çš„ç€‘å¸ƒã€‚" },
                        { coord: [5, 2], text: "æ¥ç€å‰å¾€(5, 2)çš„ç¥ç§˜æ´ç©´ã€‚" },
                        { coord: [2, 1], text: "å®è—å°±åœ¨(2, 1)çš„æ¤°å­æ ‘ä¸‹ï¼" }
                    ],
                    [
                        { coord: [0, 6], text: "ä»(0, 6)çš„é«˜å¡”å¼€å§‹æ¢é™©ã€‚" },
                        { coord: [2, 4], text: "å‰å¾€(2, 4)çš„çŸ³æ¡¥ã€‚" },
                        { coord: [4, 3], text: "ç©¿è¿‡(4, 3)çš„è¿·é›¾æ£®æ—ã€‚" },
                        { coord: [6, 1], text: "å®è—åŸ‹åœ¨(6, 1)çš„å¤äº•æ—ï¼" }
                    ],
                    [
                        { coord: [2, 6], text: "ä»(2, 6)çš„ç¯å¡”å¯ç¨‹ã€‚" },
                        { coord: [4, 5], text: "æ¸¸å‘(4, 5)çš„å°å²›ã€‚" },
                        { coord: [6, 3], text: "æ”€ç™»(6, 3)çš„æ‚¬å´–ã€‚" },
                        { coord: [3, 0], text: "å®è—å°±åœ¨(3, 0)çš„å®ç®±é‡Œï¼" }
                    ]
                ]
            }
        };

        const tabNav = document.getElementById('tab-nav');
        const tabContent = document.getElementById('tab-content');
        const tabButtons = tabNav.querySelectorAll('.tab-btn');
        const contentPanes = tabContent.querySelectorAll('.content-pane');

        // === é€šç”¨æ ‡ç­¾ç”Ÿæˆå‡½æ•° ===
        function generateLabels(gameType, containerId) {
            const config = gameConfigs[gameType];
            const container = document.getElementById(containerId);
            if (!container || !config) return;
            
            container.innerHTML = '';
            
            if (containerId.includes('row')) {
                // ç”Ÿæˆè¡Œæ ‡ç­¾
                const isReverse = gameType !== 'zoo' && gameType !== 'treasure';
                const start = isReverse ? config.gridSize.rows : (gameType === 'zoo' || gameType === 'treasure' ? 6 : config.gridSize.rows);
                const end = isReverse ? 1 : (gameType === 'zoo' || gameType === 'treasure' ? 0 : 1);
                const step = isReverse ? -1 : -1;
                
                for (let i = start; isReverse ? i >= end : i >= end; i += step) {
                    const label = document.createElement('div');
                    label.className = gameType === 'cinema' ? 
                        'text-center text-2xl md:text-3xl text-slate-500 font-medium h-16 flex items-center justify-center' :
                        gameType === 'zoo' ? 
                        'text-center text-2xl md:text-3xl text-slate-500 font-medium' :
                        'text-center text-2xl md:text-3xl text-slate-500 font-medium h-16 flex items-center justify-center';
                    
                    if (gameType === 'zoo' && i === 0) {
                        label.style.opacity = '0';
                    }
                    
                    if (gameType === 'treasure' && config.locations) {
                        // å¯»å®æ¸¸æˆæ˜¾ç¤ºç¬¬ä¸€åˆ—çš„åœ°å€åç§°
                        const locationKey = `0-${i}`;
                        label.textContent = config.locations[locationKey] || i;
                    } else {
                        label.textContent = `${config.labelPrefix.row}${i}${config.labelSuffix.row}`;
                    }
                    container.appendChild(label);
                }
            } else {
                // ç”Ÿæˆåˆ—æ ‡ç­¾
                const start = gameType === 'zoo' || gameType === 'treasure' ? 0 : 1;
                const end = gameType === 'zoo' || gameType === 'treasure' ? 6 : config.gridSize.cols;
                
                for (let i = start; i <= end; i++) {
                    const label = document.createElement('div');
                    label.className = 'text-center text-2xl md:text-3xl text-slate-500 font-medium';
                    
                    if (gameType === 'treasure' && config.locations) {
                        // å¯»å®æ¸¸æˆæ˜¾ç¤ºç¬¬ä¸€è¡Œçš„åœ°å€åç§°
                        const locationKey = `${i}-6`;
                        label.textContent = config.locations[locationKey] || i;
                    } else {
                        label.textContent = `${config.labelPrefix.col}${i}${config.labelSuffix.col}`;
                    }
                    container.appendChild(label);
                }
            }
        }

        // éŸ³æ•ˆåŠŸèƒ½
        function playSound(type) {
            const audioContext = new (window.AudioContext || window.webkitAudioContext)();
            const oscillator = audioContext.createOscillator();
            const gainNode = audioContext.createGain();
            
            oscillator.connect(gainNode);
            gainNode.connect(audioContext.destination);
            
            switch(type) {
                case 'click':
                    oscillator.frequency.setValueAtTime(800, audioContext.currentTime);
                    gainNode.gain.setValueAtTime(0.1, audioContext.currentTime);
                    gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.1);
                    break;
                case 'success':
                    oscillator.frequency.setValueAtTime(523, audioContext.currentTime);
                    oscillator.frequency.setValueAtTime(659, audioContext.currentTime + 0.1);
                    oscillator.frequency.setValueAtTime(784, audioContext.currentTime + 0.2);
                    gainNode.gain.setValueAtTime(0.2, audioContext.currentTime);
                    gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.3);
                    break;
                case 'treasure':
                    oscillator.frequency.setValueAtTime(1047, audioContext.currentTime);
                    gainNode.gain.setValueAtTime(0.3, audioContext.currentTime);
                    gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.5);
                    break;
            }
            
            oscillator.start(audioContext.currentTime);
            oscillator.stop(audioContext.currentTime + 0.5);
        }

        // Tab navigation with sound
        tabNav.addEventListener('click', function(e) {
            if (e.target.tagName === 'BUTTON') {
                playSound('click');
                const tabId = e.target.dataset.tab;

                tabButtons.forEach(btn => btn.classList.remove('active'));
                e.target.classList.add('active');

                contentPanes.forEach(pane => {
                    pane.classList.toggle('active', pane.id === tabId);
                });
            }
        });

        // --- é€šç”¨ç½‘æ ¼ç”Ÿæˆå™¨ ---
        function createGrid(gameType, containerId) {
            const config = gameConfigs[gameType];
            const gridContainer = document.getElementById(containerId);
            if (!gridContainer || !config) return;
            
            gridContainer.innerHTML = ''; // æ¸…ç©ºç°æœ‰ç½‘æ ¼
            
            // æ ¹æ®æ¸¸æˆç±»å‹å†³å®šåæ ‡ç³»ç»Ÿ
            const isZooOrTreasure = gameType === 'zoo' || gameType === 'treasure';
            
            if (isZooOrTreasure) {
                // åŠ¨ç‰©å›­å’Œå¯»å®æ¸¸æˆä½¿ç”¨ç½‘æ ¼äº¤ç‚¹ç³»ç»Ÿ
                gridContainer.style.gridTemplateColumns = `repeat(${config.gridSize.cols}, 1fr)`;
                gridContainer.style.gridTemplateRows = `repeat(${config.gridSize.rows}, 1fr)`;
                
                // åˆ›å»ºæ–¹æ ¼ç½‘æ ¼
                for (let row = config.gridSize.rows - 1; row >= 0; row--) {
                    for (let col = 0; col < config.gridSize.cols; col++) {
                        const cell = document.createElement('div');
                        cell.classList.add('grid-cell', 'w-full', 'h-full', 'border', 'border-slate-300', 'grid-style');
                        gridContainer.appendChild(cell);
                    }
                }
                
                // åœ¨ç½‘æ ¼äº¤ç‚¹å¤„æ·»åŠ å¯ç‚¹å‡»çš„äº¤ç‚¹
                for (let row = 0; row <= config.gridSize.rows; row++) {
                    for (let col = 0; col <= config.gridSize.cols; col++) {
                        const intersection = document.createElement('div');
                        intersection.classList.add('grid-intersection');
                        intersection.dataset.col = col;
                        intersection.dataset.row = row;
                        
                        // è®¡ç®—äº¤ç‚¹ä½ç½®
                        const cellSize = 100 / config.gridSize.cols; // æ¯ä¸ªæ ¼å­çš„ç™¾åˆ†æ¯”å¤§å°
                        intersection.style.left = `${col * cellSize}%`;
                        intersection.style.top = `${(config.gridSize.rows - row) * cellSize}%`;
                        
                        gridContainer.appendChild(intersection);
                    }
                }
            } else {
                // å…¶ä»–æ¸¸æˆä½¿ç”¨1å¼€å§‹çš„åæ ‡ç³»ç»Ÿ
                gridContainer.style.gridTemplateColumns = `repeat(${config.gridSize.cols}, 1fr)`;
                for (let row = config.gridSize.rows; row >= 1; row--) {
                    for (let col = 1; col <= config.gridSize.cols; col++) {
                        const cell = document.createElement('div');
                        cell.classList.add('grid-cell', 'w-full', 'h-full', 'border', 'border-slate-300', 'flex', 'items-center', 'justify-center');
                        cell.dataset.col = col;
                        cell.dataset.row = row;
                        gridContainer.appendChild(cell);
                    }
                }
            }
        }

        // --- ç¥ç§˜å˜‰å®¾æ¸¸æˆ ---
        function initMysteryGuest() {
            // ç”Ÿæˆç½‘æ ¼å’Œæ ‡ç­¾
            createGrid('mystery', 'mystery-grid');
            generateLabels('mystery', 'mystery-row-labels');
            generateLabels('mystery', 'mystery-col-labels');
            
            const grid = document.getElementById('mystery-grid');
            const clueDisplay = document.getElementById('mystery-clue');
            const guessDisplay = document.getElementById('mystery-guess');
            const startBtn = document.getElementById('mystery-start-btn');
            const resetBtn = document.getElementById('mystery-reset-btn');
            
            const config = gameConfigs.mystery;
            let currentStudent = null;
            let gameStarted = false;
            
            function startGame() {
                currentStudent = config.students[Math.floor(Math.random() * config.students.length)];
                clueDisplay.textContent = `${currentStudent.clue}ï¼Œä½ èƒ½æ‰¾åˆ°ä»–/å¥¹å—ï¼Ÿ`;
                clueDisplay.classList.add('slide-in');
                gameStarted = true;
                startBtn.disabled = true;
                playSound('click');
            }
            
            function resetGame() {
                currentStudent = null;
                gameStarted = false;
                clueDisplay.textContent = 'ç‚¹å‡»"å¼€å§‹æ¢ç´¢"è·å–çº¿ç´¢';
                guessDisplay.textContent = '--';
                startBtn.disabled = false;
                grid.querySelectorAll('.grid-cell').forEach(cell => {
                    cell.classList.remove('highlight', 'selected');
                    cell.textContent = '';
                });
                playSound('click');
            }
            
            grid.addEventListener('click', function(e) {
                const cell = e.target.closest('.grid-cell');
                if (cell && gameStarted) {
                    const col = parseInt(cell.dataset.col);
                    const row = parseInt(cell.dataset.row);
                    guessDisplay.textContent = `(${col}, ${row})`;
                    
                    grid.querySelectorAll('.grid-cell').forEach(c => c.classList.remove('selected'));
                    cell.classList.add('selected');
                    
                    if (currentStudent && col === currentStudent.pos[0] && row === currentStudent.pos[1]) {
                        cell.textContent = 'ğŸ‰';
                        cell.classList.add('highlight');
                        clueDisplay.textContent = `æ­å–œï¼ä½ æ‰¾åˆ°äº†${currentStudent.name}ï¼ä½ç½®æ˜¯(${col}, ${row})`;
                        playSound('success');
                        gameStarted = false;
                        startBtn.disabled = false;
                    } else {
                        playSound('click');
                    }
                }
            });
            
            startBtn.addEventListener('click', startGame);
            resetBtn.addEventListener('click', resetGame);
        }

        // --- ç”µå½±é™¢åº§ä½é¢„è®¢ ---
        function initCinema() {
            // ç”Ÿæˆç½‘æ ¼å’Œæ ‡ç­¾
            createGrid('cinema', 'cinema-grid');
            generateLabels('cinema', 'cinema-row-labels');
            generateLabels('cinema', 'cinema-col-labels');
            
            const grid = document.getElementById('cinema-grid');
            const ticketSeat = document.getElementById('ticket-seat');
            const clickedDisplay = document.getElementById('cinema-clicked');
            const newTicketBtn = document.getElementById('cinema-new-ticket');
            const findSeatBtn = document.getElementById('cinema-find-seat');
            
            const config = gameConfigs.cinema;
            let currentTicket = null;
            let bookedSeats = new Set();
            
            function generateRandomSeats() {
                bookedSeats.clear();
                // éšæœºç”Ÿæˆä¸€äº›å·²å”®åº§ä½
                for (let i = 0; i < config.bookedSeatsCount; i++) {
                    const col = Math.floor(Math.random() * config.gridSize.cols) + 1;
                    const row = Math.floor(Math.random() * config.gridSize.rows) + 1;
                    bookedSeats.add(`${col}-${row}`);
                }
                updateSeatDisplay();
            }
            
            function updateSeatDisplay() {
                grid.querySelectorAll('.grid-cell').forEach(cell => {
                    const col = cell.dataset.col;
                    const row = cell.dataset.row;
                    const seatKey = `${col}-${row}`;
                    
                    cell.classList.remove('cinema-seat', 'cinema-available', 'selected');
                    cell.textContent = '';
                    
                    if (bookedSeats.has(seatKey)) {
                        cell.classList.add('cinema-seat');
                        cell.textContent = 'âœ—';
                    } else {
                        cell.classList.add('cinema-available');
                        cell.textContent = 'âœ“';
                    }
                });
            }
            
            function generateNewTicket() {
                let col, row;
                do {
                    col = Math.floor(Math.random() * config.gridSize.cols) + 1;
                    row = Math.floor(Math.random() * config.gridSize.rows) + 1;
                } while (bookedSeats.has(`${col}-${row}`));
                
                currentTicket = [col, row];
                ticketSeat.textContent = `(${col}, ${row})`;
                playSound('click');
            }
            
            function findSeat() {
                if (!currentTicket) return;
                
                grid.querySelectorAll('.grid-cell').forEach(cell => {
                    cell.classList.remove('selected');
                });
                
                const targetCell = grid.querySelector(`.grid-cell[data-col='${currentTicket[0]}'][data-row='${currentTicket[1]}']`);
                if (targetCell) {
                    targetCell.classList.add('selected');
                    targetCell.scrollIntoView({ behavior: 'smooth', block: 'center' });
                    playSound('success');
                }
            }
            
            grid.addEventListener('click', function(e) {
                const cell = e.target.closest('.grid-cell');
                if (cell) {
                    const col = cell.dataset.col;
                    const row = cell.dataset.row;
                    clickedDisplay.textContent = `(${col}, ${row})`;
                    
                    grid.querySelectorAll('.grid-cell').forEach(c => c.classList.remove('selected'));
                    cell.classList.add('selected');
                    
                    if (currentTicket && col == currentTicket[0] && row == currentTicket[1]) {
                        playSound('success');
                    } else {
                        playSound('click');
                    }
                }
            });
            
            newTicketBtn.addEventListener('click', generateNewTicket);
            findSeatBtn.addEventListener('click', findSeat);
            
            // åˆå§‹åŒ–
            generateRandomSeats();
            generateNewTicket();
        }

        // --- å¢å¼ºåŠ¨ç‰©å›­åœ°å›¾ ---
        function initZooMap() {
            // ç”Ÿæˆç½‘æ ¼å’Œæ ‡ç­¾
            createGrid('zoo', 'zoo-grid');
            generateLabels('zoo', 'zoo-row-labels');
            generateLabels('zoo', 'zoo-col-labels');
            
            const zooGrid = document.getElementById('zoo-grid');
            const clickedCoordsDisplay = document.getElementById('clicked-coords');
            const findColInput = document.getElementById('find-col');
            const findRowInput = document.getElementById('find-row');
            const findBtn = document.getElementById('find-btn');
            const findResult = document.getElementById('find-result');
            const randomBtn = document.getElementById('zoo-random');
            
            const config = gameConfigs.zoo;
            let currentSelectedIntersection = null;
            let currentHighlightIntersection = null;

            function setupAnimals() {
                Object.entries(config.animals).forEach(([pos, animal]) => {
                    const [col, row] = pos.split('-');
                    const intersection = zooGrid.querySelector(`.grid-intersection[data-col='${col}'][data-row='${row}']`);
                    if (intersection) {
                        intersection.classList.add('animal-point');
                        intersection.title = `${animal.name} ${animal.emoji}`;
                        
                        // åœ¨äº¤ç‚¹æ—è¾¹æ˜¾ç¤ºåŠ¨ç‰©å›¾æ ‡
                        const iconSpan = document.createElement('span');
                        iconSpan.className = 'animal-icon';
                        iconSpan.textContent = animal.emoji;
                        intersection.appendChild(iconSpan);
                    }
                });
            }

            function clearHighlights() {
                if (currentHighlightIntersection) {
                    currentHighlightIntersection.classList.remove('selected');
                    currentHighlightIntersection = null;
                }
            }
            
            function clearSelections() {
                if (currentSelectedIntersection) {
                    currentSelectedIntersection.classList.remove('selected');
                    currentSelectedIntersection = null;
                }
            }

            function getAnimalInfo(col, row) {
                const key = `${col}-${row}`;
                return config.animals[key] || null;
            }

            zooGrid.addEventListener('click', function(e) {
                const intersection = e.target.closest('.grid-intersection');
                if (intersection) {
                    clearSelections();
                    clearHighlights();
                    const col = intersection.dataset.col;
                    const row = intersection.dataset.row;
                    const animal = getAnimalInfo(col, row);
                    
                    if (animal) {
                        clickedCoordsDisplay.textContent = `(${col}, ${row}) ${animal.name}`;
                        playSound('success');
                    } else {
                        clickedCoordsDisplay.textContent = `(${col}, ${row})`;
                        playSound('click');
                    }
                    
                    intersection.classList.add('selected');
                    currentSelectedIntersection = intersection;
                }
            });

            findBtn.addEventListener('click', function() {
                clearHighlights();
                clearSelections();
                findResult.textContent = '';
                const col = parseInt(findColInput.value);
                const row = parseInt(findRowInput.value);

                if (isNaN(col) || isNaN(row) || col < 0 || col > 6 || row < 0 || row > 6) {
                    findResult.textContent = 'è¯·è¾“å…¥0-6çš„æœ‰æ•ˆæ•°å­—ã€‚';
                    return;
                }

                const targetIntersection = zooGrid.querySelector(`.grid-intersection[data-col='${col}'][data-row='${row}']`);
                if (targetIntersection) {
                    targetIntersection.classList.add('selected');
                    currentHighlightIntersection = targetIntersection;
                    
                    const animal = getAnimalInfo(col, row);
                    if (animal) {
                        findResult.textContent = `æ‰¾åˆ°äº†${animal.name}ï¼`;
                        findResult.className = 'text-sm md:text-base text-green-600 mt-2 h-6';
                        playSound('success');
                    } else if (col === 0 && row === 0) {
                        findResult.textContent = 'è¿™é‡Œæ˜¯åŸç‚¹(0,0)ã€‚';
                        findResult.className = 'text-sm md:text-base text-purple-600 mt-2 h-6';
                        playSound('click');
                    } else {
                        findResult.textContent = 'è¿™é‡Œæ˜¯ç½‘æ ¼äº¤ç‚¹ã€‚';
                        findResult.className = 'text-sm md:text-base text-blue-600 mt-2 h-6';
                        playSound('click');
                    }
                }
            });

            randomBtn.addEventListener('click', function() {
                const animalKeys = Object.keys(config.animals);
                const randomKey = animalKeys[Math.floor(Math.random() * animalKeys.length)];
                const [col, row] = randomKey.split('-');
                const animal = config.animals[randomKey];
                
                findColInput.value = col;
                findRowInput.value = row;
                
                clearHighlights();
                clearSelections();
                
                const targetIntersection = zooGrid.querySelector(`.grid-intersection[data-col='${col}'][data-row='${row}']`);
                if (targetIntersection) {
                    targetIntersection.classList.add('selected');
                    currentHighlightIntersection = targetIntersection;
                    findResult.textContent = `éšæœºå‘ç°ï¼š${animal.name}åœ¨(${col}, ${row})ï¼`;
                    findResult.className = 'text-sm md:text-base text-purple-600 mt-2 h-6';
                    playSound('treasure');
                }
            });

            // åˆå§‹åŒ–åŠ¨ç‰©
            setupAnimals();
        }

        // --- å¯»å®å¥‡å…µ ---
        function initTreasureHunt() {
            // ç”Ÿæˆç½‘æ ¼å’Œæ ‡ç­¾
            createGrid('treasure', 'treasure-grid');
            
            const grid = document.getElementById('treasure-grid');
            const rowLabels = document.getElementById('treasure-row-labels');
            const colLabels = document.getElementById('treasure-col-labels');
            const startBtn = document.getElementById('treasure-start-btn');
            const restartBtn = document.getElementById('treasure-restart-btn');
            const clueDisplay = document.getElementById('clue-display');
            
            const config = gameConfigs.treasure;
            let currentRoute = [];
            let currentStep = -1;
            let waitingForClick = false;
            let gameStarted = false;
            let pathPoints = [];
            
            function initializeLabels() {
                // åˆå§‹åŒ–æ—¶éšè—æ‰€æœ‰æ ‡ç­¾
                rowLabels.innerHTML = '';
                colLabels.innerHTML = '';
                rowLabels.style.justifyContent = 'space-between';
                
                for (let i = 6; i >= 0; i--) {
                    const rowLabel = document.createElement('div');
                    rowLabel.className = 'text-center text-2xl md:text-3xl text-slate-500 font-medium';
                    rowLabel.style.visibility = 'hidden';
                    rowLabel.textContent = i;
                    rowLabels.appendChild(rowLabel);
                }
                for (let i = 0; i <= 6; i++) {
                    const colLabel = document.createElement('div');
                    colLabel.className = 'text-center text-2xl md:text-3xl text-slate-500 font-medium';
                    colLabel.style.visibility = 'hidden';
                    colLabel.textContent = i;
                    colLabels.appendChild(colLabel);
                }
            }
            
            function showLabel(col, row) {
                const rowLabel = rowLabels.children[6 - row];
                const colLabel = colLabels.children[col];
                if (rowLabel) rowLabel.style.visibility = 'visible';
                if (colLabel) colLabel.style.visibility = 'visible';
            }
            
            function drawPathLine(fromCol, fromRow, toCol, toRow) {
                const fromIntersection = grid.querySelector(`.grid-intersection[data-col='${fromCol}'][data-row='${fromRow}']`);
                const toIntersection = grid.querySelector(`.grid-intersection[data-col='${toCol}'][data-row='${toRow}']`);
                
                if (!fromIntersection || !toIntersection) return;
                
                const fromRect = fromIntersection.getBoundingClientRect();
                const toRect = toIntersection.getBoundingClientRect();
                const gridRect = grid.getBoundingClientRect();
                
                const fromX = fromRect.left + fromRect.width / 2 - gridRect.left;
                const fromY = fromRect.top + fromRect.height / 2 - gridRect.top;
                const toX = toRect.left + toRect.width / 2 - gridRect.left;
                const toY = toRect.top + toRect.height / 2 - gridRect.top;
                
                const length = Math.sqrt((toX - fromX) ** 2 + (toY - fromY) ** 2);
                const angle = Math.atan2(toY - fromY, toX - fromX) * 180 / Math.PI;
                
                const line = document.createElement('div');
                line.className = 'treasure-path-line';
                line.style.left = fromX + 'px';
                line.style.top = fromY + 'px';
                line.style.width = length + 'px';
                line.style.height = '3px';
                line.style.transform = `rotate(${angle}deg)`;
                line.style.transformOrigin = '0 50%';
                
                grid.appendChild(line);
            }

            function resetGame() {
                currentStep = -1;
                waitingForClick = false;
                gameStarted = false;
                pathPoints = [];
                clueDisplay.textContent = 'ç‚¹å‡»"å¼€å§‹å¯»å®"å®šä½èµ·å§‹ç‚¹ã€‚';
                startBtn.disabled = false;
                startBtn.style.backgroundColor = '';
                restartBtn.style.display = 'none';
                
                // æ¸…ç†ç½‘æ ¼äº¤ç‚¹
                grid.querySelectorAll('.grid-intersection').forEach(intersection => {
                    intersection.classList.remove('treasure-point', 'treasure-final');
                    intersection.innerHTML = '';
                });
                
                // æ¸…ç†è·¯å¾„çº¿
                grid.querySelectorAll('.treasure-path-line').forEach(line => {
                    line.remove();
                });
                
                // é‡æ–°åˆå§‹åŒ–æ ‡ç­¾
                initializeLabels();
            }

            startBtn.addEventListener('click', function() {
                // éšæœºé€‰æ‹©ä¸€ä¸ªå¯»å®è·¯çº¿
                currentRoute = config.routes[Math.floor(Math.random() * config.routes.length)];
                currentStep = 0;
                gameStarted = true;
                waitingForClick = true;
                
                this.disabled = true;
                this.style.backgroundColor = '#6b7280';
                restartBtn.style.display = 'block';
                
                // ç›´æ¥æ˜¾ç¤ºç¬¬ä¸€ä¸ªç‚¹
                const firstPoint = currentRoute[0];
                const firstIntersection = grid.querySelector(`.grid-intersection[data-col='${firstPoint.coord[0]}'][data-row='${firstPoint.coord[1]}']`);
                if (firstIntersection) {
                    showLabel(firstPoint.coord[0], firstPoint.coord[1]);
                    firstIntersection.classList.add('treasure-point');
                    
                    const label = document.createElement('div');
                    label.className = 'treasure-label-style';
                    const locationKey = `${firstPoint.coord[0]}-${firstPoint.coord[1]}`;
                    label.textContent = config.locations[locationKey] || 'èµ·ç‚¹';
                    firstIntersection.appendChild(label);
                    
                    pathPoints.push({ col: firstPoint.coord[0], row: firstPoint.coord[1], intersection: firstIntersection });
                }
                
                // ç§»åŠ¨åˆ°ä¸‹ä¸€æ­¥
                currentStep = 1;
                updateClue();
                playSound('click');
            });
            
            restartBtn.addEventListener('click', function() {
                resetGame();
                playSound('click');
            });

            // ç½‘æ ¼ç‚¹å‡»äº‹ä»¶
            grid.addEventListener('click', function(e) {
                if (!waitingForClick || !e.target.classList.contains('grid-intersection') || !gameStarted) return;
                
                const clickedCol = parseInt(e.target.dataset.col);
                const clickedRow = parseInt(e.target.dataset.row);
                const { coord } = currentRoute[currentStep];
                
                if (clickedCol === coord[0] && clickedRow === coord[1]) {
                    // ç‚¹å‡»æ­£ç¡®
                    playSound('success');
                    
                    // æ˜¾ç¤ºå¯¹åº”çš„è¡Œåˆ—æ ‡ç­¾
                    showLabel(clickedCol, clickedRow);
                    
                    // æ ‡è®°è·¯å¾„ç‚¹
                    e.target.classList.add('treasure-point');
                    
                    // æ·»åŠ æ ‡ç­¾
                    const label = document.createElement('div');
                    label.className = 'treasure-label-style';
                    const locationKey = `${clickedCol}-${clickedRow}`;
                    label.textContent = config.locations[locationKey] || `ä½ç½®${currentStep + 1}`;
                    e.target.appendChild(label);
                    
                    pathPoints.push({ col: clickedCol, row: clickedRow, intersection: e.target });
                    
                    // å¦‚æœä¸æ˜¯ç¬¬ä¸€ä¸ªç‚¹ï¼Œç”»çº¿è¿æ¥
                    if (pathPoints.length > 1) {
                        const prevPoint = pathPoints[pathPoints.length - 2];
                        drawPathLine(prevPoint.col, prevPoint.row, clickedCol, clickedRow);
                    }
                    
                    if (currentStep === currentRoute.length - 1) {
                        // æœ€åä¸€æ­¥ï¼Œæ‰¾åˆ°å®è—
                        e.target.classList.add('treasure-final');
                        label.classList.add('final');
                        label.textContent = 'ğŸ’';
                        clueDisplay.textContent = 'ğŸ‰ æ­å–œä½ ï¼Œæ‰¾åˆ°å®è—äº†ï¼ç‚¹å‡»"é‡æ–°å¼€å§‹"å°è¯•æ–°çš„è·¯çº¿ã€‚';
                        waitingForClick = false;
                        playSound('treasure');
                    } else {
                        // ç»§ç»­ä¸‹ä¸€æ­¥
                        currentStep++;
                        updateClue();
                    }
                } else {
                    // ç‚¹å‡»é”™è¯¯
                    playSound('click');
                    clueDisplay.textContent = `âŒ ä½ç½®ä¸å¯¹ï¼Œè¯·æ‰¾åˆ° (${coord[0]}, ${coord[1]})ï¼`;
                }
            });

            function updateClue() {
                if (currentStep >= currentRoute.length) return;

                const { text } = currentRoute[currentStep];
                clueDisplay.textContent = text;
                waitingForClick = true;
            }
            
            initializeLabels();
            resetGame();
        }



        // Initialize all modules
        initMysteryGuest();
        initCinema();
        initZooMap();
        initTreasureHunt();
    });
    </script>
</body>
</html>