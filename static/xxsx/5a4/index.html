<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>五年级上册《可能性》互动课堂</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body {
            font-family: 'Inter', 'Helvetica Neue', 'Helvetica', 'Arial', sans-serif;
            -webkit-touch-callout: none; /* iOS Safari */
            -webkit-user-select: none; /* Safari */
            -khtml-user-select: none; /* Konqueror HTML */
            -moz-user-select: none; /* Old versions of Firefox */
            -ms-user-select: none; /* Internet Explorer/Edge */
            user-select: none; /* Non-prefixed version, currently supported by Chrome, Edge, Opera and Firefox */
            background-image: linear-gradient(to top, #e6e9f0 0%, #eef1f5 100%);
            height: 100vh;
        }
        input[type="range"] {
            touch-action: pan-y;
        }
        .draggable {
            touch-action: none;
            cursor: grab;
        }
        .dragging {
            opacity: 0.5;
            cursor: grabbing;
            z-index: 1000;
        }
        .drop-zone {
            transition: background-color 0.3s, border-color 0.3s;
        }
        .drop-zone.over {
            background-color: #e0f2fe;
            border-color: #0284c7;
        }
        .feedback {
            transition: opacity 0.5s;
        }
        #spinner {
            transition: transform 4s cubic-bezier(0.25, 0.1, 0.25, 1);
        }
        .nav-btn {
            padding: 12px 20px;
            border: 2px solid #e5e7eb;
            border-radius: 12px;
            background: white;
            color: #6b7280;
            font-weight: 600;
            transition: all 0.3s ease;
            cursor: pointer;
        }
        .nav-btn:hover {
            border-color: #3b82f6;
            color: #3b82f6;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(59, 130, 246, 0.15);
        }
        .nav-btn.active {
            background: #3b82f6;
            border-color: #3b82f6;
            color: white;
            box-shadow: 0 4px 12px rgba(59, 130, 246, 0.3);
        }
        .section-content {
            animation: fadeIn 0.4s ease-in-out;
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .practice-btn, .comparison-btn {
            padding: 8px 16px;
            border: 2px solid #d1d5db;
            border-radius: 8px;
            background: white;
            color: #374151;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        .practice-btn:hover, .comparison-btn:hover {
            border-color: #3b82f6;
            color: #3b82f6;
            transform: translateY(-1px);
        }
        .practice-btn:disabled, .comparison-btn:disabled {
            cursor: not-allowed;
            opacity: 0.8;
        }
        .fair-game-option {
            transition: all 0.3s ease;
        }
        .fair-game-option:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
        }

        .dice-display {
            transition: transform 0.6s ease;
            transform-style: preserve-3d;
        }
        .dice-display.rolling {
            animation: diceRoll 0.6s ease-out;
        }
        @keyframes diceRoll {
            0% { transform: rotateX(0deg) rotateY(0deg); }
            25% { transform: rotateX(90deg) rotateY(180deg); }
            50% { transform: rotateX(180deg) rotateY(360deg); }
            75% { transform: rotateX(270deg) rotateY(540deg); }
            100% { transform: rotateX(360deg) rotateY(720deg); }
        }
        .coin-display {
            transition: transform 0.6s ease;
        }
        .coin-display.flipping {
            transform: rotateY(720deg);
        }
    </style>
</head>
<body class="bg-gray-50 text-gray-800">

    <div class="container mx-auto p-2 sm:p-3 md:p-4">
        <header class="text-center mb-2">
            <h2 class="text-xl sm:text-xl md:text-3xl font-bold text-blue-600">《可能性》互动课堂</h2>
            <p class="mt-2 text-lg text-gray-600">通过有趣的互动实验，一起探索生活中的确定与不确定</p>
            
            <!-- 导航菜单 -->
            <nav class="rounded-2xl p-4">
                <div class="flex flex-wrap justify-center gap-4">
                    <button class="nav-btn active" data-target="activity-1">🎯 活动1：事件分类</button>
                    <button class="nav-btn" data-target="activity-2">🎲 活动2：摸球实验</button>
                    <button class="nav-btn" data-target="activity-3">🎡 活动3：幸运转盘</button>
                    <button class="nav-btn" data-target="dice-experiment">🎲 虚拟实验室1：骰子实验</button>
                    <button class="nav-btn" data-target="coin-experiment">🪙 虚拟实验室2：抛硬币</button>
                </div>
            </nav>
        </header>

        <!-- 活动一：事件分类 -->
        <section id="activity-1" class="section-content mb-12 bg-white p-6 rounded-2xl shadow-lg">
            <h3 class="text-2xl font-bold text-center text-blue-800">活动1：给事件分分类</h3>
            <p class="text-center mb-6 text-gray-600">请将下面的事件卡片，拖拽到正确的盒子里吧！</p>
            <div id="events-container" class="flex flex-wrap justify-center items-center gap-4 mb-8 p-4 bg-gray-100 rounded-xl">
                <!-- 事件卡片将由JS动态生成 -->
            </div>
            <div class="grid md:grid-cols-3 gap-6">
                <div id="drop-impossible" data-type="impossible" class="drop-zone border-4 border-dashed border-red-300 bg-red-50 rounded-xl p-4 min-h-[150px]">
                    <h3 class="text-xl font-semibold text-center text-red-600 mb-2">不可能</h3>
                    <div class="content flex flex-col items-center gap-2"></div>
                </div>
                <div id="drop-possible" data-type="possible" class="drop-zone border-4 border-dashed border-yellow-400 bg-yellow-50 rounded-xl p-4 min-h-[150px]">
                    <h3 class="text-xl font-semibold text-center text-yellow-600 mb-2">可能</h3>
                    <div class="content flex flex-col items-center gap-2"></div>
                </div>
                <div id="drop-certain" data-type="certain" class="drop-zone border-4 border-dashed border-green-400 bg-green-50 rounded-xl p-4 min-h-[150px]">
                    <h3 class="text-xl font-semibold text-center text-green-600 mb-2">一定</h3>
                    <div class="content flex flex-col items-center gap-2"></div>
                </div>
            </div>
            <div class="text-center mt-4">
                 <button id="reset-activity-1" class="bg-blue-500 hover:bg-blue-600 text-white font-bold py-2 px-6 rounded-full transition-transform transform hover:scale-105">重置</button>
            </div>
        </section>

        <!-- 活动二：摸球实验 -->
        <section id="activity-2" class="section-content mb-12 bg-white p-6 rounded-2xl shadow-lg" style="display: none;">
            <h3 class="text-2xl font-bold text-center text-blue-800">活动2：神奇的摸球实验</h3>
            <p class="text-center mb-6 text-gray-600">请设置袋子中不同颜色小球的数量，然后开始摸球，看看有什么发现！</p>
            <div class="grid md:grid-cols-3 gap-6 items-start px-8 mt-12 mb-12" style="align-items: center;">
                
                <!-- 中间：结果记录 -->
                <div class="flex flex-col items-center">
                    <div id="draw-results" class="text-xl md:text-2xl w-full text-center bg-gray-100 p-4 rounded-2xl line-height-6">
                        <h4 class="font-bold mb-2">摸球记录</h4>
                        <p class="text-2xl md:text-3xl">黄球: <span id="yellow-drawn" class="font-bold text-yellow-500">0</span> 次</p>
                        <p class="text-2xl md:text-3xl">白球: <span id="white-drawn" class="font-bold text-gray-500">0</span> 次</p>
                        <p class="mt-2 text-blue-700 font-semibold" id="probability-hint"></p>
                    </div>
                </div>
                <!-- 左侧：袋子 -->
                <div class="flex flex-col items-center">
                    <div id="ball-bag" class="relative w-48 h-48 mb-4">
                        <svg viewBox="0 0 100 100" class="w-full h-full">
                            <!-- 袋子主体 -->
                            <defs>
                                <linearGradient id="bagGradient" x1="0%" y1="0%" x2="100%" y2="100%">
                                    <stop offset="0%" style="stop-color:#A0522D;stop-opacity:1" />
                                    <stop offset="50%" style="stop-color:#8B4513;stop-opacity:1" />
                                    <stop offset="100%" style="stop-color:#654321;stop-opacity:1" />
                                </linearGradient>
                                <filter id="shadow" x="-20%" y="-20%" width="140%" height="140%">
                                    <feDropShadow dx="2" dy="4" stdDeviation="3" flood-color="#000" flood-opacity="0.3"/>
                                </filter>
                            </defs>
                            <path d="M25,90 C15,75 15,35 25,20 Q30,15 35,15 H65 Q70,15 75,20 C85,35 85,75 75,90 Q70,95 65,95 H35 Q30,95 25,90 Z" fill="url(#bagGradient)" filter="url(#shadow)"/>
                            <!-- 袋口绳子 -->
                            <path d="M25,20 Q30,12 35,15 H65 Q70,12 75,20" stroke="#654321" stroke-width="3" fill="none"/>
                            <!-- 袋口高光 -->
                            <path d="M30,18 H70" stroke="#D2691E" stroke-width="1.5"/>
                            <!-- 袋子纹理线条 -->
                            <path d="M30,30 Q50,32 70,30" stroke="#654321" stroke-width="0.8" opacity="0.6" fill="none"/>
                            <path d="M28,50 Q50,52 72,50" stroke="#654321" stroke-width="0.8" opacity="0.6" fill="none"/>
                            <path d="M30,70 Q50,72 70,70" stroke="#654321" stroke-width="0.8" opacity="0.6" fill="none"/>
                            <text id="total-balls-text" x="50" y="60" font-size="16" text-anchor="middle" fill="white" font-weight="bold" opacity="0.9">10</text>
                        </svg>
                        <div id="drawn-ball-display" class="absolute -top-12 left-1/2 -translate-x-1/2 w-16 h-16 rounded-full flex items-center justify-center text-white font-bold text-xl opacity-0 transition-opacity duration-500"></div>
                    </div>
                </div>
                
                <!-- 右侧：控制区域 -->
                <div class="flex flex-col">
                    <div class="text-center mb-4">
                        <button id="draw-ball" class="bg-green-500 hover:bg-green-600 text-white font-bold py-3 px-6 rounded-full text-lg transition-transform transform hover:scale-105 shadow-md mb-2 w-full">摸一个球</button>
                        <button id="reset-draw" class="bg-gray-500 hover:bg-gray-600 text-white font-bold py-2 px-6 rounded-full text-lg transition-transform transform hover:scale-105 shadow-md w-full">重置</button>
                    </div>
                    <div class="mb-4">
                        <label for="yellow-balls" class="font-semibold text-lg">黄球数量: <span id="yellow-count-label" class="text-blue-600 font-bold">5</span></label>
                        <input type="range" id="yellow-balls" min="0" max="20" value="5" class="w-full h-3 bg-gray-200 rounded-lg appearance-none cursor-pointer range-lg accent-yellow-400">
                    </div>
                    <div class="mb-6">
                        <label for="white-balls" class="font-semibold text-lg">白球数量: <span id="white-count-label" class="text-blue-600 font-bold">5</span></label>
                        <input type="range" id="white-balls" min="0" max="20" value="5" class="w-full h-3 bg-gray-200 rounded-lg appearance-none cursor-pointer range-lg accent-gray-400">
                    </div>
                </div>
            </div>
        </section>

        <!-- 活动三：幸运大转盘 -->
        <section id="activity-3" class="section-content bg-white p-6 rounded-2xl shadow-lg" style="display: none;">
            <h3 class="text-2xl font-bold text-center text-blue-800">活动3：设计你自己的幸运转盘</h3>
            <p class="text-center mb-6 text-gray-600">调整每个区域的大小，看看指针停在哪里的可能性最大？</p>
            <div class="grid md:grid-cols-3 gap-8 items-center px-8">
                <div class="controls md:col-span-1">
                    <div id="prize-controls" class="text-xl md:text-2xl">
                        <!-- 奖项设置将由JS动态生成 -->
                    </div>
                    <div id="spin-result" class="mt-4 text-center text-2xl font-bold text-green-600 h-8"></div>
                </div>
                <div class="relative flex justify-center items-center md:col-span-2">
                    <div id="spinner-container" class="w-80 h-80 lg:w-[480px] lg:h-[480px] relative">
                        <canvas id="spinner" width="480" height="480"></canvas>
                        <div class="absolute top-1/2 left-1/2 w-16 h-4 bg-red-600 rounded-r-full origin-left -translate-y-1/2" style="transform: rotate(-90deg);"></div>
                        <button id="spin-button" class="absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 w-16 h-16 bg-white rounded-full border-4 border-gray-400 text-gray-800 font-bold text-lg flex items-center justify-center hover:bg-gray-200 transition">旋转</button>
                    </div>
                </div>
            </div>
        </section>

        <!-- 活动四：骰子实验 -->
        <section id="dice-experiment" class="section-content mb-12 bg-white p-6 rounded-2xl shadow-lg" style="display: none;">
            <h3 class="text-2xl lg:text-3xl font-bold text-center text-blue-800">🎲 虚拟实验室1：虚拟骰子实验</h3>
            <p class="text-center mb-6 text-gray-600 lg:text-xl">通过掷骰子实验，观察各个点数出现的频率，感受概率的奥秘！</p>
            
            <!-- 模式切换 -->
            <div class="text-center mb-6">
                <div class="inline-flex bg-gray-100 rounded-lg p-1">
                    <button id="single-dice-mode" class="px-4 py-2 rounded-md text-sm font-medium transition-all bg-purple-500 text-white">1个骰子</button>
                    <button id="double-dice-mode" class="px-4 py-2 rounded-md text-sm font-medium transition-all text-gray-600 hover:text-purple-600">2个骰子</button>
                </div>
            </div>
            
            <div class="bg-gradient-to-r from-purple-50 to-pink-50 p-6 rounded-xl">
                <div class="bg-white p-6 rounded-lg shadow-sm">
                    <div class="grid md:grid-cols-2 gap-8 items-start">
                        <!-- 左侧：统计结果 -->
                        <div id="dice-stats" class="">
                            <p class="mb-4 font-bold text-lg md:text-xl lg:text-2xl text-purple-700">统计结果：</p>
                            <div id="single-dice-stats" class="grid grid-cols-3 gap-3 text-lg md:text-xl lg:text-2xl">
                                <div class="bg-purple-50 p-3 rounded-lg">1点: <span id="dice-1" class="font-bold text-purple-600">0</span>次</div>
                                <div class="bg-purple-50 p-3 rounded-lg">2点: <span id="dice-2" class="font-bold text-purple-600">0</span>次</div>
                                <div class="bg-purple-50 p-3 rounded-lg">3点: <span id="dice-3" class="font-bold text-purple-600">0</span>次</div>
                                <div class="bg-purple-50 p-3 rounded-lg">4点: <span id="dice-4" class="font-bold text-purple-600">0</span>次</div>
                                <div class="bg-purple-50 p-3 rounded-lg">5点: <span id="dice-5" class="font-bold text-purple-600">0</span>次</div>
                                <div class="bg-purple-50 p-3 rounded-lg">6点: <span id="dice-6" class="font-bold text-purple-600">0</span>次</div>
                            </div>
                            <div id="double-dice-stats" class="grid grid-cols-3 gap-2 text-lg md:text-xl lg:text-2xl" style="display: none;">
                                <div class="bg-purple-50 p-2 rounded-lg">2点: <span id="sum-2" class="font-bold text-purple-600">0</span>次</div>
                                <div class="bg-purple-50 p-2 rounded-lg">3点: <span id="sum-3" class="font-bold text-purple-600">0</span>次</div>
                                <div class="bg-purple-50 p-2 rounded-lg">4点: <span id="sum-4" class="font-bold text-purple-600">0</span>次</div>
                                <div class="bg-purple-50 p-2 rounded-lg">5点: <span id="sum-5" class="font-bold text-purple-600">0</span>次</div>
                                <div class="bg-purple-50 p-2 rounded-lg">6点: <span id="sum-6" class="font-bold text-purple-600">0</span>次</div>
                                <div class="bg-purple-50 p-2 rounded-lg">7点: <span id="sum-7" class="font-bold text-purple-600">0</span>次</div>
                                <div class="bg-purple-50 p-2 rounded-lg">8点: <span id="sum-8" class="font-bold text-purple-600">0</span>次</div>
                                <div class="bg-purple-50 p-2 rounded-lg">9点: <span id="sum-9" class="font-bold text-purple-600">0</span>次</div>
                                <div class="bg-purple-50 p-2 rounded-lg">10点: <span id="sum-10" class="font-bold text-purple-600">0</span>次</div>
                                <div class="bg-purple-50 p-2 rounded-lg">11点: <span id="sum-11" class="font-bold text-purple-600">0</span>次</div>
                                <div class="bg-purple-50 p-2 rounded-lg">12点: <span id="sum-12" class="font-bold text-purple-600">0</span>次</div>
                            </div>
                            <button id="reset-dice" class="mt-4 bg-gray-400 hover:bg-gray-500 text-white py-2 px-6 rounded-full transition lg:text-lg">🔄 重置统计</button>
                        </div>
                        
                        <!-- 右侧：互动区 -->
                        <div class="text-center">
                            <div id="dice-display-container" class="mb-6">
                                <div id="single-dice-display" class="dice-display w-32 h-32 lg:w-40 lg:h-40 mx-auto bg-white border-4 border-gray-300 rounded-xl flex items-center justify-center text-5xl lg:text-6xl font-bold shadow-lg">?</div>
                                <div id="double-dice-display" class="flex justify-center gap-4" style="display: none;">
                                    <div id="dice-1-display" class="dice-display w-24 h-24 lg:w-32 lg:h-32 bg-white border-4 border-gray-300 rounded-xl flex items-center justify-center text-3xl lg:text-4xl font-bold shadow-lg">?</div>
                                    <div id="dice-2-display" class="dice-display w-24 h-24 lg:w-32 lg:h-32 bg-white border-4 border-gray-300 rounded-xl flex items-center justify-center text-3xl lg:text-4xl font-bold shadow-lg">?</div>
                                </div>
                            </div>
                            <div class="space-y-3">
                                <button id="roll-dice" class="bg-purple-500 hover:bg-purple-600 text-white font-bold py-3 px-8 rounded-full text-lg lg:text-xl transition-all transform hover:scale-105 shadow-md w-full">🎲 掷骰子</button>
                                <div class="grid grid-cols-2 gap-2">
                                    <button id="roll-10-times" class="bg-purple-400 hover:bg-purple-500 text-white font-medium py-2 px-4 rounded-full text-sm lg:text-base transition-all">连掷10次</button>
                                    <button id="roll-100-times" class="bg-purple-400 hover:bg-purple-500 text-white font-medium py-2 px-4 rounded-full text-sm lg:text-base transition-all">连掷100次</button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- 活动五：抛硬币实验 -->
        <section id="coin-experiment" class="section-content mb-12 bg-white p-6 rounded-2xl shadow-lg" style="display: none;">
            <h3 class="text-2xl lg:text-3xl font-bold text-center text-blue-800">🪙 虚拟实验室2：连续抛硬币挑战</h3>
            <p class="text-center mb-6 text-gray-600 lg:text-xl">连续抛硬币，观察正面和反面出现的规律，体验随机性的魅力！</p>
            <div class="bg-gradient-to-r from-yellow-50 to-orange-50 p-6 rounded-xl">
                <div class="bg-white p-6 rounded-lg shadow-sm">
                    <div class="grid md:grid-cols-2 gap-8 items-start">
                        <!-- 左侧：统计结果 -->
                        <div class="">
                            <div class="mb-6">
                                <p class="font-bold text-lg lg:text-2xl text-yellow-700 mb-4">统计结果：</p>
                                <div class="grid grid-cols-2 gap-4 mb-4">
                                    <div class="bg-yellow-50 p-4 rounded-lg">
                                        <p class="text-sm lg:text-base text-gray-600">正面</p>
                                        <p class="text-2xl lg:text-3xl font-bold text-yellow-600"><span id="heads-count">0</span>次</p>
                                    </div>
                                    <div class="bg-yellow-50 p-4 rounded-lg">
                                        <p class="text-sm lg:text-base text-gray-600">反面</p>
                                        <p class="text-2xl lg:text-3xl font-bold text-yellow-600"><span id="tails-count">0</span>次</p>
                                    </div>
                                </div>
                            </div>
                            <div id="coin-sequence" class="mb-4">
                                <p class="font-bold text-lg lg:text-xl text-yellow-700 mb-2">连续结果：</p>
                                <div id="coin-history" class="min-h-[60px] p-4 bg-yellow-50 rounded-lg text-center text-lg lg:text-xl font-medium">开始抛硬币吧！</div>
                            </div>
                            <button id="reset-coin" class="bg-gray-400 hover:bg-gray-500 text-white py-2 px-6 rounded-full transition lg:text-lg">🔄 重置统计</button>
                        </div>
                        
                        <!-- 右侧：互动区 -->
                        <div class="text-center">
                            <div id="coin-display" class="coin-display w-32 h-32 lg:w-40 lg:h-40 mx-auto bg-yellow-400 rounded-full flex items-center justify-center text-4xl lg:text-5xl font-bold mb-6 shadow-lg">🪙</div>
                            <div class="space-y-3">
                                <button id="flip-coin" class="bg-yellow-500 hover:bg-yellow-600 text-white font-bold py-3 px-8 rounded-full text-lg lg:text-xl transition-all transform hover:scale-105 shadow-md w-full">🪙 抛硬币</button>
                                <div class="grid grid-cols-2 gap-2">
                                    <button id="flip-10-times" class="bg-yellow-400 hover:bg-yellow-500 text-white font-medium py-2 px-4 rounded-full text-sm lg:text-base transition-all">连抛10次</button>
                                    <button id="flip-100-times" class="bg-yellow-400 hover:bg-yellow-500 text-white font-medium py-2 px-4 rounded-full text-sm lg:text-base transition-all">连抛100次</button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </section>



    </div>

    <script>
        // --- 通用函数 ---
        const $ = (selector) => document.querySelector(selector);
        const $$ = (selector) => document.querySelectorAll(selector);

        // --- 活动一：事件分类 ---
        const eventsContainer = $('#events-container');
        const dropZones = $$('.drop-zone');
        const resetActivity1Btn = $('#reset-activity-1');

        const events = [
            { text: '如果今天是星期一，明天是星期二', type: 'certain' },
            { text: '小明今天会长高1米', type: 'impossible' },
            { text: '今天放学后会下雨', type: 'possible' },
            { text: '抛硬币会落地', type: 'certain' },
            { text: '今晚会看到月亮', type: 'possible' },
            { text: '鱼会在天空中飞', type: 'impossible' },
            { text: '水会从高处往低处流', type: 'certain' },
            { text: '人不吃不喝能活100年', type: 'impossible' },
            { text: '太阳从东边升起', type: 'certain' }
        ];

        let draggedItem = null;

        function initializeActivity1() {
            eventsContainer.innerHTML = '';
            dropZones.forEach(zone => zone.querySelector('.content').innerHTML = '');
            
            shuffleArray(events).forEach((event, index) => {
                const eventEl = document.createElement('div');
                eventEl.id = `event-${index}`;
                eventEl.className = 'draggable bg-white p-3 rounded-lg shadow cursor-grab border-2 border-blue-200 text-xl md:text-2xl';
                eventEl.draggable = true;
                eventEl.textContent = event.text;
                eventEl.dataset.type = event.type;
                eventsContainer.appendChild(eventEl);
            });

            addDragListeners();
        }
        
        function shuffleArray(array) {
            for (let i = array.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [array[i], array[j]] = [array[j], array[i]];
            }
            return array;
        }

        function addDragListeners() {
            const draggables = $$('.draggable');
            draggables.forEach(item => {
                item.addEventListener('dragstart', handleDragStart);
                item.addEventListener('dragend', handleDragEnd);
                
                // For touch devices
                item.addEventListener('touchstart', handleTouchStart, { passive: false });
            });
        }
        
        let touchStartX, touchStartY, originalElement;

        function handleTouchStart(e) {
            e.preventDefault();
            originalElement = e.target;
            draggedItem = originalElement.cloneNode(true);
            draggedItem.classList.add('dragging');
            document.body.appendChild(draggedItem);
            
            touchStartX = e.touches[0].clientX;
            touchStartY = e.touches[0].clientY;
            
            draggedItem.style.position = 'absolute';
            draggedItem.style.left = `${touchStartX - draggedItem.offsetWidth / 2}px`;
            draggedItem.style.top = `${touchStartY - draggedItem.offsetHeight / 2}px`;
            
            originalElement.style.opacity = '0.5';

            document.addEventListener('touchmove', handleTouchMove, { passive: false });
            document.addEventListener('touchend', handleTouchEnd);
        }

        function handleTouchMove(e) {
            e.preventDefault();
            if (!draggedItem) return;
            const touchX = e.touches[0].clientX;
            const touchY = e.touches[0].clientY;
            
            draggedItem.style.left = `${touchX - draggedItem.offsetWidth / 2}px`;
            draggedItem.style.top = `${touchY - draggedItem.offsetHeight / 2}px`;

            dropZones.forEach(zone => {
                const rect = zone.getBoundingClientRect();
                if (touchX > rect.left && touchX < rect.right && touchY > rect.top && touchY < rect.bottom) {
                    zone.classList.add('over');
                } else {
                    zone.classList.remove('over');
                }
            });
        }

        function handleTouchEnd(e) {
            if (!draggedItem) return;
            
            const touchX = e.changedTouches[0].clientX;
            const touchY = e.changedTouches[0].clientY;
            let dropped = false;

            dropZones.forEach(zone => {
                const rect = zone.getBoundingClientRect();
                if (touchX > rect.left && touchX < rect.right && touchY > rect.top && touchY < rect.bottom) {
                    // 创建一个新的元素用于放置，保持原始文本
                    const newElement = originalElement.cloneNode(true);
                    newElement.style.opacity = '1';
                    draggedItem = newElement;
                    handleDrop(zone);
                    dropped = true;
                }
                zone.classList.remove('over');
            });
            
            if (dropped) {
                originalElement.remove();
            } else {
                originalElement.style.opacity = '1';
            }
            
            draggedItem.remove();
            draggedItem = null;
            originalElement = null;
            
            document.removeEventListener('touchmove', handleTouchMove);
            document.removeEventListener('touchend', handleTouchEnd);
        }


        function handleDragStart(e) {
            draggedItem = this;
            setTimeout(() => this.style.display = 'none', 0);
            e.dataTransfer.setData('text/plain', this.id);
        }

        function handleDragEnd() {
            setTimeout(() => {
                if (draggedItem) {
                    draggedItem.style.display = 'block';
                    draggedItem = null;
                }
            }, 0);
        }

        dropZones.forEach(zone => {
            zone.addEventListener('dragover', (e) => {
                e.preventDefault();
                zone.classList.add('over');
            });
            zone.addEventListener('dragleave', () => {
                zone.classList.remove('over');
            });
            zone.addEventListener('drop', (e) => {
                e.preventDefault();
                zone.classList.remove('over');
                const id = e.dataTransfer.getData('text/plain');
                draggedItem = document.getElementById(id);
                handleDrop(zone);
                draggedItem = null;
            });
        });
        
        function handleDrop(zone) {
            const dropType = zone.dataset.type;
            const itemType = draggedItem.dataset.type;
            const feedbackEl = document.createElement('span');
            feedbackEl.className = 'feedback text-2xl ml-2';
            
            if (dropType === itemType) {
                draggedItem.classList.remove('border-blue-200');
                draggedItem.classList.add('border-green-500', 'bg-green-100');
                feedbackEl.textContent = '✅';
            } else {
                draggedItem.classList.remove('border-blue-200');
                draggedItem.classList.add('border-red-500', 'bg-red-100');
                feedbackEl.textContent = '❌';
            }
            draggedItem.style.display = 'inline-block';
            draggedItem.style.cursor = 'default';
            draggedItem.draggable = false;
            draggedItem.removeEventListener('dragstart', handleDragStart);
            draggedItem.removeEventListener('touchstart', handleTouchStart);
            
            const contentDiv = zone.querySelector('.content');
            const wrapper = document.createElement('div');
            wrapper.className = 'flex items-center';
            wrapper.appendChild(draggedItem);
            wrapper.appendChild(feedbackEl);
            contentDiv.appendChild(wrapper);

            setTimeout(() => {
                feedbackEl.style.opacity = '0';
            }, 1500);
        }

        resetActivity1Btn.addEventListener('click', initializeActivity1);
        
        // --- 活动二：摸球实验 ---
        const yellowBallsSlider = $('#yellow-balls');
        const whiteBallsSlider = $('#white-balls');
        const yellowCountLabel = $('#yellow-count-label');
        const whiteCountLabel = $('#white-count-label');
        const drawBallBtn = $('#draw-ball');
        const resetDrawBtn = $('#reset-draw');
        const yellowDrawnSpan = $('#yellow-drawn');
        const whiteDrawnSpan = $('#white-drawn');
        const drawnBallDisplay = $('#drawn-ball-display');
        const totalBallsText = $('#total-balls-text');
        const probabilityHint = $('#probability-hint');

        let yellowCount = 5;
        let whiteCount = 5;
        let yellowDrawn = 0;
        let whiteDrawn = 0;

        function updateBallCounts() {
            yellowCount = parseInt(yellowBallsSlider.value);
            whiteCount = parseInt(whiteBallsSlider.value);
            yellowCountLabel.textContent = yellowCount;
            whiteCountLabel.textContent = whiteCount;
            totalBallsText.textContent = yellowCount + whiteCount;
            updateProbabilityHint();
        }
        
        function updateProbabilityHint() {
            if (yellowCount > whiteCount) {
                probabilityHint.textContent = '摸到黄球的可能性更大哦！';
            } else if (whiteCount > yellowCount) {
                probabilityHint.textContent = '摸到白球的可能性更大哦！';
            } else if (yellowCount === 0 && whiteCount > 0){
                probabilityHint.textContent = '一定能摸到白球！';
            } else if (whiteCount === 0 && yellowCount > 0){
                probabilityHint.textContent = '一定能摸到黄球！';
            } else if (whiteCount === 0 && yellowCount === 0) {
                 probabilityHint.textContent = '袋子是空的，什么也摸不到！';
            }
            else {
                probabilityHint.textContent = '摸到两种球的可能性一样大！';
            }
        }

        function drawBall() {
            const totalBalls = yellowCount + whiteCount;
            if (totalBalls === 0) {
                alert('袋子里没有球啦！');
                return;
            }
            const rand = Math.random() * totalBalls;
            let drawnColor;
            if (rand < yellowCount) {
                yellowDrawn++;
                yellowDrawnSpan.textContent = yellowDrawn;
                drawnColor = 'yellow';
            } else {
                whiteDrawn++;
                whiteDrawnSpan.textContent = whiteDrawn;
                drawnColor = 'white';
            }
            animateDrawnBall(drawnColor);
        }
        
        function animateDrawnBall(color) {
            drawnBallDisplay.style.opacity = '1';
            drawnBallDisplay.style.transform = 'translate(-50%, 0) scale(1)';
            if (color === 'yellow') {
                drawnBallDisplay.style.backgroundColor = '#FBBF24'; // bg-yellow-400
                drawnBallDisplay.textContent = '黄';
            } else {
                drawnBallDisplay.style.backgroundColor = '#D1D5DB'; // bg-gray-300
                drawnBallDisplay.textContent = '白';
            }
            
            setTimeout(() => {
                drawnBallDisplay.style.opacity = '0';
                drawnBallDisplay.style.transform = 'translate(-50%, -50%) scale(0.5)';
            }, 1000);
        }

        function resetDraw() {
            yellowDrawn = 0;
            whiteDrawn = 0;
            yellowDrawnSpan.textContent = '0';
            whiteDrawnSpan.textContent = '0';
        }

        yellowBallsSlider.addEventListener('input', updateBallCounts);
        whiteBallsSlider.addEventListener('input', updateBallCounts);
        drawBallBtn.addEventListener('click', drawBall);
        resetDrawBtn.addEventListener('click', resetDraw);

        // --- 活动三：幸运大转盘 ---
        const spinnerCanvas = $('#spinner');
        const spinButton = $('#spin-button');
        const prizeControlsContainer = $('#prize-controls');
        const spinResultEl = $('#spin-result');
        const ctx = spinnerCanvas.getContext('2d');
        const spinnerSize = 480;
        const spinnerCenter = spinnerSize / 2;
        
        let prizes = [
            { label: '一等奖', value: 1, color: '#ef4444' },
            { label: '二等奖', value: 2, color: '#f97316' },
            { label: '三等奖', value: 3, color: '#84cc16' },
            { label: '谢谢参与', value: 4, color: '#3b82f6' }
        ];

        let currentAngle = 0;
        let isSpinning = false;

        function createPrizeControls() {
            prizeControlsContainer.innerHTML = '';
            prizes.forEach((prize, index) => {
                const controlDiv = document.createElement('div');
                controlDiv.className = 'flex items-center mb-8';
                controlDiv.innerHTML = `
                    <label for="prize-${index}" class="w-48 font-semibold" style="color:${prize.color};">${prize.label}:</label>
                    <input type="range" id="prize-${index}" data-index="${index}" min="0" max="10" value="${prize.value}" class="w-full h-2 bg-gray-200 rounded-lg appearance-none cursor-pointer accent-blue-500">
                    <span id="prize-value-${index}" class="ml-4 w-8 text-center font-bold">${prize.value}</span>
                `;
                prizeControlsContainer.appendChild(controlDiv);
            });
            
            $$('#prize-controls input[type="range"]').forEach(input => {
                input.addEventListener('input', (e) => {
                    const index = e.target.dataset.index;
                    prizes[index].value = parseInt(e.target.value);
                    $(`#prize-value-${index}`).textContent = e.target.value;
                    drawSpinner();
                });
            });
        }

        function drawSpinner() {
            const totalValue = prizes.reduce((sum, p) => sum + p.value, 0);
            if (totalValue <= 0) {
                ctx.clearRect(0, 0, spinnerSize, spinnerSize);
                ctx.beginPath();
                ctx.arc(spinnerCenter, spinnerCenter, spinnerCenter - 5, 0, 2 * Math.PI);
                ctx.fillStyle = '#f3f4f6';
                ctx.fill();
                ctx.fillStyle = '#6b7280';
                ctx.font = '20px sans-serif';
                ctx.textAlign = 'center';
                ctx.textBaseline = 'middle';
                ctx.fillText('请设置奖项', spinnerCenter, spinnerCenter);
                return;
            };

            let startAngle = -Math.PI / 2; // Start from top
            
            ctx.clearRect(0, 0, spinnerSize, spinnerSize);

            prizes.forEach(prize => {
                if (prize.value <= 0) return;
                const sliceAngle = (prize.value / totalValue) * 2 * Math.PI;
                const endAngle = startAngle + sliceAngle;

                ctx.beginPath();
                ctx.moveTo(spinnerCenter, spinnerCenter);
                ctx.arc(spinnerCenter, spinnerCenter, spinnerCenter - 5, startAngle, endAngle);
                ctx.closePath();
                ctx.fillStyle = prize.color;
                ctx.fill();

                // Draw text
                const textAngle = startAngle + sliceAngle / 2;
                ctx.save();
                ctx.translate(spinnerCenter, spinnerCenter);
                ctx.rotate(textAngle);
                ctx.textAlign = 'center';
                ctx.fillStyle = '#ffffff';
                ctx.font = 'bold 16px sans-serif';
                // Adjust text position based on angle for better readability
                const textX = (spinnerCenter - 5) * 0.6;
                ctx.rotate(Math.PI / 2); // Rotate text to be horizontal
                ctx.fillText(prize.label, 0, -textX);
                ctx.restore();

                startAngle = endAngle;
            });
        }

        function spin() {
            if (isSpinning) return;
            const totalValue = prizes.reduce((sum, p) => sum + p.value, 0);
            if (totalValue <= 0) {
                alert('请先设置奖项大小！');
                return;
            }
            isSpinning = true;
            spinResultEl.textContent = '';
            
            const randomValue = Math.random() * totalValue;
            let accumulatedValue = 0;
            let resultPrize = null;
            let resultAngle = 0;
            let startAngle = 0;

            for (const prize of prizes) {
                const sliceAngle = (prize.value / totalValue) * 360;
                accumulatedValue += prize.value;
                if (randomValue < accumulatedValue) {
                    resultPrize = prize;
                    const angleWithinSlice = Math.random() * sliceAngle;
                    resultAngle = startAngle + angleWithinSlice;
                    break;
                }
                startAngle += sliceAngle;
            }
            
            const extraRotations = 5 * 360;
            const finalAngle = extraRotations + (360 - resultAngle);
            
            spinnerCanvas.style.transform = `rotate(${finalAngle}deg)`;

            setTimeout(() => {
                isSpinning = false;
                spinResultEl.textContent = `恭喜你，抽中了【${resultPrize.label}】!`;
                spinResultEl.style.color = resultPrize.color;
                
                // Reset to a non-rotated state for the next spin animation
                const normalizedAngle = finalAngle % 360;
                spinnerCanvas.style.transition = 'none';
                spinnerCanvas.style.transform = `rotate(${normalizedAngle}deg)`;
                // Force reflow
                spinnerCanvas.offsetHeight; 
                spinnerCanvas.style.transition = 'transform 4s cubic-bezier(0.25, 0.1, 0.25, 1)';
            }, 4000);
        }

        spinButton.addEventListener('click', spin);

        // --- 导航功能 ---
        const navButtons = $$('.nav-btn');
        const sections = $$('.section-content');
        
        function showSection(targetId) {
            // 隐藏所有部分
            sections.forEach(section => {
                section.style.display = 'none';
            });
            
            // 显示目标部分
            const targetSection = $(`#${targetId}`);
            if (targetSection) {
                targetSection.style.display = 'block';
            }
            
            // 更新导航按钮状态
            navButtons.forEach(btn => {
                btn.classList.remove('active');
                if (btn.dataset.target === targetId) {
                    btn.classList.add('active');
                }
            });
        }
        
        navButtons.forEach(btn => {
            btn.addEventListener('click', () => {
                showSection(btn.dataset.target);
            });
        });



        // --- 创意活动功能 ---
        
        // 骰子实验
        const rollDiceBtn = $('#roll-dice');
        const roll10TimesBtn = $('#roll-10-times');
        const roll100TimesBtn = $('#roll-100-times');
        const singleDiceDisplay = $('#single-dice-display');
        const dice1Display = $('#dice-1-display');
        const dice2Display = $('#dice-2-display');
        const resetDiceBtn = $('#reset-dice');
        const singleDiceModeBtn = $('#single-dice-mode');
        const doubleDiceModeBtn = $('#double-dice-mode');
        const singleDiceStats = $('#single-dice-stats');
        const doubleDiceStats = $('#double-dice-stats');
        const singleDiceDisplayContainer = $('#single-dice-display');
        const doubleDiceDisplayContainer = $('#double-dice-display');
        
        let diceStats = [0, 0, 0, 0, 0, 0]; // 单骰子统计
        let sumStats = [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0]; // 双骰子和值统计 (2-12)
        let isDualMode = false;
        
        // 模式切换功能
        function switchToSingleMode() {
            isDualMode = false;
            singleDiceModeBtn.classList.add('bg-purple-500', 'text-white');
            singleDiceModeBtn.classList.remove('text-gray-600');
            doubleDiceModeBtn.classList.remove('bg-purple-500', 'text-white');
            doubleDiceModeBtn.classList.add('text-gray-600');
            
            singleDiceStats.style.display = 'grid';
            doubleDiceStats.style.display = 'none';
            singleDiceDisplayContainer.style.display = 'flex';
            doubleDiceDisplayContainer.style.display = 'none';
        }
        
        function switchToDoubleMode() {
            isDualMode = true;
            doubleDiceModeBtn.classList.add('bg-purple-500', 'text-white');
            doubleDiceModeBtn.classList.remove('text-gray-600');
            singleDiceModeBtn.classList.remove('bg-purple-500', 'text-white');
            singleDiceModeBtn.classList.add('text-gray-600');
            
            singleDiceStats.style.display = 'none';
            doubleDiceStats.style.display = 'grid';
            singleDiceDisplayContainer.style.display = 'none';
            doubleDiceDisplayContainer.style.display = 'flex';
        }
        
        // 单次掷骰子（带动效）
        function rollSingleDice() {
            if (isDualMode) {
                // 双骰子模式
                const result1 = Math.floor(Math.random() * 6) + 1;
                const result2 = Math.floor(Math.random() * 6) + 1;
                const sum = result1 + result2;
                
                dice1Display.classList.add('rolling');
                dice2Display.classList.add('rolling');
                
                setTimeout(() => {
                    dice1Display.textContent = result1;
                    dice2Display.textContent = result2;
                    dice1Display.classList.remove('rolling');
                    dice2Display.classList.remove('rolling');
                    
                    sumStats[sum - 2]++;
                    $(`#sum-${sum}`).textContent = sumStats[sum - 2];
                }, 600);
            } else {
                // 单骰子模式
                const result = Math.floor(Math.random() * 6) + 1;
                
                singleDiceDisplay.classList.add('rolling');
                
                setTimeout(() => {
                    singleDiceDisplay.textContent = result;
                    singleDiceDisplay.classList.remove('rolling');
                    diceStats[result - 1]++;
                    $(`#dice-${result}`).textContent = diceStats[result - 1];
                }, 600);
            }
        }
        
        // 单次掷骰子（无动效，用于连续掷骰子）
        function rollSingleDiceNoAnimation() {
            if (isDualMode) {
                const result1 = Math.floor(Math.random() * 6) + 1;
                const result2 = Math.floor(Math.random() * 6) + 1;
                const sum = result1 + result2;
                
                dice1Display.textContent = result1;
                dice2Display.textContent = result2;
                sumStats[sum - 2]++;
                $(`#sum-${sum}`).textContent = sumStats[sum - 2];
            } else {
                const result = Math.floor(Math.random() * 6) + 1;
                singleDiceDisplay.textContent = result;
                diceStats[result - 1]++;
                $(`#dice-${result}`).textContent = diceStats[result - 1];
            }
        }
        
        // 连续掷骰子（无动效）
        function rollMultipleTimes(times) {
            let count = 0;
            const interval = setInterval(() => {
                if (count >= times) {
                    clearInterval(interval);
                    return;
                }
                
                rollSingleDiceNoAnimation();
                count++;
            }, 50);
        }
        
        // 重置统计
        function resetDiceStats() {
            diceStats = [0, 0, 0, 0, 0, 0];
            sumStats = [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0];
            
            for (let i = 1; i <= 6; i++) {
                $(`#dice-${i}`).textContent = '0';
            }
            
            for (let i = 2; i <= 12; i++) {
                $(`#sum-${i}`).textContent = '0';
            }
            
            singleDiceDisplay.textContent = '?';
            dice1Display.textContent = '?';
            dice2Display.textContent = '?';
        }
        
        // 事件监听器
        if (singleDiceModeBtn) {
            singleDiceModeBtn.addEventListener('click', switchToSingleMode);
        }
        
        if (doubleDiceModeBtn) {
            doubleDiceModeBtn.addEventListener('click', switchToDoubleMode);
        }
        
        if (rollDiceBtn) {
            rollDiceBtn.addEventListener('click', rollSingleDice);
        }
        
        if (roll10TimesBtn) {
            roll10TimesBtn.addEventListener('click', () => rollMultipleTimes(10));
        }
        
        if (roll100TimesBtn) {
            roll100TimesBtn.addEventListener('click', () => rollMultipleTimes(100));
        }
        
        if (resetDiceBtn) {
            resetDiceBtn.addEventListener('click', resetDiceStats);
        }
        
        // 抛硬币实验
        const flipCoinBtn = $('#flip-coin');
        const flip10TimesBtn = $('#flip-10-times');
        const flip100TimesBtn = $('#flip-100-times');
        const coinDisplay = $('#coin-display');
        const coinHistory = $('#coin-history');
        const headsCountEl = $('#heads-count');
        const tailsCountEl = $('#tails-count');
        const resetCoinBtn = $('#reset-coin');
        let headsCount = 0;
        let tailsCount = 0;
        let coinResults = [];
        
        // 单次抛硬币（带动效）
        function flipSingleCoin() {
            coinDisplay.classList.add('flipping');
            const isHeads = Math.random() < 0.5;
            
            setTimeout(() => {
                if (isHeads) {
                    coinDisplay.textContent = '正';
                    coinDisplay.style.backgroundColor = '#fbbf24';
                    headsCount++;
                    coinResults.push('正');
                    headsCountEl.textContent = headsCount;
                } else {
                    coinDisplay.textContent = '反';
                    coinDisplay.style.backgroundColor = '#94a3b8';
                    tailsCount++;
                    coinResults.push('反');
                    tailsCountEl.textContent = tailsCount;
                }
                
                coinDisplay.classList.remove('flipping');
                
                // 更新历史记录，只显示最近10次
                const recentResults = coinResults.slice(-10);
                coinHistory.textContent = recentResults.join(' - ');
            }, 600);
        }
        
        // 单次抛硬币（无动效，用于连续抛硬币）
        function flipSingleCoinNoAnimation() {
            const isHeads = Math.random() < 0.5;
            
            if (isHeads) {
                coinDisplay.textContent = '正';
                coinDisplay.style.backgroundColor = '#fbbf24';
                headsCount++;
                coinResults.push('正');
                headsCountEl.textContent = headsCount;
            } else {
                coinDisplay.textContent = '反';
                coinDisplay.style.backgroundColor = '#94a3b8';
                tailsCount++;
                coinResults.push('反');
                tailsCountEl.textContent = tailsCount;
            }
            
            // 更新历史记录，只显示最近10次
            const recentResults = coinResults.slice(-10);
            coinHistory.textContent = recentResults.join(' - ');
        }
        
        // 连续抛硬币（无动效）
        function flipMultipleTimes(times) {
            let count = 0;
            const interval = setInterval(() => {
                if (count >= times) {
                    clearInterval(interval);
                    return;
                }
                
                flipSingleCoinNoAnimation();
                count++;
            }, 50);
        }
        
        // 重置硬币统计
        function resetCoinStats() {
            headsCount = 0;
            tailsCount = 0;
            coinResults = [];
            headsCountEl.textContent = '0';
            tailsCountEl.textContent = '0';
            coinHistory.textContent = '开始抛硬币吧！';
            coinDisplay.textContent = '🪙';
            coinDisplay.style.backgroundColor = '#fbbf24';
        }
        
        // 事件监听器
        if (flipCoinBtn) {
            flipCoinBtn.addEventListener('click', flipSingleCoin);
        }
        
        if (flip10TimesBtn) {
            flip10TimesBtn.addEventListener('click', () => flipMultipleTimes(10));
        }
        
        if (flip100TimesBtn) {
            flip100TimesBtn.addEventListener('click', () => flipMultipleTimes(100));
        }
        
        if (resetCoinBtn) {
            resetCoinBtn.addEventListener('click', resetCoinStats);
        }
        


        // --- 初始化 ---
        window.onload = () => {
            initializeActivity1();
            updateBallCounts();
            createPrizeControls();
            drawSpinner();
            

            
            // 默认显示活动一
            showSection('activity-1');
        };
    </script>
</body>
</html>