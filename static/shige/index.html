<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>十格阵</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            margin: 0;
            height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
        }

        .container {
            background: #e3f2fd;
            min-height: 90vh;
            width: 100%;
            display: flex;
            flex-direction: column;
            justify-content: space-between;
        }

        .title {
            background: #7c4dff;
            color: white;
            padding: 10px 20px;
            border-radius: 20px;
            display: inline-block;
            margin-bottom: 30px;
            font-size: 18px;
            font-weight: bold;
        }

        .grids-container {
            display: flex;
            gap: 60px;
            justify-content: center;
            align-items: center;
            flex: 1;
            flex-wrap: wrap;
        }

        .grid {
            display: grid;
            grid-template-columns: repeat(5, 1fr);
            grid-template-rows: repeat(2, 1fr);
            gap: 0;
            border: 2px solid #333;
            padding: 0;
            background: #f5f5f5;
            border-radius: 5px;
            width: min(600px, 45vw);
            max-width: 800px;
        }

        .cell {
            aspect-ratio: 1;
            border: 1px solid #333;
            background: white;
            display: flex;
            align-items: center;
            justify-content: center;
            position: relative;
            min-width: min(40px, 4vw);
            min-height: min(40px, 4vw);
        }

        .circle {
            width: 80%;
            height: 80%;
            max-width: min(80px, 8vw);
            max-height: min(80px, 8vw);
            min-width: min(30px, 3vw);
            min-height: min(30px, 3vw);
            border-radius: 50%;
            cursor: grab;
            position: absolute;
            z-index: 10;
            transition: transform 0.2s ease;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.2);
        }

        .circle:hover {
            transform: scale(1.1);
        }

        .circle:active {
            cursor: grabbing;
            transform: scale(1.2);
        }

        .blue-circle {
            background: #5c6bc0;
        }

        .red-circle {
            background: #ef5350;
        }

        .equation-container {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: min(30px, 3vw);
            font-size: min(60px, 8vw);
            font-weight: bold;
            color: #333;
            margin: 30px 0;
        }

        .number-box {
            border:3px solid #333;
            background: #fff;
            border-radius: 12px;
            padding: min(20px, 2vw);
            min-width: min(60px, 8vw);
            text-align: center;
            aspect-ratio: 1;
        }
        #num1{color: #5c6bc0;}
        #num2{color: #ef5350;}
        .number-box,.operator,.equals {
            font-size: min(60px, 8vw);
            color: #333;
        }

        .result-box {
            background: white;
            border: 3px solid #ccc;
            border-radius: 15px;
            padding: min(20px, 2vw);
            min-width: min(80px, 10vw);
            text-align: center;
            color: #666;
            cursor: pointer;
            transition: all 0.3s ease;
            position: relative;
            aspect-ratio: 1;
            font-size: min(70px, 9vw);
        }

        .result-box:hover {
            border-color: #4caf50;
            transform: scale(1.05);
        }

        .result-box.hidden::after {
            content: '?';
            color: #999;
            font-size: 0.8em;
        }

        .result-box.show-answer {
            border-color: #4caf50;
            color: #4caf50;
        }

        .new-problem-btn {
            background: #4caf50;
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 25px;
            font-size: 18px;
            cursor: pointer;
            margin: 20px auto;
            width: 120px;
            transition: background 0.3s ease;
        }

        .new-problem-btn:hover {
            background: #45a049;
        }

        
        @media (max-width: 1200px) {
            .grids-container {
                flex-direction: column;
                gap: 30px;
            }
            
            .grid {
                width: min(500px, 85vw);
                max-width: 600px;
            }
        }

        @media (max-width: 600px) {
            .container {
                padding: 20px;
                width: 98vw;
            }
            
            .grid {
                width: min(350px, 90vw);
                padding: 10px;
            }
            
            .equation-container {
                font-size: min(40px, 10vw);
                gap: min(15px, 2vw);
            }
            
            .operator, .equals {
                font-size: min(50px, 12vw);
            }
        }

        @media (min-width: 1400px) {
            .grid {
                width: min(700px, 40vw);
                max-width: 800px;
            }
            
            .equation-container {
                font-size: 80px;
            }
            
            .operator, .equals {
                font-size: 90px;
            }
        }

        @media (min-width: 1800px) {
            .grid {
                width: min(800px, 35vw);
                max-width: 900px;
            }
            
            .grids-container {
                gap: 80px;
            }
        }
    </style>
</head>
<body>        
    <div class="container">

        
        <div class="equation-container">
            <div class="number-box" id="num1">9</div>
            <div class="operator">+</div>
            <div class="number-box" id="num2">5</div>
            <div class="equals">=</div>
            <div class="result-box" id="result"></div>
        </div>

        <div class="grids-container">
            <div class="grid" id="grid1">
                <div class="cell" data-grid="1" data-index="0"></div>
                <div class="cell" data-grid="1" data-index="1"></div>
                <div class="cell" data-grid="1" data-index="2"></div>
                <div class="cell" data-grid="1" data-index="3"></div>
                <div class="cell" data-grid="1" data-index="4"></div>
                <div class="cell" data-grid="1" data-index="5"></div>
                <div class="cell" data-grid="1" data-index="6"></div>
                <div class="cell" data-grid="1" data-index="7"></div>
                <div class="cell" data-grid="1" data-index="8"></div>
                <div class="cell" data-grid="1" data-index="9"></div>
            </div>
            
            <div class="grid" id="grid2">
                <div class="cell" data-grid="2" data-index="0"></div>
                <div class="cell" data-grid="2" data-index="1"></div>
                <div class="cell" data-grid="2" data-index="2"></div>
                <div class="cell" data-grid="2" data-index="3"></div>
                <div class="cell" data-grid="2" data-index="4"></div>
                <div class="cell" data-grid="2" data-index="5"></div>
                <div class="cell" data-grid="2" data-index="6"></div>
                <div class="cell" data-grid="2" data-index="7"></div>
                <div class="cell" data-grid="2" data-index="8"></div>
                <div class="cell" data-grid="2" data-index="9"></div>
            </div>
        </div>
    
        <button class="new-problem-btn" onclick="generateNewProblem()">新题目</button>
    </div>

    <script>
var JSConfetti=function(){"use strict";function t(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function e(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function i(t,i,n){return i&&e(t.prototype,i),n&&e(t,n),t}function n(t){return+t.replace(/px/,"")}function s(t,e){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,n=Math.random()*(e-t)+t;return Math.floor(n*Math.pow(10,i))/Math.pow(10,i)}function o(t){return t[s(0,t.length)]}var a=["#fcf403","#62fc03","#f4fc03","#03e7fc","#03fca5","#a503fc","#fc03ad","#fc03c2"];function r(t){return Math.log(t)/Math.log(1920)}var h=function(){function e(i){t(this,e);var n=i.initialPosition,a=i.direction,h=i.confettiRadius,c=i.confettiColors,u=i.emojis,l=i.emojiSize,d=i.canvasWidth,f=s(.9,1.7,3)*r(d);this.confettiSpeed={x:f,y:f},this.finalConfettiSpeedX=s(.2,.6,3),this.rotationSpeed=u.length?.01:s(.03,.07,3)*r(d),this.dragForceCoefficient=s(5e-4,9e-4,6),this.radius={x:h,y:h},this.initialRadius=h,this.rotationAngle="left"===a?s(0,.2,3):s(-.2,0,3),this.emojiSize=l,this.emojiRotationAngle=s(0,2*Math.PI),this.radiusYUpdateDirection="down";var m="left"===a?s(82,15)*Math.PI/180:s(-15,-82)*Math.PI/180;this.absCos=Math.abs(Math.cos(m)),this.absSin=Math.abs(Math.sin(m));var v=s(-150,0),p={x:n.x+("left"===a?-v:v)*this.absCos,y:n.y-v*this.absSin};this.currentPosition=Object.assign({},p),this.initialPosition=Object.assign({},p),this.color=u.length?null:o(c),this.emoji=u.length?o(u):null,this.createdAt=(new Date).getTime(),this.direction=a}return i(e,[{key:"draw",value:function(t){var e=this.currentPosition,i=this.radius,n=this.color,s=this.emoji,o=this.rotationAngle,a=this.emojiRotationAngle,r=this.emojiSize,h=window.devicePixelRatio;n?(t.fillStyle=n,t.beginPath(),t.ellipse(e.x*h,e.y*h,i.x*h,i.y*h,o,0,2*Math.PI),t.fill()):s&&(t.font="".concat(r,"px serif"),t.save(),t.translate(h*e.x,h*e.y),t.rotate(a),t.textAlign="center",t.fillText(s,0,0),t.restore())}},{key:"updatePosition",value:function(t,e){var i=this.confettiSpeed,n=this.dragForceCoefficient,s=this.finalConfettiSpeedX,o=this.radiusYUpdateDirection,a=this.rotationSpeed,r=this.createdAt,h=this.direction,c=e-r;i.x>s&&(this.confettiSpeed.x-=n*t),this.currentPosition.x+=i.x*("left"===h?-this.absCos:this.absCos)*t,this.currentPosition.y=this.initialPosition.y-i.y*this.absSin*c+.00125*Math.pow(c,2)/2,this.rotationSpeed-=this.emoji?1e-4:1e-5*t,this.rotationSpeed<0&&(this.rotationSpeed=0),this.emoji?this.emojiRotationAngle+=this.rotationSpeed*t%(2*Math.PI):"down"===o?(this.radius.y-=t*a,this.radius.y<=0&&(this.radius.y=0,this.radiusYUpdateDirection="up")):(this.radius.y+=t*a,this.radius.y>=this.initialRadius&&(this.radius.y=this.initialRadius,this.radiusYUpdateDirection="down"))}},{key:"getIsVisibleOnCanvas",value:function(t){return this.currentPosition.y<t+100}}]),e}();function c(){var t=document.createElement("canvas");return t.style.position="fixed",t.style.width="100%",t.style.height="100%",t.style.top="0",t.style.left="0",t.style.zIndex="1000",t.style.pointerEvents="none",document.body.appendChild(t),t}function u(t){var e=t.confettiRadius,i=void 0===e?6:e,n=t.confettiNumber,s=void 0===n?t.confettiesNumber||(t.emojis?40:250):n,o=t.confettiColors,r=void 0===o?a:o,h=t.emojis,c=void 0===h?t.emojies||[]:h,u=t.emojiSize,l=void 0===u?80:u;return t.emojies&&console.error("emojies argument is deprecated, please use emojis instead"),t.confettiesNumber&&console.error("confettiesNumber argument is deprecated, please use confettiNumber instead"),{confettiRadius:i,confettiNumber:s,confettiColors:r,emojis:c,emojiSize:l}}var l=function(){function e(i){var n=this;t(this,e),this.canvasContext=i,this.shapes=[],this.promise=new Promise((function(t){return n.resolvePromise=t}))}return i(e,[{key:"getBatchCompletePromise",value:function(){return this.promise}},{key:"addShapes",value:function(){var t;(t=this.shapes).push.apply(t,arguments)}},{key:"complete",value:function(){var t;return!this.shapes.length&&(null===(t=this.resolvePromise)||void 0===t||t.call(this),!0)}},{key:"processShapes",value:function(t,e,i){var n=this,s=t.timeDelta,o=t.currentTime;this.shapes=this.shapes.filter((function(t){return t.updatePosition(s,o),t.draw(n.canvasContext),!i||t.getIsVisibleOnCanvas(e)}))}}]),e}();return function(){function e(){var i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};t(this,e),this.activeConfettiBatches=[],this.canvas=i.canvas||c(),this.canvasContext=this.canvas.getContext("2d"),this.requestAnimationFrameRequested=!1,this.lastUpdated=(new Date).getTime(),this.iterationIndex=0,this.loop=this.loop.bind(this),requestAnimationFrame(this.loop)}return i(e,[{key:"loop",value:function(){var t,e,i,s,o;this.requestAnimationFrameRequested=!1,t=this.canvas,e=window.devicePixelRatio,i=getComputedStyle(t),s=n(i.getPropertyValue("width")),o=n(i.getPropertyValue("height")),t.setAttribute("width",(s*e).toString()),t.setAttribute("height",(o*e).toString());var a=(new Date).getTime(),r=a-this.lastUpdated,h=this.canvas.offsetHeight,c=this.iterationIndex%10==0;this.activeConfettiBatches=this.activeConfettiBatches.filter((function(t){return t.processShapes({timeDelta:r,currentTime:a},h,c),!c||!t.complete()})),this.iterationIndex++,this.queueAnimationFrameIfNeeded(a)}},{key:"queueAnimationFrameIfNeeded",value:function(t){this.requestAnimationFrameRequested||this.activeConfettiBatches.length<1||(this.requestAnimationFrameRequested=!0,this.lastUpdated=t||(new Date).getTime(),requestAnimationFrame(this.loop))}},{key:"addConfetti",value:function(){for(var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=u(t),i=e.confettiRadius,n=e.confettiNumber,s=e.confettiColors,o=e.emojis,a=e.emojiSize,r=this.canvas.getBoundingClientRect(),c=r.width,d=r.height,f=5*d/7,m={x:0,y:f},v={x:c,y:f},p=new l(this.canvasContext),y=0;y<n/2;y++){var g=new h({initialPosition:m,direction:"right",confettiRadius:i,confettiColors:s,confettiNumber:n,emojis:o,emojiSize:a,canvasWidth:c}),C=new h({initialPosition:v,direction:"left",confettiRadius:i,confettiColors:s,confettiNumber:n,emojis:o,emojiSize:a,canvasWidth:c});p.addShapes(g,C)}return this.activeConfettiBatches.push(p),this.queueAnimationFrameIfNeeded(),p.getBatchCompletePromise()}},{key:"clearCanvas",value:function(){this.activeConfettiBatches=[]}},{key:"destroyCanvas",value:function(){this.canvas.remove()}}]),e}()}();
        const confetti = new JSConfetti();
        function showConfetti() {
            confetti.addConfetti({
                confettiNumber: 500
            })
        }

        let draggedElement = null;
        let currentNum1 = 9;
        let currentNum2 = 5;

        // 初始化
        function init() {
            generateNewProblem();
            setupDragAndDrop();
        }

        // 生成新题目
        function generateNewProblem() {
            // 清除所有圆片
            document.querySelectorAll('.circle').forEach(circle => circle.remove());
            
            // 生成随机数字（1-9）
            currentNum1 = Math.floor(Math.random() * 9) + 1;
            currentNum2 = Math.floor(Math.random() * 9) + 1;
            
            // 更新显示
            document.getElementById('num1').textContent = currentNum1;
            document.getElementById('num2').textContent = currentNum2;
            
            // 重置答案框
            const resultBox = document.getElementById('result');
            resultBox.textContent = '';
            resultBox.classList.remove('show-answer');
            resultBox.classList.add('hidden');
            
            // 在第一个网格中放置蓝色圆片
            placeCircles('grid1', currentNum1, 'blue-circle');
            
            // 在第二个网格中放置红色圆片
            placeCircles('grid2', currentNum2, 'red-circle');
            
            // 重新检查答案以设置正确的点击事件
            checkAnswer();
        }

        // 在指定网格中放置圆片
        function placeCircles(gridId, count, className) {
            const grid = document.getElementById(gridId);
            const cells = grid.querySelectorAll('.cell');
            
            for (let i = 0; i < count && i < 10; i++) {
                const circle = document.createElement('div');
                circle.className = `circle ${className}`;
                circle.draggable = true;
                cells[i].appendChild(circle);
            }
        }

        // 设置拖拽功能
        function setupDragAndDrop() {
            document.addEventListener('dragstart', handleDragStart);
            document.addEventListener('dragover', handleDragOver);
            document.addEventListener('drop', handleDrop);
            document.addEventListener('dragend', handleDragEnd);
            
            // 移动端触摸事件
            document.addEventListener('touchstart', handleTouchStart, { passive: false });
            document.addEventListener('touchmove', handleTouchMove, { passive: false });
            document.addEventListener('touchend', handleTouchEnd, { passive: false });
        }

        function handleDragStart(e) {
            if (e.target.classList.contains('circle')) {
                draggedElement = e.target;
                e.target.classList.add('dragging');
            }
        }

        function handleDragOver(e) {
            e.preventDefault();
            if (e.target.classList.contains('cell')) {
                e.target.classList.add('highlight');
            }
        }

        function handleDrop(e) {
            e.preventDefault();
            
            if (e.target.classList.contains('cell') && draggedElement) {
                // 如果目标格子已有圆片，则交换位置
                const existingCircle = e.target.querySelector('.circle');
                const sourceCell = draggedElement.parentNode;
                
                if (existingCircle && existingCircle !== draggedElement) {
                    // 交换圆片
                    sourceCell.appendChild(existingCircle);
                }
                
                e.target.appendChild(draggedElement);
                checkAnswer();
            }
            
            // 清除高亮
            document.querySelectorAll('.cell').forEach(cell => {
                cell.classList.remove('highlight');
            });
        }

        function handleDragEnd(e) {
            if (e.target.classList.contains('circle')) {
                e.target.classList.remove('dragging');
            }
            draggedElement = null;
        }

        // 检查答案
        function checkAnswer() {
            const resultBox = document.getElementById('result');
            const grid1Circles = document.querySelectorAll('#grid1 .circle').length;
            const grid2Circles = document.querySelectorAll('#grid2 .circle').length;
            const totalCircles = grid1Circles + grid2Circles;
            
            // 重置答案显示状态
            resultBox.classList.remove('show-answer');
            resultBox.classList.add('hidden');
            resultBox.textContent = '';
            
            // 设置点击事件：如果圆片总数正确，点击显示答案；如果已显示答案，点击生成新题目
            if (totalCircles === currentNum1 + currentNum2) {
                resultBox.onclick = function() {
                    if (resultBox.classList.contains('hidden')) {
                        // 显示答案
                        resultBox.textContent = currentNum1 + currentNum2;
                        resultBox.classList.remove('hidden');
                        resultBox.classList.add('show-answer');
                        showConfetti();
                    } else {
                        // 生成新题目
                        generateNewProblem();
                    }
                };
            } else {
                resultBox.onclick = null;
            }
        }

        let touchedElement = null;
        let touchOffset = { x: 0, y: 0 };
        let currentTouchTarget = null;

        // 移动端触摸事件处理
        function handleTouchStart(e) {
             if (e.target.classList.contains('circle')) {
                 e.preventDefault();
                 touchedElement = e.target;
                 const touch = e.touches[0];
                 const rect = touchedElement.getBoundingClientRect();
                 touchOffset.x = touch.clientX - rect.left - rect.width / 2;
                 touchOffset.y = touch.clientY - rect.top - rect.height / 2;
                 touchedElement.classList.add('dragging');
                 // Avoid intercepting pointer events so we can detect the cell under the finger
                 touchedElement.style.pointerEvents = 'none';
             }
         }

        function handleTouchMove(e) {
            if (touchedElement) {
                e.preventDefault();
                const touch = e.touches[0];
                touchedElement.style.position = 'fixed';
                touchedElement.style.left = (touch.clientX - touchOffset.x - touchedElement.offsetWidth / 2) + 'px';
                touchedElement.style.top = (touch.clientY - touchOffset.y - touchedElement.offsetHeight / 2) + 'px';
                
                // 检查当前触摸位置下的元素
                const elementBelow = document.elementFromPoint(touch.clientX, touch.clientY);
                const targetCell = elementBelow ? elementBelow.closest('.cell') : null;
                
                // 清除之前的高亮
                document.querySelectorAll('.cell').forEach(cell => {
                    cell.classList.remove('highlight');
                });
                
                // 如果触摸到格子，添加高亮
                if (targetCell) {
                    currentTouchTarget = targetCell;
                    targetCell.classList.add('highlight');
                } else {
                    currentTouchTarget = null;
                }
            }
        }

        function handleTouchEnd(e) {
            if (touchedElement) {
                e.preventDefault();
                
                // 如果有有效的目标格子，先完成移动操作
                if (currentTouchTarget && currentTouchTarget.classList.contains('cell')) {
                    // 如果目标格子已有圆片，则交换位置
                    const existingCircle = currentTouchTarget.querySelector('.circle');
                    const sourceCell = touchedElement.parentNode;
                    
                    if (existingCircle && existingCircle !== touchedElement) {
                        // 交换圆片
                        sourceCell.appendChild(existingCircle);
                    }
                    
                    currentTouchTarget.appendChild(touchedElement);
                    checkAnswer();
                }
                
                // 恢复样式
                touchedElement.classList.remove('dragging');
                touchedElement.style.position = 'absolute';
                touchedElement.style.left = '';
                touchedElement.style.top = '';
                touchedElement.style.pointerEvents = '';
                
                // 清除高亮
                document.querySelectorAll('.cell').forEach(cell => {
                    cell.classList.remove('highlight');
                });
                
                touchedElement = null;
                currentTouchTarget = null;
            }
        }

        // 页面加载完成后初始化
        document.addEventListener('DOMContentLoaded', init);
    </script>
</body>
</html>