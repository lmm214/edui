<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>探索因数的个数</title>
    <script src="https://fastly.jsdelivr.net/npm/chart.js"></script>
    <style>
        /* Basic Reset & Base Styles */
        *, ::before, ::after { box-sizing: border-box; border-width: 0; border-style: solid; border-color: #e5e7eb;margin: 0;padding: 0; }
        html { line-height: 1.5; -webkit-text-size-adjust: 100%; -moz-tab-size: 4; tab-size: 4; font-family: 'Noto Sans SC', sans-serif; }
        body { margin: 0; line-height: inherit; font-family: 'Noto Sans SC', sans-serif; background-color: #fdfbf7; color: #3f3c3a; }

        /* Layout & Container */
        .container { width: 100%; margin-left: auto; margin-right: auto; padding-left: 1rem; padding-right: 1rem; }
        @media (min-width: 640px) { .container { max-width: 640px; } }
        @media (min-width: 768px) { .container { max-width: 768px; } }
        @media (min-width: 1024px) { .container { max-width: 1024px; } }
        @media (min-width: 1280px) { .container { max-width: 1280px; } }
        .p-4 { padding: 1rem; }
        .p-6 { padding: 1.5rem; }
        .px-4 { padding-left: 1rem; padding-right: 1rem; }
        .py-2 { padding-top: 0.5rem; padding-bottom: 0.5rem; }
        .pr-8 { padding-right: 2rem; }
        .mb-12 { margin-bottom: 3rem; }
        .mb-4 { margin-bottom: 1rem; }
        .mb-2 { margin-bottom: 0.5rem; }
        .mt-2 { margin-top: 0.5rem; }
        .mt-4 { margin-top: 1rem; }
        .mt-6 { margin-top: 3rem; }
        .mt-8 { margin-top: 5rem; }

        /* Grid */
        .grid { display: grid; }
        .grid-cols-1 { grid-template-columns: repeat(1, minmax(0, 1fr)); }
        .grid-cols-10 { grid-template-columns: repeat(10, minmax(0, 1fr)); }
        .gap-3 { gap: 0.75rem; }
        .gap-8 { gap: 2rem; }
        @media (min-width: 1024px) {
          .lg\:grid-cols-3 { grid-template-columns: repeat(3, minmax(0, 1fr)); }
          .lg\:col-span-1 { grid-column: span 1 / span 1; }
          .lg\:col-span-2 { grid-column: span 2 / span 2; }
          .lg\:sticky { position: sticky; }
        }

        /* Sizing & Positioning */
        .h-fit { height: -webkit-fit-content; height: -moz-fit-content; height: fit-content; }
        .max-w-3xl { max-width: 48rem; }
        .max-w-2xl { max-width: 42rem; }
        .aspect-square { aspect-ratio: 1 / 1; }
        .fixed { position: fixed; }
        .top-5 { top: 1.25rem; }
        .right-5 { right: 1.25rem; }
        .top-8 { top: 2rem; }
        .z-30 { z-index: 30; }

        /* Typography */
        .text-center { text-align: center; }
        .text-3xl { font-size: 1.875rem; line-height: 2.25rem; }
        .text-7xl { font-size: 4.5rem; line-height: 1; }
        .text-lg { font-size: 1.125rem; line-height: 1.75rem; }
        .text-xl { font-size: 1.25rem; line-height: 1.75rem; }
        .text-sm { font-size: 0.875rem; line-height: 1.25rem; }
        .font-bold { font-weight: 700; }
        .font-semibold { font-weight: 600; }
        .font-medium { font-weight: 500; }
        .text-gray-800 { color: rgb(31 41 55); }
        .text-gray-600 { color: rgb(75 85 99); }
        .text-gray-700 { color: rgb(55 65 81); }
        .text-indigo-500 { color: rgb(99 102 241); }
        .break-words { overflow-wrap: break-word; }
        @media (min-width: 640px) {
          .sm\:text-4xl { font-size: 2.25rem; line-height: 2.5rem; }
          .sm\:text-8xl { font-size: 6rem; line-height: 1; }
        }
        @media (min-width: 1024px) {
          .lg\:text-9xl { font-size: 8rem; line-height: 1; }
        }

        /* Backgrounds, Borders, Shadows */
        .bg-white { background-color: #fff; }
        .bg-gray-50 { background-color: rgb(249 250 251); }
        .rounded-2xl { border-radius: 1rem; }
        .rounded-full { border-radius: 9999px; }
        .rounded-lg { border-radius: 0.5rem; }
        .shadow-xl { box-shadow: 0 20px 25px -5px rgb(0 0 0 / 0.1), 0 8px 10px -6px rgb(0 0 0 / 0.1); }
        .shadow-lg { box-shadow: 0 10px 15px -3px rgb(0 0 0 / 0.1), 0 4px 6px -4px rgb(0 0 0 / 0.1); }
        .shadow-md { box-shadow: 0 4px 6px -1px rgb(0 0 0 / 0.1), 0 2px 4px -2px rgb(0 0 0 / 0.1); }
        .border-gray-300 { border-width: 1px; border-color: rgb(209 213 219); }

        /* Forms & Interactivity */
        .focus\:ring-indigo-500:focus { --tw-ring-offset-shadow: var(--tw-ring-inset) 0 0 0 var(--tw-ring-offset-width) var(--tw-ring-offset-color); --tw-ring-shadow: var(--tw-ring-inset) 0 0 0 calc(1px + var(--tw-ring-offset-width)) var(--tw-ring-color); box-shadow: var(--tw-ring-offset-shadow), var(--tw-ring-shadow), var(--tw-shadow, 0 0 #0000); }
        .focus\:border-indigo-500:focus { border-color: rgb(99 102 241); }
        select { -webkit-appearance: none; -moz-appearance: none; appearance: none; background-image: url("data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' fill='none' viewBox='0 0 20 20'%3e%3cpath stroke='%236b7280' stroke-linecap='round' stroke-linejoin='round' stroke-width='1.5' d='M6 8l4 4 4-4'/%3e%3c/svg%3e"); background-position: right 0.5rem center; background-repeat: no-repeat; background-size: 1.5em 1.5em; }
        .cursor-pointer { cursor: pointer; }
        
        /* Flexbox & Overflow */
        .flex { display: flex; }
        .items-center { align-items: center; }
        .justify-center { justify-content: center; }
        .overflow-y-auto { overflow-y: auto; }

        /* Custom Styles */
        .chart-container { position: relative; width: 100%; max-width: 800px; margin-left: auto; margin-right: auto; height: 350px; max-height: 450px; }
        #factors-chart { cursor: pointer; }
        .number-card {font-size:1.8rem;transition: transform 0.2s ease-in-out, box-shadow 0.2s ease-in-out, background-color 0.2s ease-in-out; }
        .number-card:hover { transform: translateY(-4px); box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05); }
        .selected { background-color: #dcfce7 !important; transform: scale(1.05); box-shadow: 0 0 0 2px #4ade80; z-index: 10; }
        .highlight-factor { background-color: #e0f2fe !important; border: 1px solid #7dd3fc; }
        .highlight-chart-selected { background-color: #fef3c7 !important; border: 1px solid #fcd34d; }
    </style>
</head>
<body class="antialiased">

    <div id="range-selector-container" class="fixed top-5 right-5 z-30">
        <select id="range-select" class="bg-white rounded-full font-semibold shadow-lg border-gray-300 focus:ring-indigo-500 focus:border-indigo-500 px-4 py-2 pr-8">
            <option value="50">1~50</option>
            <option value="100">1~100</option>
        </select>
    </div>

    <div class="container mx-auto p-4 sm:p-6 lg:p-8">

        <header class="text-center mb-4">
            <h1 class="text-3xl sm:text-4xl font-bold text-gray-800">探索因数的个数</h1>
            <p class="mt-2 text-lg text-gray-600">从右侧网格中选择一个数进行探索</p>
        </header>

        <main class="grid grid-cols-1 lg:grid-cols-3 gap-8 mb-12">
            

                <section id="details-panel" class="text-center py-8 bg-white rounded-2xl shadow-xl">
                    <p class="mt-8 text-xl sm:text-8xl lg:text-9xl font-bold text-indigo-500" id="selected-number">1</p>
                    <div id="factor-details-wrapper">
                        <p class="font-medium text-xl text-gray-600 mt-4" id="factor-count">共有 1 个因数</p>
                        <div id="factors-list-container" class="mt-6 max-w-3xl mx-auto px-4">
                             <p id="factors-list" class="text-gray-600 bg-gray-50 p-4 rounded-lg break-words text-3xl">1</p>
                        </div>
                    </div>
                </section>

            <section id="numbers-grid-container" class="lg:col-span-2 bg-white p-6 rounded-2xl shadow-xl">
                <div id="numbers-grid" class="grid grid-cols-10 gap-3">
                </div>
            </section>

        </main>
        
        <section class="bg-white rounded-2xl shadow-xl p-6">
            <h2 class="text-2xl font-bold mb-4 text-gray-800 text-center"><span id="chart-range-label">1 ~ 50</span> 的因数个数统计图</h2>
            <div class="chart-container">
                <canvas id="factors-chart"></canvas>
            </div>
        </section>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const allNumbersData = [
                { number: 1, factors: [1] }, { number: 2, factors: [1, 2] }, { number: 3, factors: [1, 3] }, { number: 4, factors: [1, 2, 4] }, { number: 5, factors: [1, 5] }, { number: 6, factors: [1, 2, 3, 6] }, { number: 7, factors: [1, 7] }, { number: 8, factors: [1, 2, 4, 8] }, { number: 9, factors: [1, 3, 9] }, { number: 10, factors: [1, 2, 5, 10] },
                { number: 11, factors: [1, 11] }, { number: 12, factors: [1, 2, 3, 4, 6, 12] }, { number: 13, factors: [1, 13] }, { number: 14, factors: [1, 2, 7, 14] }, { number: 15, factors: [1, 3, 5, 15] }, { number: 16, factors: [1, 2, 4, 8, 16] }, { number: 17, factors: [1, 17] }, { number: 18, factors: [1, 2, 3, 6, 9, 18] }, { number: 19, factors: [1, 19] }, { number: 20, factors: [1, 2, 4, 5, 10, 20] },
                { number: 21, factors: [1, 3, 7, 21] }, { number: 22, factors: [1, 2, 11, 22] }, { number: 23, factors: [1, 23] }, { number: 24, factors: [1, 2, 3, 4, 6, 8, 12, 24] }, { number: 25, factors: [1, 5, 25] }, { number: 26, factors: [1, 2, 13, 26] }, { number: 27, factors: [1, 3, 9, 27] }, { number: 28, factors: [1, 2, 4, 7, 14, 28] }, { number: 29, factors: [1, 29] }, { number: 30, factors: [1, 2, 3, 5, 6, 10, 15, 30] },
                { number: 31, factors: [1, 31] }, { number: 32, factors: [1, 2, 4, 8, 16, 32] }, { number: 33, factors: [1, 3, 11, 33] }, { number: 34, factors: [1, 2, 17, 34] }, { number: 35, factors: [1, 5, 7, 35] }, { number: 36, factors: [1, 2, 3, 4, 6, 9, 12, 18, 36] }, { number: 37, factors: [1, 37] }, { number: 38, factors: [1, 2, 19, 38] }, { number: 39, factors: [1, 3, 13, 39] }, { number: 40, factors: [1, 2, 4, 5, 8, 10, 20, 40] },
                { number: 41, factors: [1, 41] }, { number: 42, factors: [1, 2, 3, 6, 7, 14, 21, 42] }, { number: 43, factors: [1, 43] }, { number: 44, factors: [1, 2, 4, 11, 22, 44] }, { number: 45, factors: [1, 3, 5, 9, 15, 45] }, { number: 46, factors: [1, 2, 23, 46] }, { number: 47, factors: [1, 47] }, { number: 48, factors: [1, 2, 3, 4, 6, 8, 12, 16, 24, 48] }, { number: 49, factors: [1, 7, 49] }, { number: 50, factors: [1, 2, 5, 10, 25, 50] },
                { number: 51, factors: [1, 3, 17, 51] }, { number: 52, factors: [1, 2, 4, 13, 26, 52] }, { number: 53, factors: [1, 53] }, { number: 54, factors: [1, 2, 3, 6, 9, 18, 27, 54] }, { number: 55, factors: [1, 5, 11, 55] }, { number: 56, factors: [1, 2, 4, 7, 8, 14, 28, 56] }, { number: 57, factors: [1, 3, 19, 57] }, { number: 58, factors: [1, 2, 29, 58] }, { number: 59, factors: [1, 59] }, { number: 60, factors: [1, 2, 3, 4, 5, 6, 10, 12, 15, 20, 30, 60] },
                { number: 61, factors: [1, 61] }, { number: 62, factors: [1, 2, 31, 62] }, { number: 63, factors: [1, 3, 7, 9, 21, 63] }, { number: 64, factors: [1, 2, 4, 8, 16, 32, 64] }, { number: 65, factors: [1, 5, 13, 65] }, { number: 66, factors: [1, 2, 3, 6, 11, 22, 33, 66] }, { number: 67, factors: [1, 67] }, { number: 68, factors: [1, 2, 4, 17, 34, 68] }, { number: 69, factors: [1, 3, 23, 69] }, { number: 70, factors: [1, 2, 5, 7, 10, 14, 35, 70] },
                { number: 71, factors: [1, 71] }, { number: 72, factors: [1, 2, 3, 4, 6, 8, 9, 12, 18, 24, 36, 72] }, { number: 73, factors: [1, 73] }, { number: 74, factors: [1, 2, 37, 74] }, { number: 75, factors: [1, 3, 5, 15, 25, 75] }, { number: 76, factors: [1, 2, 4, 19, 38, 76] }, { number: 77, factors: [1, 7, 11, 77] }, { number: 78, factors: [1, 2, 3, 6, 13, 26, 39, 78] }, { number: 79, factors: [1, 79] }, { number: 80, factors: [1, 2, 4, 5, 8, 10, 16, 20, 40, 80] },
                { number: 81, factors: [1, 3, 9, 27, 81] }, { number: 82, factors: [1, 2, 41, 82] }, { number: 83, factors: [1, 83] }, { number: 84, factors: [1, 2, 3, 4, 6, 7, 12, 14, 21, 28, 42, 84] }, { number: 85, factors: [1, 5, 17, 85] }, { number: 86, factors: [1, 2, 43, 86] }, { number: 87, factors: [1, 3, 29, 87] }, { number: 88, factors: [1, 2, 4, 8, 11, 22, 44, 88] }, { number: 89, factors: [1, 89] }, { number: 90, factors: [1, 2, 3, 5, 6, 9, 10, 15, 18, 30, 45, 90] },
                { number: 91, factors: [1, 7, 13, 91] }, { number: 92, factors: [1, 2, 4, 23, 46, 92] }, { number: 93, factors: [1, 3, 31, 93] }, { number: 94, factors: [1, 2, 47, 94] }, { number: 95, factors: [1, 5, 19, 95] }, { number: 96, factors: [1, 2, 3, 4, 6, 8, 12, 16, 24, 32, 48, 96] }, { number: 97, factors: [1, 97] }, { number: 98, factors: [1, 2, 7, 14, 49, 98] }, { number: 99, factors: [1, 3, 9, 11, 33, 99] }, { number: 100, factors: [1, 2, 4, 5, 10, 20, 25, 50, 100] }
            ];

            const grid = document.getElementById('numbers-grid');
            const gridContainer = document.getElementById('numbers-grid-container');
            const detailsPanel = document.getElementById('details-panel');
            const selectedNumberEl = document.getElementById('selected-number');
            const factorCountEl = document.getElementById('factor-count');
            const factorsListEl = document.getElementById('factors-list');

            const rangeSelect = document.getElementById('range-select');
            const chartRangeLabel = document.getElementById('chart-range-label');
            
            let currentRange = 50;
            let chartInstance = null;
            
            function clearAllHighlights() {
                document.querySelectorAll('.number-card.selected, .number-card.highlight-factor, .number-card.highlight-chart-selected').forEach(card => {
                    card.classList.remove('selected', 'highlight-factor', 'highlight-chart-selected');
                });
            }

            function updateDetails(number) {
                const data = allNumbersData[number - 1];
                if (!data) return;

                selectedNumberEl.textContent = data.number;
                factorCountEl.textContent = `共有 ${data.factors.length} 个因数`;
                factorsListEl.textContent = data.factors.join(', ');

                clearAllHighlights();

                const selectedCard = document.querySelector(`.number-card[data-number='${number}']`);
                if (selectedCard) {
                    selectedCard.classList.add('selected');
                }

                data.factors.forEach(factor => {
                    const factorCard = document.querySelector(`.number-card[data-number='${factor}']`);
                    if (factorCard) {
                        factorCard.classList.add('highlight-factor');
                    }
                });
            }

            function adjustGridHeight() {
                requestAnimationFrame(() => {
                    const detailsHeight = detailsPanel.offsetHeight;
                    gridContainer.style.height = `${detailsHeight}px`;

                    if (currentRange === 100) {
                        gridContainer.classList.add('overflow-y-auto');
                    } else {
                        gridContainer.classList.remove('overflow-y-auto');
                    }
                });
            }

            function renderGrid(range) {
                grid.innerHTML = '';
                const dataToShow = allNumbersData.slice(0, range);
                dataToShow.forEach(data => {
                    const card = document.createElement('div');
                    card.className = 'number-card bg-white p-2 rounded-lg shadow-md cursor-pointer flex items-center justify-center aspect-square';
                    card.textContent = data.number;
                    card.dataset.number = data.number;
                    card.addEventListener('click', () => {
                        updateDetails(data.number);
                    });
                    grid.appendChild(card);
                });
            }
            
            function createOrUpdateChart(range) {
                const dataToShow = allNumbersData.slice(0, range);
                const factorCounts = dataToShow.reduce((acc, data) => {
                    const count = data.factors.length;
                    acc[count] = (acc[count] || 0) + 1;
                    return acc;
                }, {});
                
                const labels = Object.keys(factorCounts).sort((a, b) => a - b);
                const data = labels.map(label => factorCounts[label]);

                const ctx = document.getElementById('factors-chart').getContext('2d');
                
                if(chartInstance) {
                    chartInstance.destroy();
                }

                chartInstance = new Chart(ctx, {
                    type: 'bar',
                    data: {
                        labels: labels,
                        datasets: [{
                            label: '共',
                            data: data,
                            backgroundColor: 'rgba(99, 102, 241, 0.6)',
                            borderColor: 'rgba(99, 102, 241, 1)',
                            borderWidth: 1
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        onClick: (event, elements) => {
                            if (elements.length > 0) {
                                const index = elements[0].index;
                                const targetFactorCount = parseInt(chartInstance.data.labels[index], 10);
                                
                                clearAllHighlights();

                                const dataToShow = allNumbersData.slice(0, currentRange);
                                dataToShow.forEach(data => {
                                    if (data.factors.length === targetFactorCount) {
                                        const card = document.querySelector(`.number-card[data-number='${data.number}']`);
                                        if (card) {
                                            card.classList.add('highlight-chart-selected');
                                        }
                                    }
                                });
                            }
                        },
                        scales: {
                            y: { 
                                beginAtZero: true,
                                ticks: {
                                    font: {
                                        size: 20
                                    }
                                }
                            },
                            x: {
                                ticks: {
                                    font: {
                                        size: 20
                                    }
                                }
                            }
                        },
                        plugins: { legend: { display: false } }
                    }
                });
            }

            function setRange(range) {
                currentRange = range;
                renderGrid(range);
                createOrUpdateChart(range);
                adjustGridHeight();
                chartRangeLabel.textContent = `1 ~ ${range}`;
                
                const currentSelected = parseInt(selectedNumberEl.textContent);
                if (currentSelected > range) {
                    updateDetails(1);
                } else {
                    updateDetails(currentSelected);
                }
            }

            rangeSelect.addEventListener('change', (e) => {
                setRange(parseInt(e.target.value));
            });
            
            const observer = new ResizeObserver(() => {
                adjustGridHeight();
            });
            observer.observe(detailsPanel);
            
            window.addEventListener('resize', adjustGridHeight);

            // Initial setup
            setRange(50);
            updateDetails(1);
        });
    </script>

</body>
</html>