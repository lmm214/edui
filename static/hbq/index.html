
<!doctype html>
<html lang="zh-CN">
<head>
	<meta charset="UTF-8">
	<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
	<meta name="viewport" content="width=device-width,initial-scale=1.0,user-scalable=no">
	<title>é»‘ç™½æ£‹å¤§æŒ‘æˆ˜</title>
<style type="text/css">
body {
	background-image: linear-gradient(45deg, #93a5cf 0%, #e4efe9 100%);
    font-family: "å¾®è½¯é›…é»‘", "è‹¹æ–¹", "PingFang SC", "Helvetica Neue", Arial, sans-serif;
	margin: 0;
	padding: 0;
	min-height: 100vh;
	overflow: hidden;
}
#desk {
	max-width: 1000px;
	margin: -4rem auto 0;
	padding: 0 20px;
	display: grid;
	grid-template-columns: 1fr auto;
	grid-template-rows: auto 1fr;
	gap: 0;
	align-items: center;
	justify-items: center;
	min-height: calc(100vh - 40px);
}
#title {
	max-width: 1000px;
	margin: 20px auto;
    text-align: center;
}
#interface {
	grid-column: 1;
	grid-row: 2;
}
#console {
	grid-column: 2;
	grid-row: 2;
	display: flex;
	flex-direction: column;
	gap: 15px;
	max-width: 200px;
	padding: 20px;
	background: rgba(102, 126, 234, 0.05);
	border-radius: 15px;
	border: 2px solid rgba(102, 126, 234, 0.1);
}
#console .cbox2, #console .cbox3{
	grid-column: 3;
	grid-row: 1;
	display: flex;
	flex-direction: column;
	gap: 5px;
}
#console .cbox2{grid-column: 2;}
h1 {
	margin: 0;
	color: #2c3e50;
	font-size: 2rem;
	line-height: 1.2;
	font-weight: 800;
	text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.1);
	letter-spacing: 2px;
}
h1 span {
	color: #fff;
}
h3 {
	margin: 5px 0;
	color: #34495e;
	font-size: 20px;
	line-height: 1.3;
	font-weight: 600;
	text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.1);
}

.button {
	margin: 5px;
	width: 120px;
	height: 50px;
	font-size: 16px;
	line-height: 50px;
	border: none;
	border-radius: 25px;
	box-shadow: 0 4px 15px rgba(102, 126, 234, 0.3);
	text-align: center;
	cursor: pointer;
	transition: all 0.3s ease;
	font-weight: 600;
	text-transform: uppercase;
	letter-spacing: 1px;
}
.button:hover {
	background-image: linear-gradient(120deg, #a6c0fe 0%, #f68084 100%);
	box-shadow: 0 6px 20px rgba(102, 126, 234, 0.4);
	transform: translateY(-2px);
}
.button:active {
	transform: translateY(0);
	box-shadow: 0 2px 10px rgba(102, 126, 234, 0.3);
}

.cbox {
	height: 60px;
	display: flex;
	align-items: center;
	justify-content: space-between;
	padding: 0 15px;
	transition: all 0.3s ease;
}
.side {
    border-radius: 15px;
	background: rgba(255, 255, 255, 0.4);
}
.cbox span {
	font-size: 24px;
	font-weight: bold;
	color: #2c3e50;
	text-shadow: none;
}

#interface {
	position: relative;
	width: 100%;
	max-width: 600px;
	height: auto;
	margin: 0 auto;
}

#chessboard {
	width: 100%;
	max-width: 600px;
	height: auto;
	aspect-ratio: 1;
	margin: 15px auto;
	border: 4px solid #34495e;
	background: #2c3e50;
	box-shadow: 0 15px 35px rgba(0, 0, 0, 0.2);
	border-radius: 15px;
	-webkit-transform: perspective(740px) rotateX(0deg);
	transform: perspective(740px) rotateX(0deg);
	-webkit-transition: -webkit-transform 1s;
	transition: transform 1s;
	overflow: hidden;
}
#chessboard table {
	background: #34495e;
	border-spacing: 2px;
	width: 100%;
	height: 100%;
}
#chessboard td {
	width: 12.5%;
	height: 12.5%;
    aspect-ratio: 1;
	position: relative;
	transition: all 0.2s ease;
	cursor: pointer;
}
#chessboard td:hover {
	background-color: rgba(102, 126, 234, 0.1) !important;
}

#chessboard td > div {
	width: 100%;
	height: 100%;
	display: flex;
	align-items: center;
	justify-content: center;
}
#chessboard .bg0 { background: #ffffff; }
#chessboard .bg1 { background: #e9f0e9; }

.black, .white {
	width: 70%;
	height: 70%;
	border-radius: 50%;
	margin: 0 auto;
	box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
	position: relative;
	max-width: 42px;
	max-height: 42px;
}
#console .black, #console .white {
	margin: 0 0 0 10px;
}
.fdd #chessboard {
	-webkit-transform: perspective(800px) rotateX(35deg);
	transform: perspective(800px) rotateX(35deg);
	box-shadow: 0 20px 40px rgba(0, 0, 0, 0.3);
}
.fdd td .black, .fdd td .white {
	margin: 6px auto 16px;
	box-shadow: 0 8px 16px rgba(0, 0, 0, 0.4);
}

.black {
	background: radial-gradient(circle at 30% 30%, #555, #000);
	-webkit-transform: rotateY(0deg);
	transform: rotateY(0deg);
}
.white {
	background: radial-gradient(circle at 30% 30%, #fff, #ddd);
	-webkit-transform: rotateY(180deg);
	transform: rotateY(180deg);
}
.reversal {
    -webkit-transition: -webkit-transform 600ms cubic-bezier(0.4, 0, 0.2, 1);
    transition: transform 600ms cubic-bezier(0.4, 0, 0.2, 1);
}
.newest:before, .reversal:before {
	content: "";
	display: block;
	width: 15%;
	height: 15%;
	aspect-ratio: 1;
	border-radius: 50%;
	position: absolute;
	top: 50%;
	left: 50%;
	transform: translate(-50%, -50%);
	z-index: 10;
	max-width: 8px;
	max-height: 8px;
}
.newest:before {
	background: #e74c3c;
	box-shadow: 0 0 8px #e74c3c;
}
.reversal:before {
	background: #3498db;
	box-shadow: 0 0 8px #3498db;
}
.prompt {
	width: 20%;
	height: 20%;
	border-radius: 50%;
	margin: auto;
	position: absolute;
	top: 50%;
	left: 50%;
	transform: translate(-50%, -50%);
	background: radial-gradient(circle, #f3d29e, #ecb359);
	max-width: 6px;
	max-height: 6px;
}

@keyframes pulse {
	0%, 100% { transform: scale(1); }
	50% { transform: scale(1.1); }
}

#selectbox {
	position: fixed;
	top: 50%;
	left: 50%;
	transform: translate(-50%, -50%);
	width: 90%;
	max-width: 380px;
	height: auto;
	background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
	border: none;
	border-radius: 25px;
	box-shadow: 0 25px 80px rgba(0, 0, 0, 0.4);
	padding: 0;
	font-size: 16px;
	line-height: 1.6;
	display: none;
	z-index: 1000;
	overflow: hidden;
}
#selectbox::before {
	content: '';
	position: fixed;
	top: 0;
	left: 0;
	width: 100%;
	height: 100%;
	background: rgba(0, 0, 0, 0.6);
	z-index: -1;
	backdrop-filter: blur(5px);
}
.selectbox-header {
	background: rgba(255, 255, 255, 0.95);
	padding: 25px 30px 20px;
	text-align: center;
	border-bottom: 1px solid rgba(255, 255, 255, 0.2);
}
.selectbox-content {
	padding: 25px 30px;
	background: rgba(255, 255, 255, 0.98);
}
.selectbox-section {
	margin-bottom: 25px;
}
.selectbox-section:last-of-type {
	margin-bottom: 0;
}
.section-title {
	font-size: 14px;
	font-weight: 600;
	color: #7f8c8d;
	margin-bottom: 15px;
	text-transform: uppercase;
	letter-spacing: 1px;
	border-bottom: 2px solid #ecf0f1;
	padding-bottom: 8px;
}
#selectbox input:checked + span {
	color: #667eea;
	font-weight: 600;
	text-shadow: none;
}
#selectbox label {
	display: flex;
	align-items: center;
	margin: 8px 0;
	cursor: pointer;
	transition: all 0.3s ease;
	padding: 12px 15px;
	border-radius: 12px;
	border: 2px solid transparent;
	background: rgba(102, 126, 234, 0.02);
}
#selectbox label:hover {
	background: rgba(102, 126, 234, 0.08);
	border-color: rgba(102, 126, 234, 0.2);
	transform: translateX(3px);
}
#selectbox input[type="radio"]:checked + span {
	color: #667eea;
}
#selectbox label:has(input:checked) {
	background: rgba(102, 126, 234, 0.15);
	border-color: #667eea;
	box-shadow: 0 4px 15px rgba(102, 126, 234, 0.2);
}
#selectbox input[type="radio"] {
	margin-right: 12px;
	transform: scale(1.3);
	accent-color: #667eea;
}

#buttons {
	margin: 30px 0 0;
	display: flex;
	justify-content: center;
	gap: 20px;
}
#copyright {
	text-align: center;
	color: #7f8c8d;
	padding: 20px;
	font-size: 14px;
	margin-top: 20px;
	border-top: 1px solid #ecf0f1;
}

#pass {
	position: absolute;
	top: 20px;
	left: 50%;
	transform: translateX(-50%);
	width: auto;
	min-width: 250px;
	height: auto;
	border-radius: 25px;
	text-align: center;
	font-size: 18px;
	line-height: 1.5;
	padding: 20px 30px;
	background: linear-gradient(135deg, #e74c3c, #c0392b);
	color: white;
	text-shadow: none;
	display: none;
	box-shadow: 0 12px 35px rgba(231, 76, 60, 0.4);
	font-weight: 700;
	border: 3px solid rgba(255, 255, 255, 0.3);
	z-index: 100;
}

/* è‡ªå®šä¹‰Alertç»„ä»¶æ ·å¼ */
#custom-alert {
	position: fixed;
	top: 0;
	left: 0;
	width: 100%;
	height: 100%;
	background: rgba(0, 0, 0, 0.6);
	z-index: 2;
	display: flex;
	align-items: center;
	justify-content: center;
	backdrop-filter: blur(5px);
}

.alert-content {
	background: white;
	border-radius: 20px;
	box-shadow: 0 25px 80px rgba(0, 0, 0, 0.3);
	max-width: 450px;
	width: 90%;
	max-height: 80vh;
	overflow: hidden;
	animation: alertSlideIn 0.3s ease-out;
}

@keyframes alertSlideIn {
	from {
		opacity: 0;
		transform: scale(0.8) translateY(-20px);
	}
	to {
		opacity: 1;
		transform: scale(1) translateY(0);
	}
}

.alert-header {
	background: linear-gradient(135deg, #667eea, #764ba2);
	color: white;
	padding: 25px 30px 20px;
	text-align: center;
	display: flex;
	flex-direction: column;
	align-items: center;
	gap: 10px;
}

.alert-icon {
	font-size: 48px;
	line-height: 1;
}

.alert-title {
	margin: 0;
	font-size: 22px;
	font-weight: 700;
	letter-spacing: 1px;
    color: #fff;
}

.alert-body {
	padding: 30px;
	text-align: center;
}

.alert-message {
	margin: 0;
	font-size: 2rem;
	line-height: 1.6;
	color: #2c3e50;
	white-space: pre-line;
}

.alert-footer {
	padding: 0 30px 30px;
	text-align: center;
}

.alert-button {
	background: linear-gradient(45deg, #667eea, #764ba2);
	color: white;
	border: none;
	padding: 12px 30px;
	border-radius: 25px;
	font-size: 16px;
	font-weight: 600;
	cursor: pointer;
	transition: all 0.3s ease;
	text-transform: uppercase;
	letter-spacing: 1px;
	min-width: 120px;
}

.alert-button:hover {
	background: linear-gradient(45deg, #764ba2, #667eea);
	transform: translateY(-2px);
	box-shadow: 0 8px 25px rgba(102, 126, 234, 0.3);
}

.alert-button:active {
	transform: translateY(0);
}

@media screen and (max-width: 768px) {
	#desk {
		margin: 10px auto;
		padding: 0px 15px;
		display: flex;
		flex-direction: column;
		align-items: center;
		gap: 0;
		min-width: 280px;
	}

	#title {
		order: 1;
	}

	#interface {
		order: 2;
		width: 100%;
		max-width: 280px;
	}

	#console {
		order: 3;
		max-width: none;
		width: 90%;
	}
	#console .cbox2{gap: 10px;display: grid;grid-column: 1;grid-template-columns: 1fr 1fr;}
	#console .cbox3{
		display: flex;
		flex-direction: row;
		grid-template-columns: 1fr 1fr 1fr;
		gap: 5px;
		grid-column: 1;
	}
	h1 {
		font-size: 28px;
	}
	h3 {
		font-size: 16px;
	}

	.button {
		width: 100%;
		height: 45px;
		line-height: 45px;
		font-size: 14px;
	}

	.cbox span {
		font-size: 20px;
	}

	#selectbox {
		padding: 10px;
		font-size: 16px;
	}
	.selectbox-header{padding:5px 15px;border-radius:15px 15px 0 0;}
	.selectbox-content{padding:5px 15px;border-radius:0 0 15px 15px ;}
	#chessboard {
		max-width: 100%;
		width: 100%;
	}
	.black, .white {
		max-width: 24px;
		max-height: 24px;
	}
	.prompt{max-width:4px;max-height:4px;}
}

@media screen and (max-height: 768px) {
	#desk {
		margin: 0 auto;
		min-height: auto;
		gap: 0;
	}

	#title {
		margin: 10px auto;
	}

	h1 {
		font-size: 1.5rem;
		margin: 0;
	}

	#interface {
		max-width: min(320px, 70vh);
	}

	#chessboard {
		max-width: min(320px, 60vh);
		width: min(100%, 60vh);
		margin: 10px auto;
	}

	#console {
		padding: 10px;
		gap: 10px;
	}

	.cbox {
		height: 45px;
		padding: 0 10px;
	}

	.cbox span {
		font-size: 18px;
	}

	.button {
		height: 40px;
		width: 80px;
		line-height: 40px;
		font-size: 14px;
	}

	.black, .white {
		max-width: 24px;
		max-height: 24px;
	}
}
@media screen and (max-width: 360px) {
	.black, .white {
		max-width: 18px;
		max-height: 18px;
	}
}
</style>
</head>
<body>
    <div id="title">
		<h1>é»‘<span>ç™½</span>æ£‹å¤§æŒ‘æˆ˜</h1>
	</div>
<div id="desk">
	<div id="interface">
		<div id="chessboard"></div>
		<div id="pass"></div>

		<div id="selectbox">
			<div class="selectbox-header">
				<h2 style="margin: 0; color: #2c3e50; font-size: 24px; font-weight: 700;">âš™ï¸ è®¾ç½®</h2>
			</div>
			
			<div class="selectbox-content">
				<div class="selectbox-section">
					<h3 style="margin: 0 0 10px 0; color: #34495e; font-size: 16px; font-weight: 600;">ğŸ® æ¸¸æˆæ¨¡å¼</h3>
					<label><input type="radio" name="gameMode" value="ai" checked="checked" onchange="toggleDifficultySection()"><span>ğŸ¤– äººæœºå¯¹æˆ˜ <small style="color: #95a5a6;">(ä¸AIå¯¹å¼ˆ)</small></span></label>
					<label><input type="radio" name="gameMode" value="human" onchange="toggleDifficultySection()"><span>ğŸ‘¥ äººäººå¯¹æˆ˜ <small style="color: #95a5a6;">(åŒäººæ¸¸æˆ)</small></span></label>
				</div>
				<div class="selectbox-section" id="difficulty-section">
					<h3 style="margin: 0 0 10px 0; color: #34495e; font-size: 16px; font-weight: 600;">âš¡ AIéš¾åº¦</h3>
					<label><input type="radio" name="level" checked="checked"><span>ğŸŸ¢ ç®€å•æ¨¡å¼ <small style="color: #95a5a6;">(æ–°æ‰‹æ¨è)</small></span></label>
					<label><input type="radio" name="level"><span>ğŸŸ¡ æ™®é€šæ¨¡å¼ <small style="color: #95a5a6;">(æœ‰ç‚¹æŒ‘æˆ˜)</small></span></label>
					<label><input type="radio" name="level"><span>ğŸ”´ å›°éš¾æ¨¡å¼ <small style="color: #95a5a6;">(é«˜æ‰‹å¯¹å†³)</small></span></label>
				</div>
				<div id="buttons">
					<div id="ok" class="button">ç¡®å®š</div>
				</div>
			</div>
		</div>

		<!-- è‡ªå®šä¹‰Alertç»„ä»¶ -->
		<div id="custom-alert" style="display: none;">
			<div class="alert-content">
				<div class="alert-header">
					<div class="alert-icon">ğŸ¯</div>
					<h3 class="alert-title">æ¸¸æˆæç¤º</h3>
				</div>
				<div class="alert-body">
					<p class="alert-message"></p>
				</div>
				<div class="alert-footer">
					<button class="alert-button" onclick="closeCustomAlert()">ç¡®å®š</button>
				</div>
			</div>
		</div>

	</div>
	<div id="console">
		<div class="cbox2">
			<div id="side1" class="cbox">
				<div class="black"></div>
				<span>0</span>
			</div>
			<div id="side2" class="cbox">
				<div class="white"></div>
				<span>0</span>
			</div>
		</div>
		<div class="cbox3">
			<div id="play" class="button">ğŸ® å¼€å§‹</div>
			<div id="setting" class="button">âš™ï¸ è®¾ç½®</div>
			<div id="back" class="button">â†©ï¸ æ’¤é”€</div>
		</div>
	</div>
</div>

<script>
var JSConfetti=function(){"use strict";function t(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function e(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function i(t,i,n){return i&&e(t.prototype,i),n&&e(t,n),t}function n(t){return+t.replace(/px/,"")}function s(t,e){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,n=Math.random()*(e-t)+t;return Math.floor(n*Math.pow(10,i))/Math.pow(10,i)}function o(t){return t[s(0,t.length)]}var a=["#fcf403","#62fc03","#f4fc03","#03e7fc","#03fca5","#a503fc","#fc03ad","#fc03c2"];function r(t){return Math.log(t)/Math.log(1920)}var h=function(){function e(i){t(this,e);var n=i.initialPosition,a=i.direction,h=i.confettiRadius,c=i.confettiColors,u=i.emojis,l=i.emojiSize,d=i.canvasWidth,f=s(.9,1.7,3)*r(d);this.confettiSpeed={x:f,y:f},this.finalConfettiSpeedX=s(.2,.6,3),this.rotationSpeed=u.length?.01:s(.03,.07,3)*r(d),this.dragForceCoefficient=s(5e-4,9e-4,6),this.radius={x:h,y:h},this.initialRadius=h,this.rotationAngle="left"===a?s(0,.2,3):s(-.2,0,3),this.emojiSize=l,this.emojiRotationAngle=s(0,2*Math.PI),this.radiusYUpdateDirection="down";var m="left"===a?s(82,15)*Math.PI/180:s(-15,-82)*Math.PI/180;this.absCos=Math.abs(Math.cos(m)),this.absSin=Math.abs(Math.sin(m));var v=s(-150,0),p={x:n.x+("left"===a?-v:v)*this.absCos,y:n.y-v*this.absSin};this.currentPosition=Object.assign({},p),this.initialPosition=Object.assign({},p),this.color=u.length?null:o(c),this.emoji=u.length?o(u):null,this.createdAt=(new Date).getTime(),this.direction=a}return i(e,[{key:"draw",value:function(t){var e=this.currentPosition,i=this.radius,n=this.color,s=this.emoji,o=this.rotationAngle,a=this.emojiRotationAngle,r=this.emojiSize,h=window.devicePixelRatio;n?(t.fillStyle=n,t.beginPath(),t.ellipse(e.x*h,e.y*h,i.x*h,i.y*h,o,0,2*Math.PI),t.fill()):s&&(t.font="".concat(r,"px serif"),t.save(),t.translate(h*e.x,h*e.y),t.rotate(a),t.textAlign="center",t.fillText(s,0,0),t.restore())}},{key:"updatePosition",value:function(t,e){var i=this.confettiSpeed,n=this.dragForceCoefficient,s=this.finalConfettiSpeedX,o=this.radiusYUpdateDirection,a=this.rotationSpeed,r=this.createdAt,h=this.direction,c=e-r;i.x>s&&(this.confettiSpeed.x-=n*t),this.currentPosition.x+=i.x*("left"===h?-this.absCos:this.absCos)*t,this.currentPosition.y=this.initialPosition.y-i.y*this.absSin*c+.00125*Math.pow(c,2)/2,this.rotationSpeed-=this.emoji?1e-4:1e-5*t,this.rotationSpeed<0&&(this.rotationSpeed=0),this.emoji?this.emojiRotationAngle+=this.rotationSpeed*t%(2*Math.PI):"down"===o?(this.radius.y-=t*a,this.radius.y<=0&&(this.radius.y=0,this.radiusYUpdateDirection="up")):(this.radius.y+=t*a,this.radius.y>=this.initialRadius&&(this.radius.y=this.initialRadius,this.radiusYUpdateDirection="down"))}},{key:"getIsVisibleOnCanvas",value:function(t){return this.currentPosition.y<t+100}}]),e}();function c(){var t=document.createElement("canvas");return t.style.position="fixed",t.style.width="100%",t.style.height="100%",t.style.top="0",t.style.left="0",t.style.zIndex="1000",t.style.pointerEvents="none",document.body.appendChild(t),t}function u(t){var e=t.confettiRadius,i=void 0===e?6:e,n=t.confettiNumber,s=void 0===n?t.confettiesNumber||(t.emojis?40:250):n,o=t.confettiColors,r=void 0===o?a:o,h=t.emojis,c=void 0===h?t.emojies||[]:h,u=t.emojiSize,l=void 0===u?80:u;return t.emojies&&console.error("emojies argument is deprecated, please use emojis instead"),t.confettiesNumber&&console.error("confettiesNumber argument is deprecated, please use confettiNumber instead"),{confettiRadius:i,confettiNumber:s,confettiColors:r,emojis:c,emojiSize:l}}var l=function(){function e(i){var n=this;t(this,e),this.canvasContext=i,this.shapes=[],this.promise=new Promise((function(t){return n.resolvePromise=t}))}return i(e,[{key:"getBatchCompletePromise",value:function(){return this.promise}},{key:"addShapes",value:function(){var t;(t=this.shapes).push.apply(t,arguments)}},{key:"complete",value:function(){var t;return!this.shapes.length&&(null===(t=this.resolvePromise)||void 0===t||t.call(this),!0)}},{key:"processShapes",value:function(t,e,i){var n=this,s=t.timeDelta,o=t.currentTime;this.shapes=this.shapes.filter((function(t){return t.updatePosition(s,o),t.draw(n.canvasContext),!i||t.getIsVisibleOnCanvas(e)}))}}]),e}();return function(){function e(){var i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};t(this,e),this.activeConfettiBatches=[],this.canvas=i.canvas||c(),this.canvasContext=this.canvas.getContext("2d"),this.requestAnimationFrameRequested=!1,this.lastUpdated=(new Date).getTime(),this.iterationIndex=0,this.loop=this.loop.bind(this),requestAnimationFrame(this.loop)}return i(e,[{key:"loop",value:function(){var t,e,i,s,o;this.requestAnimationFrameRequested=!1,t=this.canvas,e=window.devicePixelRatio,i=getComputedStyle(t),s=n(i.getPropertyValue("width")),o=n(i.getPropertyValue("height")),t.setAttribute("width",(s*e).toString()),t.setAttribute("height",(o*e).toString());var a=(new Date).getTime(),r=a-this.lastUpdated,h=this.canvas.offsetHeight,c=this.iterationIndex%10==0;this.activeConfettiBatches=this.activeConfettiBatches.filter((function(t){return t.processShapes({timeDelta:r,currentTime:a},h,c),!c||!t.complete()})),this.iterationIndex++,this.queueAnimationFrameIfNeeded(a)}},{key:"queueAnimationFrameIfNeeded",value:function(t){this.requestAnimationFrameRequested||this.activeConfettiBatches.length<1||(this.requestAnimationFrameRequested=!0,this.lastUpdated=t||(new Date).getTime(),requestAnimationFrame(this.loop))}},{key:"addConfetti",value:function(){for(var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=u(t),i=e.confettiRadius,n=e.confettiNumber,s=e.confettiColors,o=e.emojis,a=e.emojiSize,r=this.canvas.getBoundingClientRect(),c=r.width,d=r.height,f=5*d/7,m={x:0,y:f},v={x:c,y:f},p=new l(this.canvasContext),y=0;y<n/2;y++){var g=new h({initialPosition:m,direction:"right",confettiRadius:i,confettiColors:s,confettiNumber:n,emojis:o,emojiSize:a,canvasWidth:c}),C=new h({initialPosition:v,direction:"left",confettiRadius:i,confettiColors:s,confettiNumber:n,emojis:o,emojiSize:a,canvasWidth:c});p.addShapes(g,C)}return this.activeConfettiBatches.push(p),this.queueAnimationFrameIfNeeded(),p.getBatchCompletePromise()}},{key:"clearCanvas",value:function(){this.activeConfettiBatches=[]}},{key:"destroyCanvas",value:function(){this.canvas.remove()}}]),e}()}();
        const confetti = new JSConfetti();
        function showConfetti() {
            confetti.addConfetti({
                confettiNumber: 500
            })
        }
		
function Chessboard()
{
	var oo = this;

	var pieces;		//æ£‹å­å…ƒç´ 
	var piecesnum;	//é»‘ç™½å­æ•°ç›®æ˜¾ç¤ºå…ƒç´ 
	var side;	//è¡¨ç¤ºæ‰§æ£‹æ–¹å…ƒç´ 

	oo.toDown = null;	//ä¸‹å­

	function bindEvent(td)	//ç»‘å®šç‚¹å‡»äº‹ä»¶
	{
		for(var i=0; i<64; i++)
			(function (i){
				td[i].onclick = function (){
					if (pieces[i].className=="prompt")
						oo.toDown(i);
				}
			})(i);
		td = undefined;
	}

	oo.create = function ()		//åˆ›å»ºæ£‹ç›˜
	{
		var obj = document.getElementById("chessboard");
		var html = "<table>";
		for (var i=0; i<8; i++)
		{
			html += "<tr>";
			for (var j=0; j<8; j++)
				html += "<td class='bg"+(j+i)%2+"'><div></div></td>";
			html += "</tr>";
		}
		html += "</table>";
		obj.innerHTML = html;
		pieces = obj.getElementsByTagName("div");
		bindEvent(obj.getElementsByTagName("td"));

		piecesnum = document.getElementById("console").getElementsByTagName("span");
		side = {
			"1": document.getElementById("side1"),
			"-1": document.getElementById("side2")
		};
	}

	oo.update = function (m,nop)		//æ›´æ–°æ£‹ç›˜
	{
		for (var i=0; i<64; i++)
			pieces[i].className = ["white","","black"][m[i]+1];
		if (!nop)
			for (var n in m.next)
				pieces[n].className = "prompt";
		for (var i=0; i<m.newRev.length; i++)
			pieces[m.newRev[i]].className += " reversal";
		if (m.newPos!=-1)
			pieces[m.newPos].className += " newest";
		piecesnum[0].innerHTML = m.black;
		piecesnum[1].innerHTML = m.white;
		side[m.side].className = "cbox side";
		side[-m.side].className = "cbox";
	}
}


function AI(){
	var oo = this;

	oo.calculateTime = 1000;	//é™åˆ¶æ¯æ­¥æ£‹è®¡ç®—çš„æ—¶é—´
	oo.outcomeDepth = 14;		//ç»ˆå±€æœç´¢æ·±åº¦
	var outcomeCoarse = 15;		//ç»ˆå±€æœç´¢æ¨¡ç³Šæ¨¡å¼æœç´¢æ·±åº¦
	var maxDepth;
	var outTime;

	var weight = [6,11,2,2,3];  //æƒé‡

	var rnd = [			//ç”¨äºä¼°ä»·å‡½æ•°ä¸­è¾¹è§’çš„è®¡ç®—
		{s: 0,a: 1,b: 8,c: 9,dr:[1,8]},
		{s: 7,a: 6,b:15,c:14,dr:[-1,8]},
		{s:56,a:57,b:48,c:49,dr:[1,-8]},
		{s:63,a:62,b:55,c:54,dr:[-1,-8]}
	];

	oo.history = [[],[]];			//å†å²å¯å‘è¡¨
	for (var i=0; i<2; i++)
		for (var j=0; j<=60; j++)
			oo.history[i][j] = [0,63,7,56,37,26,20,43,19,29,34,44,21,42,45,18,2,61,23,40,5,58,47,16,10,53,22,41,13,46,17,50,51,52,12,11,30,38,25,33,4,3,59,60,39,31,24,32,1,62,15,48,8,55,6,57,9,54,14,49];

	var hash = new Transposition();

	function sgn(n)//ç¬¦å·å‡½æ•°ï¼Œè¦ç”¨æ—¶æ‰å‘ç°javascriptå±…ç„¶æ²¡æœ‰sgnå‡½æ•°ï¼ŒçœŸæ™•å•Š
	{
		return n>0?1:n<0?-1:0;
	}


	function evaluation(m)			//ä¼°ä»·å‡½æ•°
	{
		var corner = 0, steady = 0, uk = {};
		for (var i=0,v,l = rnd.length; v = rnd[i],i<l; i++)
		{
			if (m[v.s]==0)			//è§’ä¸ºç©ºæ ¼
			{
				corner += m[v.a] * -3;		//æ¬¡è¦å±é™©ç‚¹
				corner += m[v.b] * -3;		//æ¬¡è¦å±é™©ç‚¹
				corner += m[v.c] * -6;		//ä¸»è¦å±é™©ç‚¹
				continue;
			}
			corner += m[v.s] * 15;		//è§’ç‚¹
			steady += m[v.s];		//è§’ä¹Ÿæ˜¯ç¨³å®šå­
			for (var k = 0; k <2; k++)
			{
				if (uk[v.s+v.dr[k]])
					continue;
				var eb = true, tmp = 0;
				for (var j = 1; j <= 6; j++)
				{
					var t = m[v.s+v.dr[k]*j];
					if (t==0)
							break;
					else if (eb && t==m[v.s])
						steady += t;		//ç¨³å®šå­
					else
					{
						eb = false;
						tmp += t;		//ç¨³å®šå­
					}
				}
				if (j==7 && m[v.s+v.dr[k]*7]!=0)
				{
					steady += tmp;
					uk[v.s+v.dr[k]*6] = true;
				}
			}
		}

		var frontier = 0;		//å‰æ²¿å­
		for (var i=9; i<=54; i+=(i&7)==6?3:1)
		{
			if (m[i]==0)
				continue;
			for (var j=0; j<8; j++)
				if (m[othe.dire(i,j)]==0)
				{
					frontier -= m[i];
					break;
				}
		}

		var mobility = (m.nextNum-m.prevNum)*m.side;	//è¡ŒåŠ¨åŠ›(ç®€å•å§)

		var parity = m.space<18 ? (m.space%2==0?-m.side:m.side) : 0;	//å¥‡å¶æ€§


		var rv = corner*weight[0] + steady*weight[1] + frontier*weight[2] + mobility*weight[3] + parity*weight[4];
		return rv * m.side;
	}

	function outcome(m)		//ç»ˆå±€ç»“æœ
	{
		var s = m.black-m.white;
		if (maxDepth>=outcomeCoarse)
			return sgn(s)*10000*m.side;//ä¸ºäº†åŠ å¿«ç»ˆå±€æœç´¢é€Ÿåº¦åªç»™å‡ºè¾“èµ¢,æš‚ä¸è®°åˆ†,ä½¿æœç´¢æ›´å®¹æ˜“å‘ç”Ÿå‰ªæ.
		return (s+m.space*sgn(s))*10000*m.side;
	}

	oo.startSearch = function(m)		//å¼€å§‹æœç´¢åšå¼ˆæ ‘
	{
		// hash = new Transposition();
		// console.profile('æ€§èƒ½åˆ†æå™¨ä¸€');
		var f = 0;
		if (m.space<=oo.outcomeDepth)
		{
			//è¿›è¡Œç»ˆå±€æœç´¢
			outTime = (new Date()).getTime()+600000;		//ç»ˆå±€æœç´¢å°±ä¸é™æ—¶é—´äº†
			maxDepth = m.space;
			//console.time("è®¡æ—¶å™¨2");
			if (maxDepth>=outcomeCoarse)
				f = alphaBeta(m, maxDepth, -Infinity, Infinity);
			else
				f = mtd(m, maxDepth, f);
			//console.timeEnd("è®¡æ—¶å™¨2");
			console.log("ç»ˆå±€æœç´¢ç»“æœï¼š",maxDepth,m.space,m.side,f*m.side);
			return hash.getBest(m.key);
		}

		// æ–°æ‰‹æ¨¡å¼ï¼šå¦‚æœè®¾ç½®çš„æ·±åº¦ä¸º0ï¼Œåˆ™è¿›è¡Œéšæœºèµ°æ³•
		if (oo.outcomeDepth === 0) {
			if (m.nextIndex && m.nextIndex.length > 0) {
				var randomMove = m.nextIndex[Math.floor(Math.random() * m.nextIndex.length)];
				console.log("æ–°æ‰‹æ¨¡å¼éšæœºèµ°æ³•ï¼š", randomMove);
				return randomMove;
			}
		}

		outTime = (new Date()).getTime()+oo.calculateTime;
		maxDepth = 0;
		//console.time("è®¡æ—¶å™¨2");
		try {
			// å¦‚æœè®¾ç½®äº†å›ºå®šæ·±åº¦é™åˆ¶ï¼Œåˆ™åªæœç´¢åˆ°è¯¥æ·±åº¦
			var maxSearchDepth = (oo.outcomeDepth > 0 && oo.outcomeDepth < m.space) ? oo.outcomeDepth : m.space;
			while (maxDepth < maxSearchDepth)
			{
				f = mtd(m, ++maxDepth, f);
				// f = alphaBeta(m, ++maxDepth, -Infinity, Infinity);
				var best = hash.getBest(m.key);
				console.log(maxDepth,f*m.side,best);
				// å¦‚æœè¾¾åˆ°è®¾å®šçš„æ·±åº¦é™åˆ¶ï¼Œç«‹å³åœæ­¢
				if (oo.outcomeDepth > 0 && maxDepth >= oo.outcomeDepth) {
					break;
				}
			}
		} catch(eo){
			if (eo.message!="time out")		//ä¸æœ‰é™å®šè®¡ç®—æ—¶é—´çš„å¼‚å¸¸
				throw eo;					//æŠŠå¼‚å¸¸è½¬æŠ›ç»™æµè§ˆå™¨
		}
		//console.timeEnd("è®¡æ—¶å™¨2");
		// console.profileEnd();
		console.log("æœç´¢ç»“æœï¼š",maxDepth-1,m.space,m.side,f*m.side);
		return best;
	}

	function mtd(m,depth,f)		//MTD(f)ç®—æ³•
	{
		var lower = -Infinity;
		var upper = Infinity;
		do {
			var beta = (f==lower) ? f+1 : f;	// ç¡®å®šè¯•æ¢å€¼
			f = alphaBeta(m, depth, beta-1, beta);	// è¿›è¡Œé›¶å®½çª—å£è¯•æ¢
			if (f < beta)
				upper = f;
			else
				lower = f;
		} while (lower < upper);
		if (f < beta)	// å¦‚æœæœ€åä¸€æ¬¡æœç´¢å¾—åˆ°çš„åªæ˜¯ä¸Šé™ï¼Œéœ€å†æœç´¢ä¸€æ¬¡ï¼Œç¡®ä¿è·å¾—æ­£ç¡®çš„æœ€ä½³æ£‹æ­¥
			f = alphaBeta(m, depth, f-1, f);
		return f;
	}

	function alphaBeta(m,depth,alpha,beta)		//Alpha-betaå‰ªæ
	{
		if ((new Date()).getTime() > outTime)		//åˆ¤æ–­æ˜¯å¦åˆ°è¾¾é™å®šçš„è®¡ç®—æ—¶é—´
			throw new Error("time out");		//ç”¨æŠ›å‡ºå¼‚å¸¸æ–¹å¼ç›´æ¥ä»æ·±å±‚æœç´¢ä¸­è·³å‡ºæ¥

		var hv = hash.get(m.key,depth,alpha,beta);
		if (hv !== false)
			return hv;

		if (m.space==0)			//æ£‹ç›˜å­æ»¡
			return outcome(m);	//ç›´æ¥è¿”å›ç»ˆå±€ç»“æœ
		othe.findLocation(m);
		if (m.nextNum==0)		//åˆ¤æ–­æ— æ£‹å¯èµ°
		{
			if (m.prevNum==0)		//åˆ¤æ–­ä¸Šä¸€æ­¥ä¹Ÿæ˜¯æ— æ£‹å¯èµ°
				return outcome(m);		//ç›´æ¥è¿”å›ç»ˆå±€ç»“æœ
			othe.pass(m);
			return -alphaBeta(m, depth, -beta, -alpha);
		}
		if (depth<=0)			//æœç´¢æ·±åº¦åˆ°è¾¾è®¾ç½®çš„æé™
		{
			var e = evaluation(m);
			hash.set(m.key,e,depth,0,null);
			return e;
		}

		var hd = hash.getBest(m.key);
		if (hd!==null)
			moveToHead(m.nextIndex,hd);

		var hist = oo.history[m.side==1?0:1][m.space];
		var hashf = 1;				//æœ€ä½³ä¼°å€¼ç±»å‹, 0ä¸ºç²¾ç¡®å€¼, 1ä¸º<=alpha, 2ä¸º>=beta
		var bestVal = -Infinity;		//è®°å½•æœ€ä½³ä¼°å€¼
		var bestAct = null;				//è®°å½•æœ€ä½³æ£‹æ­¥
		for (var i=0; i<m.nextNum; i++)
		{
			var n = m.nextIndex[i];
			var v = -alphaBeta(othe.newMap(m,n), depth-1, -beta, -alpha);
			if (v > bestVal)
			{
				bestVal = v;
				bestAct = n;
				if (v > alpha)
				{
					alpha = v;
					hashf = 0;
					moveToUp(hist,n);
				}
				if (v >= beta)
				{
					hashf = 2;
					break;		//å‘ç”Ÿå‰ªæ
				}
			}
		}
		moveToHead(hist,bestAct);
		hash.set(m.key,bestVal,depth,hashf,bestAct);
		return bestVal;
	}

	function moveToHead(arr,n)
	{
		if (arr[0]==n)
			return;
		var i = arr.indexOf(n);
		arr.splice(i,1);
		arr.unshift(n);
	}

	function moveToUp(arr,n)
	{
		if (arr[0]==n)
			return;
		var i = arr.indexOf(n);
		arr[i] = arr[i-1];
		arr[i-1] = n;
	}

}




function Transposition()
{
	var oo = this;

	var HASH_SIZE = (1 << 19) -1;		//ç½®æ¢å•å…ƒæ•°ä¸º 524287
	var data = new Array(HASH_SIZE+1);

	oo.set = function (key,eva,depth,flags,best)
	{
		var keyb = key[0]&HASH_SIZE;
		var phashe = data[keyb];
		if (!phashe)
			phashe = data[keyb] = {};
		else if (phashe.key == key[1] && phashe.depth > depth)		//å±€é¢ç›¸åŒ å¹¶ä¸” è®°å½•æ¯”å½“å‰æ›´æ·± åˆ™ä¸æ›¿æ¢
			return;
		phashe.key = key[1];
		phashe.eva = eva;
		phashe.depth = depth;
		phashe.flags = flags;
		phashe.best = best;
	}

	oo.get = function (key,depth,alpha,beta)
	{
		var phashe = data[key[0]&HASH_SIZE];
		if ((!phashe) || phashe.key != key[1] || phashe.depth < depth)
			return false;
		switch (phashe.flags)
		{
			case 0:
				return phashe.eva;
			case 1:
				if (phashe.eva <= alpha)
					return phashe.eva;
				return false;
			case 2:
				if (phashe.eva >= beta)
					return phashe.eva;
				return false;
		}
	}

	oo.getBest = function (key)
	{
		var phashe = data[key[0]&HASH_SIZE];
		if ((!phashe) || phashe.key != key[1])
			return null;
		return phashe.best;
	}


}


function Zobrist()
{
	var oo = this;

	var swapSide = [rnd(),rnd()];// ä¸‹æ£‹æ–¹è½®æ¢çš„é™„åŠ æ•£åˆ—ç 
	var zarr = [[],[],[]];
	for (var pn=0; pn<64; pn++)
	{
		zarr[0][pn] = [rnd(),rnd()];// å„ä½ç½®ä¸Šå‡ºç°é»‘æ£‹æ—¶
		zarr[1][pn] = [rnd(),rnd()];// å„ä½ç½®ä¸Šå‡ºç°ç™½æ£‹æ—¶
		zarr[2][pn] = [zarr[0][pn][0]^zarr[1][pn][0], zarr[0][pn][1]^zarr[1][pn][1]];// å„ä½ç½®ä¸Šç¿»æ£‹æ—¶
	}

	function rnd()		//è·å–32ä½çš„éšæœºæ•°
	{
		return (Math.random()*0x100000000)>>0;
	}

	oo.swap = function (key)		//æ‰§æ£‹æ–¹è½®æ¢
	{
		key[0] ^= swapSide[0];
		key[1] ^= swapSide[1];
	}

	oo.set = function (key,pc,pn)	//è®¾ç½®æ›´æ–°key
	{
		key[0] ^= zarr[pc][pn][0];
		key[1] ^= zarr[pc][pn][1];
	}
}



function Othello()
{
	var oo = this;

	var map = [];			//æ£‹å±€æ•°ç»„
	var history = [];		//å†å²è®°å½•,ç”¨äºæ‚”æ£‹æ“ä½œ

	var zobrist = new Zobrist();

	oo.aiSide = 0;	//1: ç”µè„‘ä¸ºé»‘æ£‹,  -1: ç”µè„‘ä¸ºç™½æ£‹,  0: åŒäººå¯¹æˆ˜ 2: ç”µè„‘è‡ªå·±å¯¹æˆ˜


	var passObj = document.getElementById("pass");
	var timer;		//å®šæ—¶å™¨id
	var passTimer;	//passæç¤ºè®¡æ—¶å™¨

	oo.play = function ()	//å¼€å§‹æ–°æ£‹å±€
	{
		// æ¸…é™¤æ‰€æœ‰è®¡æ—¶å™¨
		clearTimeout(timer);
		if (passTimer) {
			clearTimeout(passTimer);
			passTimer = null;
		}
		console.clear();
		map = [];
		for (var i=0; i<64; i++)
			map[i] = 0;					//ç©ºæ ¼ä¸º 0
		map[28] = map[35] = 1;			//é»‘å­ä¸º 1
		map[27] = map[36] = -1;			//ç™½å­ä¸º -1
		map.black = map.white = 2;		//é»‘ç™½æ£‹å­æ•°ç›®
		map.space = 60;		//ç©ºæ ¼æ•°ç›®
		map.frontier = [];	//å‘¨å›´æœ‰æ£‹å­çš„ç©ºæ ¼ï¼Œç”¨äºåŠ é€ŸæŸ¥æ‰¾å¯ä¸‹æ£‹æ­¥
		var tk = [18,19,20,21,26,29,34,37,42,43,44,45];
		for (var i=0; i<12; i++)
			map.frontier[tk[i]] = true;
		map.side = 1;		//å½“å‰æ‰§æ£‹æ–¹
		map.newPos = -1;	//æœ€æ–°ä¸‹å­çš„ä½ç½®
		map.newRev = [];	//æœ€æ–°åè½¬æ£‹å­çš„ä½ç½®
		map.nextIndex = [];	//ä¸‹ä¸€æ­¥å¯èµ°æ£‹çš„ä½ç½®
		map.next = {};		//ä¸‹ä¸€æ­¥å¯èµ°æ£‹çš„åè½¬æ£‹å­
		map.nextNum = 0;	//ä¸‹ä¸€æ­¥å¯èµ°æ£‹çš„æ•°ç›®
		map.prevNum = 0;	//ä¸Šä¸€æ­¥å¯èµ°æ£‹çš„æ•°ç›®
		map.key = [0,0];	//ç”¨äºç½®æ¢è¡¨çš„é”®å€¼
		history = [];
		update();
	}

	function update()	//
	{
		var aiAuto = oo.aiSide==map.side || oo.aiSide==2;
		oo.findLocation(map);
		
		// å…ˆæ¸…é™¤passçŠ¶æ€ï¼Œé¿å…ä¸æ–°çš„timerå†²çª
		setPassStatus(false);
		board.update(map, false); // æ€»æ˜¯æ˜¾ç¤ºå¯ä¸‹æ£‹çš„æç¤ºç‚¹

		if (map.space==0 || map.nextNum==0 && map.prevNum==0)		//æ£‹ç›˜å­æ»¡ æˆ– åŒæ–¹éƒ½æ— æ£‹å¯èµ°
		{
			// æ¸…é™¤æ‰€æœ‰è®¡æ—¶å™¨ï¼Œé¿å…å†²çª
			clearTimeout(timer);
			timer = setTimeout(gameOver, 450);
			return;
		}
		if (map.nextNum==0)	//æ— æ£‹å¯èµ°pass
		{
			// æ¸…é™¤ä¹‹å‰çš„timerï¼Œé¿å…å†²çª
			clearTimeout(timer);
			timer = setTimeout(function() {

                oo.pass(map);
				// å…ˆæ˜¾ç¤ºpassæç¤º
				setPassStatus(true);
				// å»¶è¿Ÿæ›´æ–°ï¼Œç¡®ä¿passæç¤ºæ˜¾ç¤ºå®Œæ•´çš„3ç§’
				timer = setTimeout(function() {
					update();
				}, 2000); // ç»™passæç¤ºç•™å‡ºå®Œæ•´çš„3ç§’æ˜¾ç¤ºæ—¶é—´
			}, 450);
			return;
		}
		if (aiAuto)
		{
			// AIå³å°†ä¸‹æ£‹æ—¶ï¼Œéšè—æç¤ºç‚¹é¿å…å¹²æ‰°
			board.update(map, true);
			// æ¸…é™¤ä¹‹å‰çš„timerï¼Œé¿å…å†²çª
			clearTimeout(timer);
			// è®©æœºå™¨ç­‰å¾…500msåå†ä¸‹æ£‹
			timer = setTimeout(aiRun, 800);
		}
	}

	function aiRun()		//ç”µè„‘èµ°æ£‹
	{
		try {
			// æ£€æŸ¥æ˜¯å¦æœ‰å¯èµ°çš„æ£‹
			if (map.nextNum == 0) {
				console.log('AIæ— æ£‹å¯èµ°ï¼Œåº”è¯¥ç”±updateå‡½æ•°å¤„ç†passé€»è¾‘');
				return;
			}
			
			// ç¡®ä¿nextIndexæ•°ç»„æœ‰æ•ˆ
			if (!map.nextIndex || map.nextIndex.length == 0) {
				console.error('AI: nextIndexæ•°ç»„ä¸ºç©º');
				return;
			}
			
			var moveIndex;
			if (map.nextNum == 1) {
				// åªæœ‰ä¸€æ­¥æ£‹å¯èµ°
				moveIndex = map.nextIndex[0];
			} else if (map.space <= 58) {
				// ä½¿ç”¨AIæœç´¢
				moveIndex = ai.startSearch(map);
			} else {
				// å¼€å±€é˜¶æ®µéšæœºé€‰æ‹©
				moveIndex = map.nextIndex[Math.floor(Math.random() * map.nextIndex.length)];
			}
			
			// éªŒè¯é€‰æ‹©çš„ä½ç½®æ˜¯å¦æœ‰æ•ˆ
			if (moveIndex >= 0 && moveIndex < 64 && map.nextIndex.indexOf(moveIndex) !== -1) {
				oo.go(moveIndex);
			} else {
				console.error('AIé€‰æ‹©äº†æ— æ•ˆä½ç½®:', moveIndex);
				// fallbackï¼šé€‰æ‹©ç¬¬ä¸€ä¸ªå¯ç”¨ä½ç½®
				if (map.nextIndex.length > 0) {
					oo.go(map.nextIndex[0]);
				}
			}
		} catch(error) {
			console.error('AIè¿è¡Œé”™è¯¯:', error);
			// é”™è¯¯å¤„ç†ï¼šé€‰æ‹©ç¬¬ä¸€ä¸ªå¯ç”¨ä½ç½®
			if (map.nextIndex && map.nextIndex.length > 0) {
				oo.go(map.nextIndex[0]);
			}
		}
	}
	// document.getElementById("ai").onclick = aiRun;

	function gameOver()
	{
		// æ¸…é™¤æ‰€æœ‰è®¡æ—¶å™¨
		if (passTimer) {
			clearTimeout(passTimer);
			passTimer = null;
		}
		setPassStatus(false);
		
		// ä¼˜åŒ–æ¸¸æˆç»“æŸæç¤ºï¼Œæ›´é€‚åˆå°å­¦ç”Ÿ
		var result = "";
		var icon = "";
		if (map.black == map.white) {
			result = "ğŸ¤ å¹³å±€ï¼çœŸæ˜¯åŠ¿å‡åŠ›æ•Œçš„å¯¹å†³ï¼\n\nâš« é»‘æ£‹: "+map.black+" ä¸ª\nâšª ç™½æ£‹: "+map.white+" ä¸ª";
			icon = "âš–ï¸";
		} else if (map.black > map.white) {
			if (othe.aiSide == 1) {
				result = "ğŸ¤– ç”µè„‘è·èƒœï¼å†æ¥å†å‰å“¦ï¼\n\nâš« é»‘æ£‹: "+map.black+" ä¸ª\nâšª ç™½æ£‹: "+map.white+" ä¸ª";
				icon = "ğŸ¤–";
			} else {
				showConfetti()
				result = "ğŸ‰ æ­å–œä½ è·èƒœï¼å¤ªæ£’äº†ï¼\n\nâš« é»‘æ£‹: "+map.black+" ä¸ª\nâšª ç™½æ£‹: "+map.white+" ä¸ª";
				icon = "ğŸ†";
			}
		} else {
			if (othe.aiSide == -1) {
				result = "ğŸ¤– ç”µè„‘è·èƒœï¼å†æ¥å†å‰å“¦ï¼\n\nâš« é»‘æ£‹: "+map.black+" ä¸ª\nâšª ç™½æ£‹: "+map.white+" ä¸ª";
				icon = "ğŸ¤–";
			} else {
				showConfetti()
				result = "ğŸ‰ æ­å–œä½ è·èƒœï¼å¤ªæ£’äº†ï¼\n\nâš« é»‘æ£‹: "+map.black+" ä¸ª\nâšª ç™½æ£‹: "+map.white+" ä¸ª";
				icon = "ğŸ†";
			}
		}
		
		showCustomAlert(result, icon, "æ¸¸æˆç»“æŸ");
	}

	oo.dire = (function(){				//è·å–æŸä¸€æ£‹ç›˜æ ¼æŸä¸€æ–¹å‘çš„æ ¼å­.è¶…è¿‡è¾¹ç•Œè¿”å›64
		var dr = [-8,-7,1,9,8,7,-1,-9];
		var bk = [8,0,0,0,8,7,7,7];
		return function(i,d)
		{
			i += dr[d];
			return (i&64)!=0 || (i&7)==bk[d] ? 64 : i;
		}
	})();

	oo.findLocation = function (m)		//æŸ¥æ‰¾å¯èµ°æ£‹çš„ä½ç½®
	{
		function is(i,j)
		{
			var lk = 0;
			while ((i=oo.dire(i,j))!=64 && m[i]==-m.side)
			{
				ta[la++] = i;
				lk++;
			}
			if(i==64 || m[i]!=m.side)
				la -= lk;
		}
		
		// é‡ç½®å¯èµ°æ£‹ä½ç½®
		m.nextIndex = [];
		m.next = {};
		
		var hist = ai.history[m.side==1?0:1][m.space];
		for(var i=0; i<60; i++)
		{
			var fi = hist[i];
			// æ£€æŸ¥ä½ç½®æ˜¯å¦åœ¨è¾¹ç•Œå†…ã€æ˜¯å¦ä¸ºç©ºã€æ˜¯å¦åœ¨å‰æ²¿
			if (fi < 0 || fi >= 64 || !m.frontier[fi] || m[fi] !== 0)
				continue;
				
			var ta = [], la = 0;
			for (var j=0; j<8; j++)
				is(fi,j);
				
			if (la > 0)
			{
				// ç¡®ä¿æ•°ç»„é•¿åº¦æ­£ç¡®
				if (la != ta.length)
			 		ta = ta.slice(0, la);
				m.next[fi] = ta;
				m.nextIndex.push(fi);
			}
		}
		m.nextNum = m.nextIndex.length;
	}

	oo.pass = function(m)			//ä¸€æ–¹æ— æ£‹å¯èµ°
	{
		m.side = -m.side;
		m.prevNum = m.nextNum;
		zobrist.swap(m.key);
	}

	oo.newMap = function(m,n)			//è¿”å›æ–°çš„æ£‹å±€
	{
		var nm = m.slice(0);		//å¤åˆ¶æ•°ç»„
		nm[n] = m.side;				//æŠŠæ–°ä¸‹çš„æ£‹å­æ”¾åˆ°æ£‹ç›˜ä¸Š

		nm.key = m.key.slice(0);		//å¤åˆ¶æ•°ç»„
		zobrist.set(nm.key,m.side==1?0:1,n);

		nm.frontier = m.frontier.slice(0);		//å¤åˆ¶æ•°ç»„
		nm.frontier[n] = false;
		for (var i=0; i<8; i++)
		{
			var k = oo.dire(n,i);
			if (k!=64 && nm[k]==0)
				nm.frontier[k] = true;
		}

		var ne = m.next[n];
		var l = ne.length;
		for(var i=0; i<l; i++)
		{
			nm[ne[i]] = m.side;		//åè½¬çš„æ£‹å­
			zobrist.set(nm.key,2,ne[i]);
		}
		// ä¿®å¤è®¡æ•°é€»è¾‘ï¼šç¡®ä¿è®¡æ•°æ­£ç¡®
		if (m.side == 1) {
			// é»‘æ£‹ä¸‹å­ï¼šé»‘æ£‹æ•°é‡å¢åŠ ï¼ˆæ–°ä¸‹çš„1ä¸ª + ç¿»è½¬çš„lä¸ªï¼‰ï¼Œç™½æ£‹æ•°é‡å‡å°‘ï¼ˆç¿»è½¬çš„lä¸ªï¼‰
			nm.black = m.black + l + 1;
			nm.white = m.white - l;
		} else {
			// ç™½æ£‹ä¸‹å­ï¼šç™½æ£‹æ•°é‡å¢åŠ ï¼ˆæ–°ä¸‹çš„1ä¸ª + ç¿»è½¬çš„lä¸ªï¼‰ï¼Œé»‘æ£‹æ•°é‡å‡å°‘ï¼ˆç¿»è½¬çš„lä¸ªï¼‰
			nm.white = m.white + l + 1;
			nm.black = m.black - l;
		}
		
		// ç¡®ä¿è®¡æ•°ä¸ä¼šå‡ºç°è´Ÿæ•°æˆ–è¶…å‡ºèŒƒå›´
		nm.black = Math.max(0, Math.min(64, nm.black));
		nm.white = Math.max(0, Math.min(64, nm.white));
		nm.space = 64 - nm.black - nm.white;		//ç©ºæ ¼æ•°ç›®
		nm.side = -m.side;
		nm.prevNum = m.nextNum;
		zobrist.swap(nm.key);
		return nm;
	}


	oo.goChess = function (n)	//èµ°æ£‹
	{
		history.push(map);
		oo.go(n);
	}

	oo.go = function (n)	//èµ°æ£‹
	{

		var rev = map.next[n];
		map = oo.newMap(map,n);
		map.newRev = rev;
		map.newPos = n;
		// console.log(map.key);
		update();
	}

	oo.historyBack = function ()
	{
		if (history.length==0)
			return;
		
		// æ¸…é™¤æ‰€æœ‰è®¡æ—¶å™¨ï¼ŒåŒ…æ‹¬passæç¤ºè®¡æ—¶å™¨
		clearTimeout(timer);
		if (passTimer) {
			clearTimeout(passTimer);
			passTimer = null;
		}
		setPassStatus(false);
		
		// ä¼˜åŒ–ï¼šå¦‚æœæ˜¯äººæœºå¯¹æˆ˜ï¼Œæ‚”æ£‹æ—¶åº”è¯¥é€€å›ä¸¤æ­¥ï¼ˆç©å®¶å’ŒAIå„ä¸€æ­¥ï¼‰
		if (othe.aiSide !== 0 && history.length >= 2) {
			history.pop(); // é€€å›AIçš„ä¸€æ­¥
			if (history.length > 0) {
				map = history.pop(); // é€€å›ç©å®¶çš„ä¸€æ­¥
			} else {
				// å¦‚æœå†å²è®°å½•ä¸å¤Ÿï¼Œé‡æ–°å¼€å§‹æ¸¸æˆ
				othe.play();
				return;
			}
		} else {
			map = history.pop();
		}
		update();
	}



	function setPassStatus(t)		//è®¾ç½®passçŠ¶æ€
	{
		// åªæœ‰åœ¨éœ€è¦éšè—æ—¶æ‰æ¸…é™¤è®¡æ—¶å™¨ï¼Œé¿å…æ‰“æ–­æ­£åœ¨æ˜¾ç¤ºçš„æç¤º
		if (!t && passTimer) {
			clearTimeout(passTimer);
			passTimer = null;
			passObj.style.display = "none";
			return;
		}
		
		if(t) {
			// å¦‚æœå·²ç»åœ¨æ˜¾ç¤ºpassæç¤ºï¼Œä¸è¦é‡å¤è®¾ç½®
			if (passTimer) {
				return;
			}
			
			// æ›´å‹å¥½çš„æç¤ºä¿¡æ¯
			if (map.side == 1) {
				passObj.innerHTML = "âšª æ— ä½ç½®ï¼Œâš« ç»§ç»­ï¼";
			} else {
				passObj.innerHTML = "âš« æ— ä½ç½®ï¼Œâšª ç»§ç»­ï¼";
			}
			
			passObj.style.display = "block";
			
			// æ˜¾ç¤º3ç§’ï¼Œæ—¶é—´é€‚ä¸­ä¸ä¼šå¤ªé•¿
			passTimer = setTimeout(function() {
				passObj.style.display = "none";
				passTimer = null;
			}, 3000);
		}
	}

}


var board = new Chessboard();
var ai = new AI();
var othe = new Othello();

// æœ¬åœ°å­˜å‚¨ç®¡ç†
var StorageManager = {
	key: 'heibai_game_settings',
	
	// ä¿å­˜è®¾ç½®
	save: function(settings) {
		try {
			localStorage.setItem(this.key, JSON.stringify(settings));
		} catch(e) {
			console.log('æœ¬åœ°å­˜å‚¨å¤±è´¥:', e);
		}
	},
	
	// åŠ è½½è®¾ç½®
	load: function() {
		try {
			var data = localStorage.getItem(this.key);
			return data ? JSON.parse(data) : null;
		} catch(e) {
			console.log('æœ¬åœ°å­˜å‚¨è¯»å–å¤±è´¥:', e);
			return null;
		}
	}
};

// æ¸¸æˆçŠ¶æ€ç®¡ç†
var GameManager = {
	gameStarted: false,
	defaultSettings: {
		difficulty: 0,  // é»˜è®¤æœ€ç®€å•éš¾åº¦
		gameMode: 'ai'  // é»˜è®¤äººæœºå¯¹æˆ˜æ¨¡å¼
	},
	
	// éš¾åº¦é…ç½®
	difficulties: [
		{ time: 10, depth: 0, name: 'æ–°æ‰‹' },
		{ time: 10, depth: 1, name: 'æ™®é€š' },
		{ time: 10, depth: 3, name: 'å›°éš¾' }
	],
	
	// ç»Ÿä¸€çš„äº‹ä»¶å¤„ç†å™¨
	handlers: {
		play: function() {
			// å¦‚æœæ¸¸æˆå·²ç»å¼€å§‹ï¼Œåˆ™é‡æ–°å¼€å§‹æ¸¸æˆ
			if (GameManager.gameStarted) {
				// åŠ è½½å¹¶åº”ç”¨ä¿å­˜çš„è®¾ç½®
				GameManager.loadSettings();
				GameManager.startQuickGame();
			} else {
				// é¦–æ¬¡å¼€å§‹æ¸¸æˆï¼Œç›´æ¥å¼€å§‹
				GameManager.startQuickGame();
			}
		},
		
		setting: function() {
			// æ˜¾ç¤ºè®¾ç½®ç•Œé¢
			GameManager.loadSettings();
			document.getElementById("selectbox").style.display = "block";
		},
		
		back: function() {
			othe.historyBack();
		},
		
		ok: function() {
			document.getElementById("selectbox").style.display = "none";
			var inputs = document.getElementById("selectbox").getElementsByTagName("input");
			
			// è·å–é€‰ä¸­çš„æ¸¸æˆæ¨¡å¼
			var gameMode = 'ai';
			var gameModeInputs = document.querySelectorAll('input[name="gameMode"]');
			for (var i = 0; i < gameModeInputs.length; i++) {
				if (gameModeInputs[i].checked) {
					gameMode = gameModeInputs[i].value;
					break;
				}
			}
			
			// è·å–é€‰ä¸­çš„éš¾åº¦
			var difficultyIndex = 0;
			var levelInputs = document.querySelectorAll('input[name="level"]');
			for (var i = 0; i < levelInputs.length; i++) {
				if (levelInputs[i].checked) {
					difficultyIndex = i;
					break;
				}
			}
			
			// ä¿å­˜ç”¨æˆ·è®¾ç½®
			var settings = {
				difficulty: difficultyIndex,
				gameMode: gameMode
			};
			StorageManager.save(settings);
			
			// æ ¹æ®æ¸¸æˆæ¨¡å¼è®¾ç½®AI
			if (gameMode === 'ai') {
				// äººæœºå¯¹æˆ˜æ¨¡å¼ï¼šç”¨æˆ·å…ˆä¸‹ï¼ˆAIä¸ºç™½æ£‹ï¼‰
				othe.aiSide = -1;
				var difficulty = GameManager.difficulties[difficultyIndex] || GameManager.difficulties[0];
				ai.calculateTime = difficulty.time;
				ai.outcomeDepth = difficulty.depth;
			} else {
				// äººäººå¯¹æˆ˜æ¨¡å¼ï¼šç¦ç”¨AI
				othe.aiSide = 0;
			}
			
			GameManager.gameStarted = true;
			othe.play();
			
			// æ›´æ–°æŒ‰é’®æ–‡æœ¬
			GameManager.updatePlayButton();
		},

		chessboardClick: function(e) {
			// å¦‚æœæ¸¸æˆè¿˜æ²¡å¼€å§‹ï¼Œåˆ™å¿«é€Ÿå¼€å§‹æ¸¸æˆ
			if (!GameManager.gameStarted) {
				GameManager.startQuickGame();
			}
		}
	},
	
	// åŠ è½½ä¿å­˜çš„è®¾ç½®
	loadSettings: function() {
		var settings = StorageManager.load() || this.defaultSettings;
		
		// åº”ç”¨è®¾ç½®åˆ°ç•Œé¢
		var selectbox = document.getElementById("selectbox");
		if (selectbox) {
			// è®¾ç½®æ¸¸æˆæ¨¡å¼é€‰æ‹©
			var gameModeInputs = document.querySelectorAll('input[name="gameMode"]');
			for (var i = 0; i < gameModeInputs.length; i++) {
				gameModeInputs[i].checked = gameModeInputs[i].value === settings.gameMode;
			}
			
			// è®¾ç½®éš¾åº¦é€‰æ‹©
			var levelInputs = document.querySelectorAll('input[name="level"]');
			for (var i = 0; i < levelInputs.length; i++) {
				levelInputs[i].checked = i === settings.difficulty;
			}
			
			// æ›´æ–°AIéš¾åº¦é€‰é¡¹çš„æ˜¾ç¤ºçŠ¶æ€
			toggleDifficultySection();
		}
	},
	
	// å¿«é€Ÿå¼€å§‹æ¸¸æˆ
	startQuickGame: function() {
		this.gameStarted = true;
		
		// ä½¿ç”¨ä¿å­˜çš„è®¾ç½®æˆ–é»˜è®¤è®¾ç½®
		var settings = StorageManager.load() || this.defaultSettings;
		
		// æ ¹æ®æ¸¸æˆæ¨¡å¼è®¾ç½®AI
		if (settings.gameMode === 'ai') {
			// äººæœºå¯¹æˆ˜æ¨¡å¼ï¼šç”¨æˆ·å…ˆä¸‹ï¼ˆAIä¸ºç™½æ£‹ï¼‰
			othe.aiSide = -1;
			var difficulty = this.difficulties[settings.difficulty] || this.difficulties[0];
			ai.calculateTime = difficulty.time;
			ai.outcomeDepth = difficulty.depth;
		} else {
			// äººäººå¯¹æˆ˜æ¨¡å¼ï¼šç¦ç”¨AI
			othe.aiSide = 0;
		}
		
		othe.play();
		
		// æ›´æ–°æŒ‰é’®æ–‡æœ¬
		this.updatePlayButton();
	},
	
	// æ›´æ–°å¼€å§‹/é‡å¼€æŒ‰é’®æ–‡æœ¬
	updatePlayButton: function() {
		var playButton = document.getElementById("play");
		if (this.gameStarted) {
			playButton.innerHTML = "ğŸ”„ é‡å¼€";
		} else {
			playButton.innerHTML = "ğŸ® å¼€å§‹";
		}
	},
	
	// åˆå§‹åŒ–äº‹ä»¶ç›‘å¬å™¨
	init: function() {
		// ç»‘å®šæ‰€æœ‰äº‹ä»¶å¤„ç†å™¨
		document.getElementById("play").addEventListener('click', this.handlers.play);
		document.getElementById("setting").addEventListener('click', this.handlers.setting);
		document.getElementById("back").addEventListener('click', this.handlers.back);
		document.getElementById("ok").addEventListener('click', this.handlers.ok);
		
		// æ£‹ç›˜ç‚¹å‡»äº‹ä»¶
		var chessboard = document.getElementById('chessboard');
		if (chessboard) {
			chessboard.addEventListener('click', this.handlers.chessboardClick);
		}
		
		// åˆå§‹åŒ–æŒ‰é’®æ–‡æœ¬
		this.updatePlayButton();
	}
};

// åˆå§‹åŒ–
board.create();
board.toDown = othe.goChess;

// é¡µé¢åŠ è½½å®Œæˆååˆå§‹åŒ–äº‹ä»¶ç®¡ç†å™¨
document.addEventListener('DOMContentLoaded', function() {
	GameManager.init();
});

// åˆ‡æ¢AIéš¾åº¦é€‰é¡¹çš„æ˜¾ç¤º/éšè—
function toggleDifficultySection() {
	var gameModeInputs = document.querySelectorAll('input[name="gameMode"]');
	var difficultySection = document.getElementById('difficulty-section');
	
	for (var i = 0; i < gameModeInputs.length; i++) {
		if (gameModeInputs[i].checked) {
			if (gameModeInputs[i].value === 'ai') {
				difficultySection.style.display = 'block';
			} else {
				difficultySection.style.display = 'none';
			}
			break;
		}
	}
}

// è‡ªå®šä¹‰Alertå‡½æ•°
function showCustomAlert(message, icon = "ğŸ¯", title = "æ¸¸æˆæç¤º") {
	var alertDiv = document.getElementById("custom-alert");
	var iconDiv = alertDiv.querySelector(".alert-icon");
	var titleDiv = alertDiv.querySelector(".alert-title");
	var messageDiv = alertDiv.querySelector(".alert-message");
	
	iconDiv.textContent = icon;
	titleDiv.textContent = title;
	messageDiv.textContent = message;
	
	alertDiv.style.display = "flex";
}

function closeCustomAlert() {
	document.getElementById("custom-alert").style.display = "none";
}
</script>
</body>
</html>